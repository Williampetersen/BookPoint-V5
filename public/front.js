(()=>{var e={338(e,t,n){"use strict";var s=n(795);t.H=s.createRoot,s.hydrateRoot},556(e,t,n){e.exports=n(694)()},694(e,t,n){"use strict";var s=n(925);function r(){}function a(){}a.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,a,i){if(i!==s){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:r};return n.PropTypes=n,n}},795(e){"use strict";e.exports=window.ReactDOM},925(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}(()=>{"use strict";const e=window.React;var t=n(338);async function s(e,t={}){var n;const s=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",r=window.BP_FRONT?.nonce,a=await fetch(`${s}${e}`,{...t,headers:{"Content-Type":"application/json",...r?{"X-WP-Nonce":r}:{},...t.headers||{}}}),i=await a.json().catch(()=>({}));if(!a.ok||"error"===i?.status)throw new Error(i?.message||"Request failed");return null!==(n=i?.data)&&void 0!==n?n:i}const r=({service_id:e})=>s("/front/extras",{method:"POST",body:JSON.stringify({service_id:e})}),a=({service_id:e,location_id:t})=>s("/front/agents",{method:"POST",body:JSON.stringify({service_id:e,location_id:t})}),i=async()=>{const e=await s("/front/form-fields/active");if(e&&e.form&&e.customer&&e.booking)return e;const t=await s("/front/form-fields"),n=[],r=[],a=[];return(Array.isArray(t)?t:[]).forEach(e=>{const t=e.scope||"customer";"booking"===t?a.push(e):"form"===t?n.push(e):r.push(e)}),{form:n,customer:r,booking:a}};function o(e,t){const n=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return e?.image_url||e?.image||""||n+t}const c=window.ReactJSXRuntime;function l({locations:e,value:t,onChange:n,onNext:s,nextLabel:r="Next ->"}){const a=e||[],i=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-list",children:[a.map(e=>(0,c.jsx)("button",{type:"button",className:String(t)===String(e.id)?"bp-card active":"bp-card",onClick:()=>n(e.id),children:(0,c.jsxs)("div",{className:"bp-card-row",children:[(0,c.jsx)("img",{className:"bp-card-thumb",src:o(e,"location-image.png"),alt:""}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"bp-card-title",children:e.name}),(0,c.jsx)("div",{className:"bp-card-sub",children:e.address||""})]})]})},e.id)),a.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No locations found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("div",{}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!i,onClick:()=>s(),children:r})]})]})}function d({categories:e,value:t,onChange:n,onBack:s,onNext:r,backLabel:a="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=(t||[]).length>0;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-list",children:[l.map(e=>{const s=(t||[]).some(t=>String(t)===String(e.id));return(0,c.jsx)("button",{type:"button",className:s?"bp-card active":"bp-card",onClick:()=>{return t=e.id,void n([t]);var t},children:(0,c.jsxs)("div",{className:"bp-card-row",children:[(0,c.jsx)("img",{className:"bp-card-thumb",src:o(e,"service-image.png"),alt:""}),(0,c.jsx)("div",{className:"bp-card-title",children:e.name})]})},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No categories found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:a}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:r,children:i})]})]})}function u(e){const t=String(e||"").trim();if(!t)return"";const n=t.match(/[A-Za-z]{3}/);return(n?n[0]:t).toUpperCase()}function p(e,t={}){if(null==e)return"-";const n=Number(e);if(!Number.isFinite(n))return"-";const s=u(t.currency)||u(t.bp_default_currency)||u("undefined"!=typeof window?window.BP_FRONT?.currency:"")||"USD",r="after"===(t.currency_position||t.bp_currency_position||"before")?"after":"before",a=function(e){const t=u(e)||"USD";try{const e=new Intl.NumberFormat(void 0,{style:"currency",currency:t,currencyDisplay:"narrowSymbol"}).formatToParts(0).find(e=>"currency"===e.type);return e?.value||t}catch(e){return{USD:"$",EUR:"€",GBP:"£",DKK:"Kr",NOK:"Kr",SEK:"Kr",ISK:"Kr",CAD:"$",AUD:"$"}[t]||t}}(s),i=n.toLocaleString(void 0,{minimumFractionDigits:n%1==0?0:2,maximumFractionDigits:2}),o=/^[A-Z]{2,5}$/.test(a);return"after"===r?o?`${i} ${a}`:`${i}${a}`:o?`${a} ${i}`:`${a}${i}`}function m({services:e,value:t,onChange:n,onBack:s,onNext:r,settings:a,backLabel:i="<- Back",nextLabel:l="Next ->"}){const d=e||[],u=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[d.map(e=>{const s=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>n(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:o(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description}),(0,c.jsxs)("div",{className:"bp-meta",children:[!!e.duration&&(0,c.jsxs)("span",{className:"bp-chip",children:[e.duration," min"]}),!!e.category_name&&(0,c.jsx)("span",{className:"bp-chip ghost",children:e.category_name})]})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsx)("span",{className:"bp-price-line",children:p(e.price,a)}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Select"})}),(0,c.jsx)("div",{className:s?"bp-radio on":"bp-radio"})]})]},e.id)}),d.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No services found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:i}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!u,onClick:r,children:l})]})]})}function b({extras:e,value:t,onChange:n,onBack:s,onNext:r,settings:a,backLabel:i="<- Back",nextLabel:l="Next ->"}){const d=e||[];return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[d.map(e=>{const s=(t||[]).some(t=>String(t)===String(e.id));return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>function(e){const s=String(e),r=(t||[]).some(e=>String(e)===s)?(t||[]).filter(e=>String(e)!==s):[...t||[],e];n(r)}(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:o(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),(e.description||e.desc||e.summary)&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description||e.desc||e.summary})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsx)("span",{className:"bp-price-line",children:p(e.price,a)}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Extra"})}),(0,c.jsx)("div",{className:s?"bp-check on":"bp-check"})]})]},e.id)}),d.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No extras for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:i}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!1,onClick:r,children:l})]})]})}function f({agents:e,value:t,onChange:n,onBack:s,onNext:r,backLabel:a="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[l.map(e=>{const s=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>n(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-avatar",src:o(e,"default-avatar.jpg"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.title&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.title}),!!e.email&&(0,c.jsx)("div",{className:"bp-pickcard-sub small",children:e.email})]}),(0,c.jsx)("div",{className:"bp-pickcard-right",children:(0,c.jsx)("div",{className:s?"bp-radio on":"bp-radio"})})]},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No agents available for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:a}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:r,children:i})]})]})}const h=(e,t,n)=>new Date(Date.UTC(e,t,n,12,0,0)),g=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,y=(e,t)=>h(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+t),v=e=>{const t=new Date,n=h(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return e.getTime()<n.getTime()};async function x(e,t,{signal:n}={}){const s=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",r=window.BP_FRONT?.nonce,a=await fetch(`${s}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...r?{"X-WP-Nonce":r}:{}},body:JSON.stringify(t),signal:n,credentials:"same-origin"}),i=await a.text();let o;try{o=JSON.parse(i)}catch(e){o={ok:!1,raw:i}}if(!a.ok){const e=o?.message||o?.raw||`HTTP ${a.status}`;throw new Error(e)}return o}function j({serviceId:t,agentId:n,locationId:s,valueDate:r,valueSlot:a,onChangeDate:i,onChangeSlot:o,onBack:l,onNext:d,backLabel:u="<- Back",nextLabel:p="Next ->"}){const[m,b]=(0,e.useState)(()=>{const e=new Date;return h(e.getUTCFullYear(),e.getUTCMonth(),1)}),[f,j]=(0,e.useState)(r||null),[N,k]=(0,e.useState)([]),[w,S]=(0,e.useState)(!1),[C,_]=(0,e.useState)([]),[P,E]=(0,e.useState)(!1),[O,T]=(0,e.useState)(""),I=(0,e.useRef)(new Map),$=(0,e.useRef)(new Map),B=(0,e.useRef)(null),R=(0,e.useRef)(null),L=(0,e.useMemo)(()=>{var e;return`${m.getUTCFullYear()}-${e=m.getUTCMonth()+1,String(e).padStart(2,"0")}`},[m]),U=(0,e.useMemo)(()=>({service_id:t,agent_id:n,location_id:s,month:L}),[t,n,s,L]);(0,e.useEffect)(()=>{if(!t||!n)return;const e=JSON.stringify(U);if(I.current.has(e))return void k(I.current.get(e));B.current&&B.current.abort();const s=new AbortController;B.current=s,S(!0),x("/front/availability/month",U,{signal:s.signal}).then(t=>{const n=t?.data?.days||[];I.current.set(e,n),k(n)}).catch(()=>{}).finally(()=>S(!1))},[U,t,n]),(0,e.useEffect)(()=>{r&&r!==f&&j(r)},[r]);const A=(0,e.useMemo)(()=>({service_id:t,agent_id:n,location_id:s,date:f}),[t,n,s,f]);(0,e.useEffect)(()=>{if(!f||!t||!n)return;const e=JSON.stringify(A);if($.current.has(e))return void _($.current.get(e));R.current&&R.current.abort();const s=new AbortController;R.current=s,E(!0),_([]),T(""),x("/front/availability/day",A,{signal:s.signal}).then(t=>{const n=t?.slots||[];$.current.set(e,n),_(n)}).catch(e=>{"AbortError"!==e.name&&(_([]),T("No available times for this date."))}).finally(()=>E(!1))},[A,f,t,n]);const F=(0,e.useMemo)(()=>{const e=new Map;return N.forEach(t=>e.set(t.date,t)),e},[N]),M=(0,e.useMemo)(()=>(e=>{const t=h((n=e).getUTCFullYear(),n.getUTCMonth(),1);var n;const s=(e=>(e.getUTCDay()+6)%7)(t),r=y(t,-s);return Array.from({length:42},(e,t)=>y(r,t))})(m),[m]),D=!!f&&!!a?.start_time;return(0,c.jsxs)("div",{className:"bp-step bp-datetime",children:[(0,c.jsxs)("div",{className:"bp-calendar",children:[(0,c.jsxs)("div",{className:"bp-cal-header",children:[(0,c.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>b(e=>h(e.getUTCFullYear(),e.getUTCMonth()-1,1)),children:"<"}),(0,c.jsx)("div",{className:"bp-cal-title",children:m.toLocaleString(void 0,{month:"long",year:"numeric",timeZone:"UTC"})}),(0,c.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>b(e=>h(e.getUTCFullYear(),e.getUTCMonth()+1,1)),children:">"})]}),(0,c.jsx)("div",{className:"bp-cal-weekdays",children:["M","T","W","T","F","S","S"].map(e=>(0,c.jsx)("div",{className:"bp-cal-wd",children:e},e))}),(0,c.jsx)("div",{className:"bp-cal-grid",children:M.map((e,t)=>{const n=(r=m,(s=e).getUTCFullYear()===r.getUTCFullYear()&&s.getUTCMonth()===r.getUTCMonth());var s,r;const a=v(e)||!n,l=g(e),d=f===l,u=F.get(l),p=!!u&&u.has_slots;return(0,c.jsxs)("button",{type:"button",className:`bp-cal-day ${n?"":"is-out"} ${d?"is-selected":""}`,disabled:a,onClick:()=>function(e){if(v(e))return;const t=g(e);o?.(null),i?.(t)}(e),children:[(0,c.jsx)("div",{children:e.getUTCDate()}),(0,c.jsx)("div",{style:{height:4,width:28,borderRadius:999,margin:"6px auto 0",background:p?"#22c55e":"#e5e7eb",opacity:w&&!u?.3:1}})]},`${l}-${t}`)})})]}),(0,c.jsxs)("div",{className:"bp-slots",children:[(0,c.jsxs)("div",{className:"bp-slots-title",children:["Pick a slot for ",(0,c.jsx)("strong",{children:f||"—"})]}),!f&&(0,c.jsx)("div",{className:"bp-muted",children:"Select a date to see available times."}),f&&P&&(0,c.jsxs)("div",{className:"bp-slot-skeleton",children:[(0,c.jsx)("div",{className:"bp-skel"}),(0,c.jsx)("div",{className:"bp-skel"}),(0,c.jsx)("div",{className:"bp-skel"})]}),f&&!P&&O&&(0,c.jsx)("div",{className:"bp-error",children:O}),f&&!P&&!O&&(0,c.jsxs)("div",{className:"bp-slot-grid",children:[C.map((e,t)=>(0,c.jsx)("button",{type:"button",className:"bp-slot "+(a?.start_time===e.time?"is-selected":""),onClick:()=>o?.({start_time:e.time,end_time:e.end||""}),children:e.time},`${e.time}-${t}`)),0===C.length&&(0,c.jsx)("div",{className:"bp-muted",children:"No times found for this date."})]})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:l,children:u}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!D,onClick:d,children:p})]})]})}function N(e){return e?.id||e?.field_key||e?.name_key||""}function k(e){var t,n;return e&&"object"==typeof e?null!==(t=null!==(n=e.label)&&void 0!==n?n:e.value)&&void 0!==t?t:"":String(e)}function w(e){var t,n;return e&&"object"==typeof e?null!==(t=null!==(n=e.value)&&void 0!==n?n:e.label)&&void 0!==t?t:"":String(e)}function S({defs:e=[],layout:t=[],values:n,onChange:s,scope:r}){const a=t.map(t=>({layout:t,def:e.find(e=>N(e)===t.id)})).filter(e=>!!e.def),i=(e,t)=>{const a=r?`${r}.${e}`:e;s({...n||{},[a]:t})};return(0,c.jsx)("div",{className:"bp-fields-grid",children:a.map(({layout:e,def:t})=>{var s,a,o;const l=N(t),d=null!==(s=e.required)&&void 0!==s?s:!!(null!==(a=t.is_required)&&void 0!==a?a:t.required),u="half"===e.width?"half":"full",p=r?`${r}.${l}`:l,m=null!==(o=(n||{})[p])&&void 0!==o?o:"",b=(0,c.jsxs)("label",{className:"bp-label",children:[t.label," ",d?(0,c.jsx)("span",{className:"bp-req",children:"*"}):null]});if("textarea"===t.type)return(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("textarea",{className:"bp-textarea",placeholder:t.placeholder||"",value:m,onChange:e=>i(l,e.target.value)})]},p);if("select"===t.type){const e=Array.isArray(t.options)?t.options:t.options?.choices||[];return(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsxs)("select",{className:"bp-select",value:m,onChange:e=>i(l,e.target.value),children:[(0,c.jsx)("option",{value:"",children:"Select…"}),e.map((e,t)=>(0,c.jsx)("option",{value:w(e),children:k(e)},t))]})]},p)}return"checkbox"===t.type?(0,c.jsx)("div",{className:`bp-field bp-${u}`,children:(0,c.jsxs)("label",{className:"bp-checkbox-row",children:[(0,c.jsx)("input",{type:"checkbox",checked:!!m,onChange:e=>i(l,e.target.checked)}),(0,c.jsxs)("span",{children:[t.label," ",d?(0,c.jsx)("span",{className:"bp-req",children:"*"}):null]})]})},p):"date"===t.type?(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("input",{className:"bp-input-field",type:"date",value:m,onChange:e=>i(l,e.target.value)})]},p):(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("input",{className:"bp-input-field",type:"tel"===t.type?"tel":"email"===t.type?"email":"text",placeholder:t.placeholder||"",value:m,onChange:e=>i(l,e.target.value)})]},p)})})}function C(e,t){return"checkbox"===t?!e:null==e||(Array.isArray(e)?0===e.length:""===String(e).trim())}function _(e){return e?.id||e?.field_key||e?.name_key||""}function P(e=[]){return e.map(e=>{var t,n;return{id:_(e),required:!(null===(t=null!==(n=e?.is_required)&&void 0!==n?n:e?.required)||void 0===t||!t),width:"full"}}).filter(e=>e.id)}function E({formFields:e,answers:t,onChange:n,onBack:s,onNext:r,onError:a,layout:i,backLabel:o="<- Back",nextLabel:l="Next ->"}){const d=e?.customer||[],u=e?.booking||[],p=i?.customer?.fields?.length?i.customer.fields:P(d),m=i?.booking?.fields?.length?i.booking.fields:P(u);function b(e,t){n(e&&"object"==typeof e&&void 0===t?e:n=>({...n,[e]:t}))}function f(e){var n;return null!==(n=t?.[e])&&void 0!==n?n:""}return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)(S,{defs:d,layout:p,values:t,onChange:b,scope:"customer"}),u.length?(0,c.jsx)("div",{style:{marginTop:14},children:(0,c.jsx)(S,{defs:u,layout:m,values:t,onChange:b,scope:"booking"})}):null,(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:o}),(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:function(){const e=[{scope:"customer",defs:d,layout:p},{scope:"booking",defs:u,layout:m}];for(const r of e)for(const e of r.layout){var t,n,s;const i=r.defs.find(t=>_(t)===e.id);if(i&&((null!==(t=e.required)&&void 0!==t?t:null!==(n=null!==(s=i.is_required)&&void 0!==s?s:i.required)&&void 0!==n&&n)&&C(f(`${r.scope}.${e.id}`),i.type)))return void a?.(`${i.label||e.id} is required`)}a?.(""),r()},children:l})]})]})}function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}var T,I="clover",$="https://js.stripe.com",B="".concat($,"/").concat(I,"/stripe.js"),R=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,L=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,U="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",A=function(e){return R.test(e)||L.test(e)},F=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(B).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},M=null,D=null,q=null,W=!1,Y=function(){return T||(T=(e=null,null!==M?M:(M=new Promise(function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(U),window.Stripe)t(window.Stripe);else try{var s=function(){for(var e=document.querySelectorAll('script[src^="'.concat($,'"]')),t=0;t<e.length;t++){var n=e[t];if(A(n.src))return n}return null}();if(s&&e)console.warn(U);else if(s){if(s&&null!==q&&null!==D){var r;s.removeEventListener("load",q),s.removeEventListener("error",D),null===(r=s.parentNode)||void 0===r||r.removeChild(s),s=F(e)}}else s=F(e);q=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),D=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),s.addEventListener("load",q),s.addEventListener("error",D)}catch(e){return void n(e)}else t(null)})).catch(function(e){return M=null,Promise.reject(e)})).catch(function(e){return T=null,Promise.reject(e)}));var e};Promise.resolve().then(function(){return Y()}).catch(function(e){W||console.warn(e)});var J=n(556);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach(function(t){H(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function X(e){return X="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X(e)}function H(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var s,r,a=[],_n=!0,i=!1;try{for(n=n.call(e);!(_n=(s=n.next()).done)&&(a.push(s.value),!t||a.length!==t);_n=!0);}catch(e){i=!0,r=e}finally{try{_n||null==n.return||n.return()}finally{if(i)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?G(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}var V=function(t,n,s){var r=!!s,a=e.useRef(s);e.useEffect(function(){a.current=s},[s]),e.useEffect(function(){if(!r||!t)return function(){};var e=function(){a.current&&a.current.apply(a,arguments)};return t.on(n,e),function(){t.off(n,e)}},[r,n,t,a])},Q=function(t){var n=e.useRef(t);return e.useEffect(function(){n.current=t},[t]),n.current},ee=function(e){return null!==e&&"object"===X(e)},te="[object Object]",ne=function e(t,n){if(!ee(t)||!ee(n))return t===n;var s=Array.isArray(t);if(s!==Array.isArray(n))return!1;var r=Object.prototype.toString.call(t)===te;if(r!==(Object.prototype.toString.call(n)===te))return!1;if(!r&&!s)return t===n;var a=Object.keys(t),i=Object.keys(n);if(a.length!==i.length)return!1;for(var o={},c=0;c<a.length;c+=1)o[a[c]]=!0;for(var l=0;l<i.length;l+=1)o[i[l]]=!0;var d=Object.keys(o);if(d.length!==a.length)return!1;var u=t,p=n;return d.every(function(t){return e(u[t],p[t])})},se=function(e,t,n){return ee(e)?Object.keys(e).reduce(function(s,r){var a=!ee(t)||!ne(e[r],t[r]);return n.includes(r)?(a&&console.warn("Unsupported prop change: options.".concat(r," is not a mutable property.")),s):a?K(K({},s||{}),{},H({},r,e[r])):s},null):null},re="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ae=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re;if(null===e||ee(t=e)&&"function"==typeof t.elements&&"function"==typeof t.createToken&&"function"==typeof t.createPaymentMethod&&"function"==typeof t.confirmCardPayment)return e;throw new Error(n)},ie=e.createContext(null);ie.displayName="ElementsContext";var oe=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},ce=function(t){var n=t.stripe,s=t.options,r=t.children,a=e.useMemo(function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re;if(function(e){return ee(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return ae(e,t)})};var n=ae(e,t);return null===n?{tag:"empty"}:{tag:"sync",stripe:n}}(n)},[n]),i=Z(e.useState(function(){return{stripe:"sync"===a.tag?a.stripe:null,elements:"sync"===a.tag?a.stripe.elements(s):null}}),2),o=i[0],c=i[1];e.useEffect(function(){var e=!0,t=function(e){c(function(t){return t.stripe?t:{stripe:e,elements:e.elements(s)}})};return"async"!==a.tag||o.stripe?"sync"!==a.tag||o.stripe||t(a.stripe):a.stripePromise.then(function(n){n&&e&&t(n)}),function(){e=!1}},[a,o,s]);var l=Q(n);e.useEffect(function(){null!==l&&l!==n&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[l,n]);var d=Q(s);return e.useEffect(function(){if(o.elements){var e=se(s,d,["clientSecret","fonts"]);e&&o.elements.update(e)}},[s,d,o.elements]),e.useEffect(function(){var e;(e=o.stripe)&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"5.5.0"}),e.registerAppInfo({name:"react-stripe-js",version:"5.5.0",url:"https://stripe.com/docs/stripe-js/react"}))},[o.stripe]),e.createElement(ie.Provider,{value:o},r)};ce.propTypes={stripe:J.any,options:J.object};J.func.isRequired;var le=e.createContext(null);le.displayName="CheckoutContext",J.any,J.shape({clientSecret:J.oneOfType([J.string,J.instanceOf(Promise)]).isRequired,elementsOptions:J.object}).isRequired;var de=function(t){var n=e.useContext(le),s=e.useContext(ie);if(n){if(s)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CheckoutProvider> and <Elements> providers."));return n}return oe(s,t)},ue=["mode"],pe=function(t,n){var s,r="".concat((s=t).charAt(0).toUpperCase()+s.slice(1),"Element"),a=n?function(t){de("mounts <".concat(r,">"));var n=t.id,s=t.className;return e.createElement("div",{id:n,className:s})}:function(n){var s,a=n.id,i=n.className,o=n.options,c=void 0===o?{}:o,l=n.onBlur,d=n.onFocus,u=n.onReady,p=n.onChange,m=n.onEscape,b=n.onClick,f=n.onLoadError,h=n.onLoaderStart,g=n.onNetworksChange,y=n.onConfirm,v=n.onCancel,x=n.onShippingAddressChange,j=n.onShippingRateChange,N=n.onSavedPaymentMethodRemove,k=n.onSavedPaymentMethodUpdate,w=de("mounts <".concat(r,">")),S="elements"in w?w.elements:null,C="checkoutState"in w?w.checkoutState:null,_="success"===(null==C?void 0:C.type)||"loading"===(null==C?void 0:C.type)?C.sdk:null,P=Z(e.useState(null),2),E=P[0],O=P[1],T=e.useRef(null),I=e.useRef(null);V(E,"blur",l),V(E,"focus",d),V(E,"escape",m),V(E,"click",b),V(E,"loaderror",f),V(E,"loaderstart",h),V(E,"networkschange",g),V(E,"confirm",y),V(E,"cancel",v),V(E,"shippingaddresschange",x),V(E,"shippingratechange",j),V(E,"savedpaymentmethodremove",N),V(E,"savedpaymentmethodupdate",k),V(E,"change",p),u&&(s="expressCheckout"===t?u:function(){u(E)}),V(E,"ready",s),e.useLayoutEffect(function(){if(null===T.current&&null!==I.current&&(S||_)){var e=null;if(_)switch(t){case"paymentForm":e=_.createPaymentFormElement(c);break;case"payment":e=_.createPaymentElement(c);break;case"address":if(!("mode"in c))throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");var n=c.mode,s=function(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(c,ue);if("shipping"===n)e=_.createShippingAddressElement(s);else{if("billing"!==n)throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.");e=_.createBillingAddressElement(s)}break;case"expressCheckout":e=_.createExpressCheckoutElement(c);break;case"currencySelector":e=_.createCurrencySelectorElement();break;case"taxId":e=_.createTaxIdElement(c);break;default:throw new Error("Invalid Element type ".concat(r,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else S&&(e=S.create(t,c));T.current=e,O(e),e&&e.mount(I.current)}},[S,_,c]);var $=Q(c);return e.useEffect(function(){if(T.current){var e=se(c,$,["paymentRequest"]);e&&"update"in T.current&&T.current.update(e)}},[c,$]),e.useLayoutEffect(function(){return function(){if(T.current&&"function"==typeof T.current.destroy)try{T.current.destroy(),T.current=null}catch(e){}}},[]),e.createElement("div",{id:a,className:i,ref:I})};return a.propTypes={id:J.string,className:J.string,onChange:J.func,onBlur:J.func,onFocus:J.func,onReady:J.func,onEscape:J.func,onClick:J.func,onLoadError:J.func,onLoaderStart:J.func,onNetworksChange:J.func,onConfirm:J.func,onCancel:J.func,onShippingAddressChange:J.func,onShippingRateChange:J.func,onSavedPaymentMethodRemove:J.func,onSavedPaymentMethodUpdate:J.func,options:J.object},a.displayName=r,a.__elementType=t,a},me="undefined"==typeof window;e.createContext(null).displayName="EmbeddedCheckoutProviderContext",pe("auBankAccount",me),pe("card",me),pe("cardNumber",me),pe("cardExpiry",me),pe("cardCvc",me),pe("iban",me);var be=pe("payment",me);function fe({bookingId:t,onPaid:n,onBack:s}){const r=de("calls useStripe()").stripe,a=(u="calls useElements()",p=e.useContext(ie),oe(p,u)).elements,[i,o]=(0,e.useState)(!1),[l,d]=(0,e.useState)("");var u,p;return(0,c.jsxs)("div",{className:"bp-pay-wrap",children:[(0,c.jsx)("div",{className:"bp-pay-box",children:(0,c.jsx)(be,{})}),l?(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:l}):null,(0,c.jsxs)("div",{className:"bp-pay-actions",children:[(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:s,disabled:i,children:"Back"}),(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-primary",onClick:async()=>{if(d(""),r&&a){o(!0);try{const{error:e,paymentIntent:s}=await r.confirmPayment({elements:a,confirmParams:{return_url:window.location.href},redirect:"if_required"});if(e)return d(e.message||"Payment failed."),void o(!1);const i=await fetch("/wp-json/bp/v1/front/payment/stripe/confirm",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.BP_FRONT?.nonce||""},body:JSON.stringify({booking_id:t,payment_intent_id:s?.id||"",status:s?.status||""})}),c=await i.json();if(c?.success)return void n();d("Payment not completed yet. Please try again.")}catch(e){d(e?.message||"Payment error.")}finally{o(!1)}}},disabled:!r||i,children:i?"Processing...":"Pay now"})]})]})}function he({bookingId:t,totalLabel:n,paymentMethod:s,onPaid:r,onBack:a}){const i=window.BP_FRONT?.stripe_pk||"",o=(0,e.useMemo)(()=>i?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];W=!0;var s=Date.now();return Y().then(function(e){return function(e,t,n){if(null===e)return null;var s=t[0];if("string"!=typeof s)throw new Error("Expected publishable key to be of type string, got type ".concat(O(s)," instead."));var r=s.match(/^pk_test/),a=function(e){return 3===e?"v3":e}(e.version),i=I;r&&a!==i&&console.warn("Stripe.js@".concat(a," was loaded on the page, but @stripe/stripe-js@").concat("8.6.4"," expected Stripe.js@").concat(i,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var o=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"8.6.4",startTime:t})}(o,n),o}(e,t,s)})}(i):null,[i]),[l,d]=(0,e.useState)(""),[u,p]=(0,e.useState)(!1),[m,b]=(0,e.useState)("");return(0,e.useEffect)(()=>{if(!t)return;if("stripe"!==s)return;let e=!0;return b(""),p(!0),fetch("/wp-json/bp/v1/front/payment/stripe/start",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.BP_FRONT?.nonce||""},body:JSON.stringify({booking_id:t})}).then(e=>e.json().then(t=>({ok:e.ok,j:t}))).then(({ok:t,j:n})=>{if(e){if(!t||!n?.success||!n?.client_secret)throw new Error(n?.message||"Could not start Stripe payment.");d(n.client_secret)}}).catch(t=>{e&&b(t?.message||"Stripe start error.")}).finally(()=>e&&p(!1)),()=>{e=!1}},[t,s]),"stripe"!==s?(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("h3",{children:"Payment"}),(0,c.jsxs)("div",{className:"bp-muted",children:["Selected method: ",s]}),(0,c.jsx)("div",{className:"bp-pay-actions",style:{marginTop:12},children:(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:a,children:"Back"})})]}):i?(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-step-head",children:[(0,c.jsx)("h3",{children:"Payment"}),(0,c.jsx)("div",{className:"bp-total",children:n})]}),m?(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:m}):null,u&&!l?(0,c.jsx)("div",{className:"bp-muted",children:"Preparing secure payment..."}):null,l&&o?(0,c.jsx)(ce,{stripe:o,options:{clientSecret:l},children:(0,c.jsx)(fe,{bookingId:t,onPaid:r,onBack:a})}):null]}):(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("h3",{children:"Payment"}),(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:"Stripe publishable key is missing. Please configure it in BookPoint Settings."}),(0,c.jsx)("div",{className:"bp-pay-actions",children:(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:a,children:"Back"})})]})}function ge({locationId:t,categoryIds:n,serviceId:s,extraIds:r,agentId:a,date:i,slot:o,locations:l,categories:d,services:u,extras:p,agents:m,formFields:b,answers:f,paymentMethodLabel:h,totalLabel:g,onBack:y,onNext:v,isCreatingBooking:x,createError:j,loading:N,backLabel:k="<- Back",nextLabel:w="Next ->"}){const S=l.find(e=>String(e.id)===String(t)),C=u.find(e=>String(e.id)===String(s)),_=m.find(e=>String(e.id)===String(a)),P=d.filter(e=>n.includes(e.id)||n.includes(String(e.id))),E=p.filter(e=>r.includes(e.id)||r.includes(String(e.id))),O=(0,e.useMemo)(()=>[...b?.form||[],...b?.customer||[],...b?.booking||[]],[b]);return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-review",children:[(0,c.jsx)(ye,{label:"Location",value:S?.name}),(0,c.jsx)(ye,{label:"Categories",value:P.length?P.map(e=>e.name).join(", "):"-"}),(0,c.jsx)(ye,{label:"Service",value:C?.name}),(0,c.jsx)(ye,{label:"Agent",value:_?.name}),(0,c.jsx)(ye,{label:"Date",value:i}),(0,c.jsx)(ye,{label:"Time",value:o?.start_time?`${o.start_time} - ${o.end_time}`:"-"}),(0,c.jsx)(ye,{label:"Extras",value:E.length?E.map(e=>e.name).join(", "):"-"}),h?(0,c.jsx)(ye,{label:"Payment Method",value:h}):null,g?(0,c.jsx)(ye,{label:"Total",value:g}):null,(0,c.jsx)("div",{className:"bp-review-section",children:"Customer Information"}),O.map(e=>{var t;const n=e.field_key||e.name_key||"",s=`${e.scope}.${n}`;let r=null!==(t=f?.[s])&&void 0!==t?t:"";return"checkbox"===e.type&&(r="1"===r?"Yes":"No"),(0,c.jsx)(ye,{label:e.label,value:String(r||"")},s)})]}),j?(0,c.jsx)("div",{className:"bp-alert bp-alert-error bp-mt-12",children:j}):null,(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:y,children:k}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!!x,onClick:v,children:x?"Preparing payment...":w})]})]})}function ye({label:e,value:t}){return(0,c.jsxs)("div",{className:"bp-review-row",children:[(0,c.jsx)("div",{className:"k",children:e}),(0,c.jsx)("div",{className:"v",children:t||"-"})]})}function ve({bookingId:e,confirmInfo:t,loading:n,error:s,onRetry:r,onClose:a,summary:i}){const o=t?.status||"",l=t?.payment_status||"",d="confirmed"===o&&"paid"===l,u="pending_payment"===o||"unpaid"===l||"processing"===l;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("div",{className:"bp-step-head",children:(0,c.jsx)("h3",{children:"Confirmation"})}),n?(0,c.jsx)("div",{className:"bp-muted",children:"Loading booking status..."}):null,s?(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:s}):null,n||s?null:(0,c.jsxs)(c.Fragment,{children:[d?(0,c.jsx)("div",{className:"bp-alert bp-alert-success",children:"✅ Payment successful. Your booking is confirmed."}):u?(0,c.jsx)("div",{className:"bp-alert bp-alert-warn",children:"⏳ Payment is still processing. If it doesn’t confirm in a moment, click Retry."}):(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:"❌ Payment was not completed. Please try again."}),(0,c.jsxs)("div",{className:"bp-confirm-card",children:[(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Booking ID:"})," ",(0,c.jsxs)("span",{children:["#",e]})]}),(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Status:"})," ",(0,c.jsx)("span",{children:o||"-"})]}),(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Payment:"})," ",(0,c.jsx)("span",{children:l||"-"})]}),t?.payment_method?(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Method:"})," ",(0,c.jsx)("span",{children:t.payment_method})]}):null]}),i?(0,c.jsxs)("div",{className:"bp-confirm-summary",children:[(0,c.jsx)("h4",{children:"Summary"}),(0,c.jsx)("div",{className:"bp-muted",children:i})]}):null,(0,c.jsxs)("div",{className:"bp-pay-actions",style:{justifyContent:"space-between"},children:[(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:a,children:"Close"}),d?null:(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-primary",onClick:r,children:"Retry payment"})]})]})]})}pe("expressCheckout",me),pe("paymentRequestButton",me),pe("linkAuthentication",me),pe("address",me),pe("shippingAddress",me),pe("paymentMethodMessaging",me),pe("taxId",me);let xe="undefined"!=typeof window&&window.BP_FRONT?.settings||null;const je=["location","category","service","extras","agent","datetime","customer","review","payment","confirmation"],Ne=[{key:"location",title:"Location Selection",icon:"location-image.png"},{key:"category",title:"Choose Category",icon:"service-image.png"},{key:"service",title:"Choose Service",icon:"service-image.png"},{key:"extras",title:"Service Extras",icon:"service-image.png"},{key:"agent",title:"Choose Agent",icon:"default-avatar.jpg"},{key:"datetime",title:"Choose Date & Time",icon:"blue-dot.png"},{key:"customer",title:"Customer Information",icon:"default-avatar.jpg"},{key:"review",title:"Review Order",icon:"white-curve.png"},{key:"payment",title:"Payment",icon:"payment_now.png"},{key:"confirmation",title:"Confirm",icon:"logo.png"}];function ke(e=[]){const t=new Set(je),n=[];for(const s of e)t.has(s)&&!n.includes(s)&&n.push(s);for(const e of je)n.includes(e)||n.push(e);return je.filter(e=>n.includes(e))}function we(){return(window.BP_FRONT?.restUrl||"/wp-json/bp/v1").replace(/\/$/,"")}async function Se(e){const t=await fetch(`${we()}/front/bookings/${e}/status?_t=${Date.now()}`,{credentials:"same-origin",headers:{"X-WP-Nonce":window.BP_FRONT?.nonce||""}}),n=await t.json().catch(()=>({}));if(!t.ok||!n?.success)throw new Error(n?.message||"Could not load booking status");return n.booking}function Ce({open:t,onClose:n,brand:o}){const[u,h]=(0,e.useState)(0),{config:g,loading:y,error:v}=function(t){const[n,s]=(0,e.useState)(!1),[r,a]=(0,e.useState)(null),[i,o]=(0,e.useState)("");return(0,e.useEffect)(()=>{if(!t)return;let e=!0;s(!0),o("");const n=`/wp-json/bp/v1/front/booking-form-design?_t=${Date.now()}`;return fetch(n,{credentials:"same-origin"}).then(async e=>{const t=await e.json().catch(()=>null);if(!e.ok)throw new Error(t?.message||`Design fetch failed (${e.status})`);return t}).then(t=>{e&&a(t?.config||null)}).catch(t=>{e&&(a(null),o(t.message||"Design fetch failed"))}).finally(()=>{e&&s(!1)}),()=>{e=!1}},[t]),{config:r,loading:n,error:i}}(t),x=(0,e.useMemo)(()=>function(e){const t=(Array.isArray(e?.steps)?e.steps:[]).filter(e=>e&&e.key&&!1!==e.enabled),n=new Map(Ne.map(e=>[e.key,e])),s=ke(t.length?t.map(e=>{return"agents"===(t=e.key)||"agent"===t?"agent":"done"===t||"confirm"===t||"confirmation"===t?"confirmation":t;var t}).filter(Boolean):Ne.map(e=>e.key)),r=s.length?ke(s).map(e=>({...n.get(e)||{key:e,title:e,icon:"service-image.png"},key:e,title:n.get(e)?.title||e,subtitle:n.get(e)?.subtitle||""})):Ne.slice(),a=new Set;return r.filter(e=>!a.has(e.key)&&(a.add(e.key),!0))}(g),[g]),{settings:N}=function(t){const[n,s]=(0,e.useState)(xe),[r,a]=(0,e.useState)(!xe&&!!t);return(0,e.useEffect)(()=>{if(!t)return;if(xe)return void s(xe);let e=!0;a(!0);const n=("undefined"!=typeof window?window.BP_FRONT?.restUrl:"")||"/wp-json/bp/v1",r=`${String(n).replace(/\/$/,"")}/public/settings?_t=${Date.now()}`;return fetch(r,{credentials:"same-origin"}).then(e=>e.json()).then(t=>{e&&(xe=t?.data||t?.settings||null,s(xe))}).catch(()=>{e&&s(null)}).finally(()=>{e&&a(!1)}),()=>{e=!1}},[t]),{settings:n,loading:r}}(t),[k,w]=(0,e.useState)(null),[S,C]=(0,e.useState)([]),[_,P]=(0,e.useState)(null),[O,T]=(0,e.useState)([]),[I,$]=(0,e.useState)(null),[B,R]=(0,e.useState)(null),[L,U]=(0,e.useState)(null),[A,F]=(0,e.useState)(""),[M,D]=(0,e.useState)(0),[q,W]=(0,e.useState)(null),[Y,J]=(0,e.useState)(!1),[z,K]=(0,e.useState)(null),[X,H]=(0,e.useState)({mode:"",bookingId:0,token:"",action:""}),[Z,G]=(0,e.useState)(!1),[V,Q]=(0,e.useState)(""),[ee,te]=(0,e.useState)(null),[ne,se]=(0,e.useState)(null),[re,ae]=(0,e.useState)(!1),[ie,oe]=(0,e.useState)(""),[ce,le]=(0,e.useState)({form:[],customer:[],booking:[]}),[de,ue]=(0,e.useState)({}),[pe,me]=(0,e.useState)([]),[be,fe]=(0,e.useState)([]),[ye,je]=(0,e.useState)([]),[Ce,Pe]=(0,e.useState)([]),[Ee,Oe]=(0,e.useState)([]),[Te,Ie]=(0,e.useState)(!1),[$e,Be]=(0,e.useState)(""),Re=(Array.isArray(N?.payments_enabled_methods)&&N.payments_enabled_methods.length&&N.payments_enabled_methods,0!==N?.payments_enabled),Le=(0,e.useMemo)(()=>Re?x:x.filter(e=>"payment"!==e.key),[x,Re]),Ue=Le[u]||Le[0]||Ne[0],Ae=(0,e.useMemo)(()=>{if(Ue?.imageUrl)return Ue.imageUrl;const e=Ue?.icon||Ue?.image||"service-image.png";return o?.imagesBase?o.imagesBase+e:""},[o,Ue]),Fe=g?.texts?.helpTitle||"Need help?",Me=g?.texts?.helpPhone||g?.layout?.helpPhone||o?.helpPhone||"",De=!1!==Ue?.showLeftPanel,qe=!1!==Ue?.showHelpBox,We=(0,e.useMemo)(()=>{const e=ye.find(e=>String(e.id)===String(_));return(null!=e?.price?Number(e.price):0)+Ce.filter(e=>O.includes(e.id)||O.includes(String(e.id))).reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0)},[ye,_,Ce,O]);(0,e.useEffect)(()=>{if(t)return document.body.classList.add("bp-modal-open"),()=>document.body.classList.remove("bp-modal-open")},[t]),(0,e.useEffect)(()=>{t&&(h(0),Be(""),w(null),C([]),P(null),T([]),$(null),R(null),U(null),F(""),D(0),W(null),J(!1),K(null),H({mode:"",bookingId:0,token:"",action:""}),G(!1),Q(""),te(null),ue({}))},[t]),(0,e.useEffect)(()=>{t&&(Re?!A&&N?.payments_default_method&&F(N.payments_default_method):F("cash"))},[t,N,A,Re]),(0,e.useEffect)(()=>{if(!t)return;const e=new URLSearchParams(window.location.search),n=e.get("bp_payment"),s=e.get("token")||"",r=Number(e.get("booking_id")||0),a="paypal_return"===n||"paypal_cancel"===n;r&&("stripe_success"===n||"stripe_cancel"===n?H({mode:"stripe",bookingId:r,token:"",action:"stripe_cancel"===n?"cancel":"success"}):a&&H({mode:"paypal",bookingId:r,token:s,action:"paypal_cancel"===n?"cancel":"success"}))},[t]),(0,e.useEffect)(()=>{if(!t)return;if(!X.bookingId||!X.mode)return;let e=!0;return G(!0),Q(""),(async()=>{try{if("cancel"===X.action)throw await fetch(`${we()}/front/bookings/${X.bookingId}/payment-cancel`,{method:"POST",credentials:"same-origin"}),new Error("Payment cancelled.");if("paypal"===X.mode){if(!X.token)throw await fetch(`${we()}/front/bookings/${X.bookingId}/payment-cancel`,{method:"POST",credentials:"same-origin"}),new Error("Payment cancelled.");await async function(e,t){const n=await fetch(`${we()}/front/payments/paypal/capture`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:e,booking_id:t})}),s=await n.json().catch(()=>({}));if(!n.ok)throw new Error(s?.message||"PayPal capture failed");return s}(X.token,X.bookingId)}const t=await async function(e){let t=null;for(let n=0;n<10;n++){const n=await Se(e);if(t=n,"confirmed"===n?.status&&"paid"===n?.payment_status)return n;await new Promise(e=>setTimeout(e,1e3))}return t}(X.bookingId);if(!e)return;W(X.bookingId),D(X.bookingId),ue(e=>({...e,__booking:{booking_id:X.bookingId}})),te("confirmed"===t?.status&&"paid"===t?.payment_status?{booking:t,paid:!0,error:""}:{booking:t,paid:!1,error:"",pending:!0}),Ke("confirmation")}catch(t){if(!e)return;const n=t?.message||"Payment failed";Q(n),W(X.bookingId),D(X.bookingId),ue(e=>({...e,__booking:{booking_id:X.bookingId}})),te({booking:{id:X.bookingId},paid:!1,error:n}),Ke("confirmation")}finally{if(!e)return;G(!1),function(){const e=new URL(window.location.href);e.searchParams.delete("bp_payment"),e.searchParams.delete("booking_id"),e.searchParams.delete("token"),window.history.replaceState({},"",e.toString())}()}})(),()=>{e=!1}},[t,X]),(0,e.useEffect)(()=>{"Select a payment method"===$e&&A&&Be("")},[$e,A]),(0,e.useEffect)(()=>{t&&(async()=>{try{Ie(!0);const[e,t,n]=await Promise.all([s("/front/locations"),s("/front/categories"),i()]);me(e),fe(t),le(n)}catch(e){Be(e?.message||"Failed to load booking data.")}finally{Ie(!1)}})()},[t]),(0,e.useEffect)(()=>{t&&Le.map(e=>e.key).join("|")&&h(0)},[t,Le]),(0,e.useEffect)(()=>{h(e=>e<0?0:e>=Le.length?Math.max(0,Le.length-1):e)},[Le.length]);const Ye=Le[u]?.key;function Je(){Be(""),"payment"!==Ue?.key||A?h(e=>Math.min(e+1,Le.length-1)):Be("Select a payment method")}function ze(){Be(""),h(e=>Math.max(e-1,0))}function Ke(e){const t=Le.findIndex(t=>t.key===e);t>=0&&h(t)}(0,e.useEffect)(()=>{if(!t)return;if("confirmation"!==Ye)return;if(!q)return;let e=!0;return ae(!0),oe(""),Se(q).then(t=>e&&se(t)).catch(t=>e&&oe(t.message||"Error")).finally(()=>e&&ae(!1)),()=>{e=!1}},[t,Ye,q]),(0,e.useEffect)(()=>{t&&(async()=>{try{if("service"===Ue.key||"extras"===Ue.key||"agent"===Ue.key||"datetime"===Ue.key||"review"===Ue.key){const e=await(({category_ids:e=[],location_id:t=null})=>s("/front/services",{method:"POST",body:JSON.stringify({category_ids:e,location_id:t})}))({category_ids:S,location_id:k});je(e)}}catch(e){je([])}})()},[t,Ue.key,S,k]),(0,e.useEffect)(()=>{t&&(async()=>{try{if(!_)return;const[e,t]=await Promise.all([r({service_id:_}),a({service_id:_,location_id:k})]);Pe(e),Oe(t)}catch(e){Pe([]),Oe([])}})()},[t,_,k]);return t?y&&!g?(0,c.jsx)("div",{className:"bp-wizard-loading",children:"Loading booking form…"}):v&&!g?(0,c.jsxs)("div",{className:"bp-wizard-loading",children:["Wizard error: ",v]}):Le.length?(0,c.jsx)("div",{className:"bp-modal-overlay",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"bp-modal",children:[(0,c.jsx)("button",{className:"bp-modal-close",onClick:n,"aria-label":"Close",children:"x"}),(0,c.jsxs)("div",{className:"bp-modal-grid",children:[De?(0,c.jsxs)("aside",{className:"bp-side",children:[(0,c.jsx)("div",{className:"bp-side-icon",children:Ae?(0,c.jsx)("img",{src:Ae,alt:""}):null}),(0,c.jsx)("h3",{className:"bp-side-title",children:Ue.title}),(0,c.jsx)("p",{className:"bp-side-desc",children:Ue.subtitle||"Please complete the steps to schedule your booking."}),qe?(0,c.jsxs)("div",{className:"bp-side-help",children:[(0,c.jsx)("div",{children:Fe}),(0,c.jsx)("div",{className:"bp-help-phone",children:Me})]}):null]}):null,(0,c.jsxs)("main",{className:"bp-main",children:[(0,c.jsxs)("div",{className:"bp-main-head",children:[(0,c.jsx)("h2",{children:Ue.title}),(0,c.jsx)("div",{className:"bp-step-dots",children:Le.slice(0,8).map((e,t)=>(0,c.jsx)("span",{className:t===u?"bp-dot active":"bp-dot"},e.key))})]}),$e?(0,c.jsx)("div",{className:"bp-error",children:$e}):null,Te?(0,c.jsx)("div",{className:"bp-loading",children:"Loading..."}):null,"location"===Ue.key&&(0,c.jsx)(l,{locations:pe,value:k,onChange:w,onNext:Je}),"category"===Ue.key&&(0,c.jsx)(d,{categories:be,value:S,onChange:C,onBack:ze,onNext:Je}),"service"===Ue.key&&(0,c.jsx)(m,{services:ye,value:_,onChange:P,onBack:ze,onNext:Je,settings:N}),"extras"===Ue.key&&(0,c.jsx)(b,{extras:Ce,value:O,onChange:T,onBack:ze,onNext:Je,settings:N}),"agent"===Ue.key&&(0,c.jsx)(f,{agents:Ee,value:I,onChange:$,onBack:ze,onNext:Je}),"datetime"===Ue.key&&(0,c.jsx)(j,{locationId:k,serviceId:_,agentId:I,serviceDurationMin:ye.find(e=>String(e.id)===String(_))?.duration||30,valueDate:B,valueSlot:L,onChangeDate:e=>{R(e),U(null)},onChangeSlot:U,onBack:ze,onNext:Je}),"customer"===Ue.key&&(0,c.jsx)(E,{formFields:ce,answers:de,onChange:ue,onBack:ze,onNext:Je,onError:Be,layout:g?.fieldsLayout}),"payment"===Ue.key&&(0,c.jsx)(he,{bookingId:q,paymentMethod:A,totalLabel:p(We,N),onBack:()=>Ke("review"),onPaid:()=>Ke("confirmation")}),"review"===Ue.key&&(0,c.jsx)(ge,{locationId:k,categoryIds:S,serviceId:_,extraIds:O,agentId:I,date:B,slot:L,locations:pe,categories:be,services:ye,extras:Ce,agents:Ee,formFields:ce,answers:de,bookingId:q,paymentMethodLabel:{free:"Free (no payment)",cash:"Pay at location (Cash)",woocommerce:"Pay with WooCommerce",stripe:"Pay with Stripe",paypal:"Pay with PayPal"}[A]||A||"-",totalLabel:p(We,N),onBack:ze,onNext:async()=>{await(async()=>{if(q)return q;J(!0),K(null);try{const e=(()=>{const e={},t={};return Object.entries(de||{}).forEach(([n,s])=>{n.startsWith("customer.")?e[n.slice(9)]=s:n.startsWith("booking.")&&(t[n.slice(8)]=s)}),{location_id:k,category_ids:S,service_id:_,extra_ids:O,agent_id:I,date:B,start_time:L?.start_time||L?.start||"",end_time:L?.end_time||L?.end||"",field_values:de,customer_fields:e,booking_fields:t,extras:O,total_price:We,currency:N?.currency||"USD"}})();e.payment_method=A||"cash";const t=await fetch(`${we()}/front/booking/create`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.BP_FRONT?.nonce||""},credentials:"same-origin",body:JSON.stringify(e)}),n=await t.json().catch(()=>({}));if(!t.ok||!n?.success)throw new Error(n?.message||"Could not create booking");return W(n.booking_id),n.booking_id}catch(e){throw K(e.message||"Create booking failed"),e}finally{J(!1)}})(),Ke("payment")},isCreatingBooking:Y,createError:z,loading:Te}),"confirmation"===Ue.key&&(0,c.jsx)(ve,{bookingId:q,confirmInfo:ne,loading:re,error:ie,summary:null,onClose:n,onRetry:()=>Ke("payment")})]}),(0,c.jsxs)("aside",{className:"bp-summary",children:[(0,c.jsx)("div",{className:"bp-summary-title",children:"Summary"}),(0,c.jsx)("div",{className:"bp-summary-box",children:(0,c.jsx)(_e,{settings:N,locations:pe,categories:be,services:ye,extras:Ce,agents:Ee,locationId:k,categoryIds:S,serviceId:_,extraIds:O,agentId:I,date:B,slot:L})})]})]})]})}):(0,c.jsx)("div",{className:"bp-wizard-loading",children:"Wizard config invalid (no steps)"}):null}function _e(e){const{settings:t,locations:n,categories:s,services:r,extras:a,agents:i,locationId:o,categoryIds:l,serviceId:d,extraIds:u,agentId:m,date:b,slot:f}=e,h=n.find(e=>String(e.id)===String(o)),g=r.find(e=>String(e.id)===String(d)),y=i.find(e=>String(e.id)===String(m)),v=a.filter(e=>u.includes(e.id)||u.includes(String(e.id))),x=s.filter(e=>l.includes(e.id)||l.includes(String(e.id))),j=null!=g?.price?Number(g.price):0,N=v.reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0),k=j+N;return(0,c.jsxs)("div",{className:"bp-summary-items",children:[(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Location"}),(0,c.jsx)("div",{className:"v",children:h?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Category"}),(0,c.jsx)("div",{className:"v",children:x.length?x.map(e=>e.name).join(", "):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Service"}),(0,c.jsx)("div",{className:"v",children:g?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Service Price"}),(0,c.jsx)("div",{className:"v",children:null!=g?.price?p(j,t):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Agent"}),(0,c.jsx)("div",{className:"v",children:y?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Date"}),(0,c.jsx)("div",{className:"v",children:b||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Time"}),(0,c.jsx)("div",{className:"v",children:f?.start_time?`${f.start_time} - ${f.end_time}`:"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Extras"}),(0,c.jsx)("div",{className:"v",children:v.length?v.map(e=>e.name).join(", "):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Extras Price"}),(0,c.jsx)("div",{className:"v",children:v.length?p(N,t):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Total"}),(0,c.jsx)("div",{className:"v",children:null!=g?.price||v.length?p(k,t):"-"})]})]})}function Pe({label:t,mountEl:n}){const[s,r]=(0,e.useState)(!1),a="1"===n?.getAttribute("data-bp-fallback"),i=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",o=(0,e.useMemo)(()=>({imagesBase:i,helpPhone:"+45 91 67 14 52"}),[i]);return(0,e.useEffect)(()=>function(e,t){return e?(e.__bpOpen=()=>t(!0),()=>{e.__bpOpen&&delete e.__bpOpen}):()=>{}}(n,r),[n]),(0,c.jsxs)(c.Fragment,{children:[!a&&(0,c.jsx)("button",{className:"bp-book-btn",type:"button",onClick:()=>r(!0),children:t||"Book Now"}),(0,c.jsx)(Ce,{open:s,onClose:()=>r(!1),brand:o})]})}function Ee(){const e=document.querySelectorAll(".bp-front-root[data-bp-widget='wizard']");e.length?(e.forEach(e=>{const n=(0,t.H)(e),s=e.getAttribute("data-bp-label")||"Book Now";n.render((0,c.jsx)(Pe,{label:s,mountEl:e}))}),document.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element))return;const n=t.closest('.bp-fallback-btn, [data-bp-open="wizard"]');if(!n)return;const s=n.nextElementSibling,r=s&&s.classList.contains("bp-front-root")?s:n.closest(".bp-front-root")||document.querySelector(".bp-front-root");r&&"function"==typeof r.__bpOpen&&(e.preventDefault(),r.__bpOpen())})):function(){const e=document.getElementById("bp-front-root");if(!e)return;const n=(0,t.H)(e),s={imagesBase:(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",helpPhone:"+45 91 67 14 52"};document.addEventListener("click",t=>{const r=t.target;r instanceof Element&&r.closest(".bp-open-wizard")&&(t.preventDefault(),e.style.display="block",n.render((0,c.jsx)(Ce,{open:!0,onClose:()=>{n.render(null),e.style.display="none"},brand:s})))})}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Ee):Ee()})()})();