(()=>{"use strict";var e={338(e,t,i){var n=i(795);t.H=n.createRoot,n.hydrateRoot},795(e){e.exports=window.ReactDOM}},t={};const i=window.React;var n=function i(n){var l=t[n];if(void 0!==l)return l.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}(338);async function l(e){const t=(window.BP_FRONT?.restUrl||"/wp-json/bp/v1").replace(/\/$/,"")+e,i=await fetch(t,{method:"GET",credentials:"same-origin"}),n=await i.json().catch(()=>({}));if(!i.ok||"error"===n?.status)throw new Error(n?.message||`Request failed (${i.status})`);return n}const s=window.ReactJSXRuntime;function r({onClose:e}){const[t,n]=(0,i.useState)(1),[r,v]=(0,i.useState)([]),[j,w]=(0,i.useState)([]),[S,C]=(0,i.useState)([]),[W,k]=(0,i.useState)([]),[R,T]=(0,i.useState)(null),[I,F]=(0,i.useState)(null),[N,_]=(0,i.useState)([]),[E,A]=(0,i.useState)(null),[B,$]=(0,i.useState)(()=>(new Date).toISOString().slice(0,10)),[D,z]=(0,i.useState)([]),[O,L]=(0,i.useState)(null),[P,M]=(0,i.useState)(!1),[H,q]=(0,i.useState)("");(0,i.useEffect)(()=>{(async()=>{M(!0);try{const e=await l("/public/categories");v(e?.data||[])}catch(e){q(e.message||"Failed to load categories")}finally{M(!1)}})()},[]);const G=async(e,t,i)=>{if(t&&i&&e){M(!0),q("");try{const n=await l(`/public/availability-slots?date=${e}&service_id=${t}&agent_id=${i}`);z(n?.data?.slots||[])}catch(e){q(e.message||"Failed to load slots"),z([])}finally{M(!1)}}},J=(0,i.useMemo)(()=>((I?.price?Number(I.price):0)+N.reduce((e,t)=>e+Number(t.price||0),0)).toFixed(2),[I,N]);return(0,s.jsx)("div",{style:d,children:(0,s.jsxs)("div",{style:a,children:[(0,s.jsxs)("div",{style:c,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{style:{fontWeight:950},children:"BookPoint"}),(0,s.jsxs)("div",{style:{color:"#6b7280",fontWeight:800,fontSize:12},children:["Step ",t," / 7"]})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,s.jsx)("button",{onClick:()=>{if(1===t)return e();2!==t?3!==t?4!==t?5!==t||n(4):n(3):n(2):n(1)},style:b,children:"Back"}),(0,s.jsx)("button",{onClick:e,style:y,children:"×"})]})]}),(0,s.jsxs)("div",{style:{padding:14,overflow:"auto",flex:1},children:[H?(0,s.jsx)("div",{style:m,children:H}):null,P?(0,s.jsx)("div",{style:{fontWeight:900},children:"Loading…"}):null,P||1!==t?null:(0,s.jsx)(o,{title:"Choose a category",items:r,selectedId:R?.id,onSelect:e=>{T(e),F(null),_([]),A(null),w([]),C([]),k([]),(async e=>{M(!0),q("");try{const t=await l(`/public/services?category_id=${e}`);w(t?.data||[]),n(2)}catch(e){q(e.message||"Failed to load services")}finally{M(!1)}})(e.id)}}),P||2!==t?null:(0,s.jsx)(o,{title:"Choose a service",items:j,selectedId:I?.id,onSelect:e=>{F(e),_([]),A(null),C([]),k([]),(async e=>{M(!0),q("");try{const[t,i]=await Promise.all([l(`/public/extras?service_id=${e}`),l(`/public/agents?service_id=${e}`)]);C(t?.data||[]),k(i?.data||[]),n(3)}catch(e){q(e.message||"Failed to load extras/agents")}finally{M(!1)}})(e.id)}}),P||3!==t?null:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{style:f,children:"Service Extras"}),(0,s.jsx)("div",{style:{color:"#6b7280",fontWeight:800,marginTop:-8,marginBottom:10},children:"Optional. Choose any extras."}),(0,s.jsx)("div",{style:p,children:0===S.length?(0,s.jsx)("div",{style:{color:"#6b7280",fontWeight:800},children:"No extras for this service."}):S.map(e=>{const t=N.some(t=>t.id===e.id);return(0,s.jsxs)("button",{type:"button",onClick:()=>{_(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])},style:{...g,borderColor:t?"rgba(67,24,255,.55)":"#e5e7eb",background:t?"rgba(67,24,255,.08)":"#fff"},children:[(0,s.jsx)("img",{src:e.image_url||"",alt:"",style:x,onError:e=>{e.currentTarget.style.display="none"}}),(0,s.jsx)("div",{style:{fontWeight:950,textAlign:"left"},children:e.name}),(0,s.jsxs)("div",{style:{color:"#6b7280",fontWeight:800,textAlign:"left"},children:["+ ",Number(e.price||0).toFixed(2)]})]},e.id)})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:14,alignItems:"center",flexWrap:"wrap",gap:10},children:[(0,s.jsxs)("div",{style:{fontWeight:950},children:["Total so far: ",J]}),(0,s.jsx)("button",{style:h,onClick:()=>n(4),children:"Next: Choose agent"})]})]}),P||4!==t?null:(0,s.jsx)(o,{title:"Choose an agent",items:W,selectedId:E?.id,onSelect:e=>{A(e),n(5),L(null),G(B,I.id,e.id)},compact:!0}),P||5!==t?null:(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{style:f,children:"Choose date & time"}),(0,s.jsx)("div",{style:{color:"#6b7280",fontWeight:800,marginTop:-8,marginBottom:10},children:"Pick an available time slot."}),(0,s.jsxs)("div",{style:{display:"flex",gap:12,flexWrap:"wrap",alignItems:"center"},children:[(0,s.jsx)("div",{style:{fontWeight:900},children:"Date"}),(0,s.jsx)("input",{type:"date",value:B,onChange:e=>{const t=e.target.value;$(t),L(null),I?.id&&E?.id&&G(t,I.id,E.id)},style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e5e7eb",fontWeight:900}}),(0,s.jsx)("button",{style:b,onClick:()=>{I?.id&&E?.id&&G(B,I.id,E.id)},children:"Refresh slots"})]}),(0,s.jsx)("div",{style:{marginTop:14},children:0===D.length?(0,s.jsx)("div",{style:{color:"#6b7280",fontWeight:800},children:"No available times for this date."}):(0,s.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:10},children:D.map((e,t)=>{const i=O?.start_time===e.start_time;return(0,s.jsx)("button",{type:"button",onClick:()=>L(e),style:{padding:"12px 10px",borderRadius:14,border:"1px solid",borderColor:i?"rgba(67,24,255,.55)":"#e5e7eb",background:i?"rgba(67,24,255,.10)":"#fff",fontWeight:950,cursor:"pointer",textAlign:"center"},children:e.label||e.start_time.slice(0,5)},t)})})}),(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:14,alignItems:"center",flexWrap:"wrap",gap:10},children:[(0,s.jsxs)("div",{style:{fontWeight:950},children:["Selected: ",O?O.label:"—"]}),(0,s.jsx)("button",{style:h,disabled:!O,onClick:()=>{alert("A8 done ✅ Next step (A9) will add Form Fields + Summary + Submit booking")},children:"Next: Your details"})]})]})]}),(0,s.jsxs)("div",{style:u,children:[(0,s.jsxs)("div",{style:{fontWeight:900,fontSize:12,color:"#6b7280"},children:["Selected: ",R?.name||"—"," → ",I?.name||"—"," → ",E?.name||"—"]}),(0,s.jsxs)("div",{style:{fontWeight:950},children:["Total: ",J]})]})]})})}function o({title:e,items:t,selectedId:i,onSelect:n,compact:l=!1}){return(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{style:f,children:e}),(0,s.jsx)("div",{style:{...p,gridTemplateColumns:l?"repeat(auto-fill, minmax(160px, 1fr))":"repeat(auto-fill, minmax(200px, 1fr))"},children:0===t.length?(0,s.jsx)("div",{style:{color:"#6b7280",fontWeight:800},children:"No items"}):t.map(e=>{const t=i===e.id;return(0,s.jsxs)("button",{type:"button",onClick:()=>n(e),style:{...g,borderColor:t?"rgba(67,24,255,.55)":"#e5e7eb",background:t?"rgba(67,24,255,.08)":"#fff"},children:[(0,s.jsx)("img",{src:e.image_url||"",alt:"",style:x,onError:e=>{e.currentTarget.style.display="none"}}),(0,s.jsx)("div",{style:{fontWeight:950,textAlign:"left"},children:e.name}),"price"in e?(0,s.jsx)("div",{style:{color:"#6b7280",fontWeight:800,textAlign:"left"},children:Number(e.price||0).toFixed(2)}):null,"duration"in e?(0,s.jsxs)("div",{style:{color:"#6b7280",fontWeight:800,textAlign:"left"},children:[e.duration," min"]}):null]},e.id)})})]})}const d={position:"fixed",inset:0,background:"rgba(2,6,23,.55)",zIndex:999999,display:"flex",alignItems:"center",justifyContent:"center",padding:14},a={width:"min(980px, 100%)",height:"min(86vh, 720px)",background:"#fff",borderRadius:20,overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 30px 80px rgba(0,0,0,.35)"},c={padding:14,borderBottom:"1px solid #eef2f7",display:"flex",justifyContent:"space-between",alignItems:"center"},u={padding:14,borderTop:"1px solid #eef2f7",display:"flex",justifyContent:"space-between",alignItems:"center",gap:10},f={margin:"0 0 10px 0"},p={display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))"},g={border:"1px solid #e5e7eb",borderRadius:16,padding:12,cursor:"pointer",display:"grid",gap:8,textAlign:"left"},x={width:"100%",height:110,borderRadius:14,objectFit:"cover",background:"#f3f4f6",border:"1px solid #eef2f7"},h={background:"#4318ff",color:"#fff",border:"none",borderRadius:12,padding:"10px 12px",fontWeight:950,cursor:"pointer"},b={background:"#eef2ff",color:"#1e1b4b",border:"1px solid rgba(67,24,255,.15)",borderRadius:12,padding:"10px 12px",fontWeight:950,cursor:"pointer"},y={width:34,height:34,borderRadius:12,border:"1px solid #e5e7eb",background:"#fff",cursor:"pointer",fontWeight:900,fontSize:18},m={background:"#fef2f2",border:"1px solid #fecaca",color:"#991b1b",padding:10,borderRadius:12,fontWeight:900,marginBottom:10};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("bp-front-root");if(!e)return;const t=(0,n.H)(e);document.addEventListener("click",i=>{const n=i.target;n instanceof Element&&n.closest(".bp-open-wizard")&&(i.preventDefault(),e.style.display="block",t.render((0,s.jsx)(r,{onClose:()=>{t.render(null),e.style.display="none"}})))})})})();