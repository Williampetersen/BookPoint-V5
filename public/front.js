(()=>{"use strict";var e={338(e,t,i){var n=i(795);t.H=n.createRoot,n.hydrateRoot},795(e){e.exports=window.ReactDOM}},t={};const i=window.React;var n=function i(n){var l=t[n];if(void 0!==l)return l.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,i),s.exports}(338);const l=window.ReactJSXRuntime,s=window.BP_FRONT?.restUrl||"/wp-json/bp/v1";async function r(e){const t=await fetch(`${s}${e}`,{credentials:"same-origin"}),i=await t.json().catch(()=>({}));if(!t.ok||"error"===i?.status)throw new Error(i?.message||"Request failed");return i}function o({onClose:e}){const[t,n]=(0,i.useState)(0),[o,S]=(0,i.useState)([]),[w,k]=(0,i.useState)([]),[C,W]=(0,i.useState)([]),[_,T]=(0,i.useState)([]),[R,$]=(0,i.useState)(null),[N,B]=(0,i.useState)(null),[I,A]=(0,i.useState)([]),[P,E]=(0,i.useState)(null),[D,F]=(0,i.useState)(()=>(new Date).toISOString().slice(0,10)),[M,L]=(0,i.useState)(null),[O,U]=(0,i.useState)([]),[q,z]=(0,i.useState)(!1),[Y,H]=(0,i.useState)({}),[J,K]=(0,i.useState)([]),[G,X]=(0,i.useState)(!1),[Q,V]=(0,i.useState)(!1),[Z,ee]=(0,i.useState)(null),[te,ie]=(0,i.useState)(!1),[ne,le]=(0,i.useState)(""),[se,re]=(0,i.useState)({slot_interval_minutes:15,currency:"USD",currency_position:"before"}),oe=(0,i.useMemo)(()=>o.find(e=>String(e.id)===String(R))||null,[o,R]),ae=(0,i.useMemo)(()=>w.find(e=>String(e.id)===String(N))||null,[w,N]),de=(0,i.useMemo)(()=>_.find(e=>String(e.id)===String(P))||null,[_,P]);(0,i.useEffect)(()=>{(async()=>{ie(!0);try{const e=await r("/public/categories");S(e?.data||[])}catch(e){le(e.message||"Failed to load categories")}finally{ie(!1)}})()},[]),(0,i.useEffect)(()=>{(async()=>{try{const e=await r("/public/settings");e?.data&&re(e.data)}catch(e){}})()},[]),(0,i.useEffect)(()=>{(async()=>{z(!0);try{const e=await r("/public/form-fields");U(Array.isArray(e?.data)?e.data:[])}catch(e){U([]),console.warn("Failed to load form fields",e)}finally{z(!1)}})()},[]),(0,i.useEffect)(()=>{if(!(N&&P&&D))return K([]),void L(null);(async()=>{le(""),X(!0);try{const e=new URLSearchParams({date:D,service_id:String(N),agent_id:String(P)}).toString(),t=await r(`/public/availability-slots?${e}`),i=Array.isArray(t?.data)?t.data:Array.isArray(t?.data?.slots)?t.data.slots:[];K(i),M&&!i.some(e=>e.start_time===M.start_time)&&L(null)}catch(e){K([]),L(null),le(e.message||"Failed to load time slots")}finally{X(!1)}})()},[N,P,D]);const ce=(0,i.useMemo)(()=>(O||[]).filter(e=>"details"===(e.step_key||"details")),[O]);function ue(){if(le(""),0===t&&!R)return le("Please select a category");if(1===t&&!N)return le("Please select a service");if(2===t&&!P)return le("Please select an agent");if(3===t){if(!D)return le("Please select a date");if(!M?.start_time)return le("Please select a time slot")}if(4===t){const e=function(e){for(const t of e){if(!t.is_required)continue;const e=`${t.scope}.${t.field_key}`,i=Y[e];if(null==i||""===i||Array.isArray(i)&&0===i.length)return`${t.label} is required`}return""}(ce);if(e)return le(e)}n(e=>e+1)}function fe({f:e,value:t,onChange:i}){const n={style:{width:"100%",padding:"10px 12px",borderRadius:14,border:"1px solid #e5e7eb",fontWeight:850,background:"#fff",outline:"none"}};if("textarea"===e.type)return(0,l.jsx)("textarea",{...n,rows:5,placeholder:e.placeholder||"",value:t||"",onChange:e=>i(e.target.value)});if("select"===e.type){const s=e.options?.choices||[];return(0,l.jsxs)("select",{...n,value:t||"",onChange:e=>i(e.target.value),children:[(0,l.jsx)("option",{value:"",children:"Select…"}),s.map((e,t)=>(0,l.jsx)("option",{value:e.value,children:e.label},t))]})}if("checkbox"===e.type){const n="1"===t||!0===t;return(0,l.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:10,fontWeight:900},children:[(0,l.jsx)("input",{type:"checkbox",checked:n,onChange:e=>i(e.target.checked?"1":"0")}),e.placeholder||"Yes"]})}const s="email"===e.type?"email":"tel"===e.type?"tel":"number"===e.type?"number":"date"===e.type?"date":"text";return(0,l.jsx)("input",{...n,type:s,placeholder:e.placeholder||"",value:t||"",onChange:e=>i(e.target.value)})}const ge=(0,i.useMemo)(()=>((ae?.price?Number(ae.price):0)+I.reduce((e,t)=>e+Number(t.price||0),0)).toFixed(2),[ae,I]);return 999===t&&Z?(0,l.jsx)("div",{style:c,children:(0,l.jsxs)("div",{style:u,children:[(0,l.jsxs)("div",{style:f,children:[(0,l.jsx)("div",{style:{fontWeight:950},children:"BookPoint"}),(0,l.jsx)("div",{style:{display:"flex",gap:8},children:(0,l.jsx)("button",{onClick:e,style:j,children:"×"})})]}),(0,l.jsxs)("div",{style:{padding:18,overflow:"auto",flex:1},children:[(0,l.jsx)("h3",{style:{margin:0,fontWeight:1e3},children:"Booking created ✅"}),(0,l.jsxs)("div",{style:{marginTop:10,fontWeight:900,opacity:.8},children:["Booking ID: ",Z.booking_id]}),(0,l.jsx)("div",{style:{marginTop:16},children:(0,l.jsx)("button",{className:"bp-btn",onClick:()=>window.location.reload(),children:"Close"})})]})]})}):(0,l.jsx)("div",{style:c,children:(0,l.jsxs)("div",{style:u,children:[(0,l.jsxs)("div",{style:f,children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("div",{style:{fontWeight:950},children:"BookPoint"}),(0,l.jsxs)("div",{style:{color:"#6b7280",fontWeight:800,fontSize:12},children:["Step ",Math.min(t,5)+1," / 6"]})]}),(0,l.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,l.jsx)("button",{onClick:0===t?e:function(){le(""),n(e=>Math.max(0,e-1))},style:m,children:"Back"}),(0,l.jsx)("button",{onClick:e,style:j,children:"×"})]})]}),(0,l.jsxs)("div",{style:{padding:14,overflow:"auto",flex:1},children:[ne&&3!==t?(0,l.jsx)("div",{style:v,children:ne}):null,te?(0,l.jsx)("div",{style:{fontWeight:900},children:"Loading…"}):null,te||0!==t?null:(0,l.jsxs)("div",{children:[(0,l.jsx)(a,{title:"Choose a category",items:o,selectedId:R,onSelect:e=>{$(e.id),B(null),A([]),E(null),k([]),W([]),T([]),K([]),L(null),(async e=>{ie(!0),le("");try{const t=await r(`/public/services?category_id=${e}`);k(t?.data||[])}catch(e){le(e.message||"Failed to load services")}finally{ie(!1)}})(e.id)}}),(0,l.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:14},children:(0,l.jsx)("button",{style:b,onClick:ue,children:"Next"})})]}),te||1!==t?null:(0,l.jsxs)("div",{children:[(0,l.jsx)(a,{title:"Choose a service",items:w,selectedId:N,onSelect:e=>{B(e.id),A([]),E(null),W([]),T([]),K([]),L(null),(async e=>{ie(!0),le("");try{const[t,i]=await Promise.all([r(`/public/extras?service_id=${e}`),r(`/public/agents?service_id=${e}`)]);W(t?.data||[]),T(i?.data||[])}catch(e){le(e.message||"Failed to load extras/agents")}finally{ie(!1)}})(e.id)}}),(0,l.jsx)("div",{style:{height:14}}),(0,l.jsx)("h3",{style:p,children:"Service Extras"}),(0,l.jsx)("div",{style:{color:"#6b7280",fontWeight:800,marginTop:-8,marginBottom:10},children:"Optional. Choose any extras."}),(0,l.jsx)("div",{style:h,children:0===C.length?(0,l.jsx)("div",{style:{color:"#6b7280",fontWeight:800},children:"No extras for this service."}):C.map(e=>{const t=I.some(t=>t.id===e.id);return(0,l.jsxs)("button",{type:"button",onClick:()=>{A(t=>t.some(t=>t.id===e.id)?t.filter(t=>t.id!==e.id):[...t,e])},style:{...x,borderColor:t?"rgba(67,24,255,.55)":"#e5e7eb",background:t?"rgba(67,24,255,.08)":"#fff"},children:[(0,l.jsx)("img",{src:e.image_url||"",alt:"",style:y,onError:e=>{e.currentTarget.style.display="none"}}),(0,l.jsx)("div",{style:{fontWeight:950,textAlign:"left"},children:e.name}),(0,l.jsxs)("div",{style:{color:"#6b7280",fontWeight:800,textAlign:"left"},children:["+ ",Number(e.price||0).toFixed(2)]})]},e.id)})}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:14,alignItems:"center",flexWrap:"wrap",gap:10},children:[(0,l.jsxs)("div",{style:{fontWeight:950},children:["Total so far: ",ge]}),(0,l.jsx)("button",{style:b,onClick:ue,children:"Next: Choose agent"})]})]}),te||2!==t?null:(0,l.jsxs)("div",{children:[(0,l.jsx)(a,{title:"Choose an agent",items:_,selectedId:P,onSelect:e=>E(e.id),compact:!0}),(0,l.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:14},children:(0,l.jsx)("button",{style:b,onClick:ue,children:"Next: Choose time"})})]}),te||3!==t?null:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{style:p,children:"Choose date & time"}),(0,l.jsx)("div",{style:{color:"#6b7280",fontWeight:800,marginTop:-8,marginBottom:10},children:"Pick an available time slot."}),(0,l.jsxs)("div",{style:{marginTop:12},children:[(0,l.jsx)("label",{style:{fontWeight:900},children:"Date"}),(0,l.jsx)("input",{type:"date",value:D,onChange:e=>F(e.target.value),style:{width:"100%",padding:"10px 12px",borderRadius:12,border:"1px solid #e5e7eb",marginTop:6}})]}),(0,l.jsxs)("div",{style:{marginTop:12},children:[(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,l.jsx)("label",{style:{fontWeight:900},children:"Time slots"}),G?(0,l.jsx)("span",{style:{fontWeight:900,opacity:.7},children:"Loading…"}):null]}),ne?(0,l.jsx)("div",{style:{marginTop:8,background:"#fef2f2",border:"1px solid #fecaca",color:"#991b1b",padding:10,borderRadius:12,fontWeight:900},children:ne}):null,!G&&D&&N&&P&&0===J.length?(0,l.jsx)("div",{style:{marginTop:8,opacity:.75,fontWeight:900},children:"No available time slots for this date."}):null,(0,l.jsx)("div",{style:{marginTop:10,display:"grid",gridTemplateColumns:"repeat(3, minmax(0, 1fr))",gap:10},children:J.map(e=>{const t=M?.start_time===e.start_time;return(0,l.jsx)("button",{type:"button",onClick:()=>L(e),style:{padding:"10px 10px",borderRadius:14,border:t?"2px solid #4318ff":"1px solid #e5e7eb",background:t?"rgba(67,24,255,.10)":"#fff",fontWeight:950,cursor:"pointer"},children:e.label||e.start_time},e.start_time)})})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:14,alignItems:"center",flexWrap:"wrap",gap:10},children:[(0,l.jsxs)("div",{style:{fontWeight:950},children:["Selected: ",M?M.label||M.start_time:"—"]}),(0,l.jsx)("button",{style:b,onClick:ue,children:"Next: Your details"})]})]}),te||4!==t?null:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{style:p,children:"Your details"}),(0,l.jsx)("div",{style:{color:"#6b7280",fontWeight:800,marginTop:-8,marginBottom:10},children:"We’ll use this to confirm your booking."}),q?(0,l.jsx)("div",{style:{fontWeight:900,opacity:.7},children:"Loading fields…"}):null,ce.map(e=>{const t=`${e.scope}.${e.field_key}`,i=function(e){var t;return null!==(t=Y[e])&&void 0!==t?t:""}(t);return(0,l.jsxs)("div",{style:{marginTop:12},children:[(0,l.jsxs)("label",{style:{fontWeight:950},children:[e.label," ",e.is_required?(0,l.jsx)("span",{style:{color:"#ef4444"},children:"*"}):null]}),(0,l.jsx)("div",{style:{marginTop:6},children:(0,l.jsx)(fe,{f:e,value:i,onChange:e=>function(e,t){H(i=>({...i,[e]:t}))}(t,e)})})]},t)}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:14,alignItems:"center",flexWrap:"wrap",gap:10},children:[(0,l.jsxs)("div",{style:{fontWeight:950},children:["Selected: ",D," ",M?M.label||M.start_time:"—"]}),(0,l.jsx)("button",{style:b,onClick:ue,children:"Next: Summary"})]})]}),te||5!==t?null:(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{style:p,children:"Review & submit"}),(0,l.jsx)("div",{style:{color:"#6b7280",fontWeight:800,marginTop:-8,marginBottom:10},children:"Please confirm your booking details."}),(0,l.jsxs)("div",{className:"bp-card",style:{boxShadow:"none"},children:[(0,l.jsx)(d,{label:"Category",value:oe?.name}),(0,l.jsx)(d,{label:"Service",value:ae?.name}),(0,l.jsx)(d,{label:"Agent",value:de?.name}),(0,l.jsx)(d,{label:"Date",value:D}),(0,l.jsx)(d,{label:"Time",value:M?.start_time}),(0,l.jsx)(d,{label:"Price",value:function(e,t){const i=Number(e||0),n=t?.currency||"USD",l=t?.currency_position||"before",s={USD:"$",EUR:"€",DKK:"kr",GBP:"£"}[n]||n,r=i.toFixed(2);return"after"===l?`${r} ${s}`:`${s} ${r}`}(ge,se)}),(0,l.jsx)("div",{style:{height:10}}),(0,l.jsx)("div",{style:{fontWeight:1e3},children:"Your details"}),ce.map(e=>{var t;const i=`${e.scope}.${e.field_key}`;return(0,l.jsx)(d,{label:e.label,value:String(null!==(t=Y[i])&&void 0!==t?t:"")},i)})]}),(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginTop:14,alignItems:"center",flexWrap:"wrap",gap:10},children:[(0,l.jsxs)("div",{style:{fontWeight:950},children:["Total: ",ge]}),(0,l.jsx)("button",{className:"bp-btn bp-btn-primary",disabled:Q,onClick:async function(){le(""),V(!0);try{const e={service_id:N,agent_id:P,date:D,start_time:M?.start_time,field_values:Y},t=await async function(e,t){const i=await fetch(`${s}/public/bookings`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify(t||{})}),n=await i.json().catch(()=>({}));if(!i.ok||"error"===n?.status)throw new Error(n?.message||"Request failed");return n}(0,e);ee({booking_id:t?.data?.booking_id||t?.data?.id}),n(999)}catch(e){le(e.message||"Booking failed")}finally{V(!1)}},children:Q?"Submitting…":"Submit Booking"})]})]})]}),(0,l.jsxs)("div",{style:g,children:[(0,l.jsxs)("div",{style:{fontWeight:900,fontSize:12,color:"#6b7280"},children:["Selected: ",oe?.name||"—"," → ",ae?.name||"—"," → ",de?.name||"—"]}),(0,l.jsxs)("div",{style:{fontWeight:950},children:["Total: ",ge]})]})]})})}function a({title:e,items:t,selectedId:i,onSelect:n,compact:s=!1}){return(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{style:p,children:e}),(0,l.jsx)("div",{style:{...h,gridTemplateColumns:s?"repeat(auto-fill, minmax(160px, 1fr))":"repeat(auto-fill, minmax(200px, 1fr))"},children:0===t.length?(0,l.jsx)("div",{style:{color:"#6b7280",fontWeight:800},children:"No items"}):t.map(e=>{const t=i===e.id;return(0,l.jsxs)("button",{type:"button",onClick:()=>n(e),style:{...x,borderColor:t?"rgba(67,24,255,.55)":"#e5e7eb",background:t?"rgba(67,24,255,.08)":"#fff"},children:[(0,l.jsx)("img",{src:e.image_url||"",alt:"",style:y,onError:e=>{e.currentTarget.style.display="none"}}),(0,l.jsx)("div",{style:{fontWeight:950,textAlign:"left"},children:e.name}),"price"in e?(0,l.jsx)("div",{style:{color:"#6b7280",fontWeight:800,textAlign:"left"},children:Number(e.price||0).toFixed(2)}):null,"duration"in e?(0,l.jsxs)("div",{style:{color:"#6b7280",fontWeight:800,textAlign:"left"},children:[e.duration," min"]}):null]},e.id)})})]})}function d({label:e,value:t}){return(0,l.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",gap:12,padding:"10px 0",borderBottom:"1px solid #f1f5f9"},children:[(0,l.jsx)("div",{style:{fontWeight:950,opacity:.7},children:e}),(0,l.jsx)("div",{style:{fontWeight:950},children:t||"—"})]})}const c={position:"fixed",inset:0,background:"rgba(2,6,23,.55)",zIndex:999999,display:"flex",alignItems:"center",justifyContent:"center",padding:14},u={width:"min(980px, 100%)",height:"min(86vh, 720px)",background:"#fff",borderRadius:20,overflow:"hidden",display:"flex",flexDirection:"column",boxShadow:"0 30px 80px rgba(0,0,0,.35)"},f={padding:14,borderBottom:"1px solid #eef2f7",display:"flex",justifyContent:"space-between",alignItems:"center"},g={padding:14,borderTop:"1px solid #eef2f7",display:"flex",justifyContent:"space-between",alignItems:"center",gap:10},p={margin:"0 0 10px 0"},h={display:"grid",gap:12,gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))"},x={border:"1px solid #e5e7eb",borderRadius:16,padding:12,cursor:"pointer",display:"grid",gap:8,textAlign:"left"},y={width:"100%",height:110,borderRadius:14,objectFit:"cover",background:"#f3f4f6",border:"1px solid #eef2f7"},b={background:"#4318ff",color:"#fff",border:"none",borderRadius:12,padding:"10px 12px",fontWeight:950,cursor:"pointer"},m={background:"#eef2ff",color:"#1e1b4b",border:"1px solid rgba(67,24,255,.15)",borderRadius:12,padding:"10px 12px",fontWeight:950,cursor:"pointer"},j={width:34,height:34,borderRadius:12,border:"1px solid #e5e7eb",background:"#fff",cursor:"pointer",fontWeight:900,fontSize:18},v={background:"#fef2f2",border:"1px solid #fecaca",color:"#991b1b",padding:10,borderRadius:12,fontWeight:900,marginBottom:10};document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("bp-front-root");if(!e)return;const t=(0,n.H)(e);document.addEventListener("click",i=>{const n=i.target;n instanceof Element&&n.closest(".bp-open-wizard")&&(i.preventDefault(),e.style.display="block",t.render((0,l.jsx)(o,{onClose:()=>{t.render(null),e.style.display="none"}})))})})})();