(()=>{var e={338(e,t,n){"use strict";var r=n(795);t.H=r.createRoot,r.hydrateRoot},556(e,t,n){e.exports=n(694)()},694(e,t,n){"use strict";var r=n(925);function a(){}function s(){}s.resetWarningCache=a,e.exports=function(){function e(e,t,n,a,s,i){if(i!==r){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:s,resetWarningCache:a};return n.PropTypes=n,n}},795(e){"use strict";e.exports=window.ReactDOM},925(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}(()=>{"use strict";const e=window.React;var t=n(338);async function r(e,t={}){var n;const r=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",a=window.BP_FRONT?.nonce,s=await fetch(`${r}${e}`,{...t,headers:{"Content-Type":"application/json",...a?{"X-WP-Nonce":a}:{},...t.headers||{}}}),i=await s.json().catch(()=>({}));if(!s.ok||"error"===i?.status)throw new Error(i?.message||"Request failed");return null!==(n=i?.data)&&void 0!==n?n:i}const a=({service_id:e})=>r("/front/extras",{method:"POST",body:JSON.stringify({service_id:e})}),s=({service_id:e,location_id:t})=>r("/front/agents",{method:"POST",body:JSON.stringify({service_id:e,location_id:t})}),i=async()=>{const e=await r("/front/form-fields/active");if(e&&e.form&&e.customer&&e.booking)return e;const t=await r("/front/form-fields"),n=[],a=[],s=[];return(Array.isArray(t)?t:[]).forEach(e=>{const t=e.scope||"customer";"booking"===t?s.push(e):"form"===t?n.push(e):a.push(e)}),{form:n,customer:a,booking:s}};function o(e,t){const n=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return e?.image_url||e?.image||""||n+t}const c=window.ReactJSXRuntime;function l({locations:e,value:t,onChange:n,onNext:r,nextLabel:a="Next ->"}){const s=e||[],i=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-list",children:[s.map(e=>(0,c.jsx)("button",{type:"button",className:String(t)===String(e.id)?"bp-card active":"bp-card",onClick:()=>n(e.id),children:(0,c.jsxs)("div",{className:"bp-card-row",children:[(0,c.jsx)("img",{className:"bp-card-thumb",src:o(e,"location-image.png"),alt:""}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"bp-card-title",children:e.name}),(0,c.jsx)("div",{className:"bp-card-sub",children:e.address||""})]})]})},e.id)),s.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No locations found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("div",{}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!i,onClick:()=>r(),children:a})]})]})}function d({categories:e,value:t,onChange:n,onBack:r,onNext:a,backLabel:s="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=(t||[]).length>0;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-list",children:[l.map(e=>{const r=(t||[]).some(t=>String(t)===String(e.id));return(0,c.jsx)("button",{type:"button",className:r?"bp-card active":"bp-card",onClick:()=>{return t=e.id,void n([t]);var t},children:(0,c.jsxs)("div",{className:"bp-card-row",children:[(0,c.jsx)("img",{className:"bp-card-thumb",src:o(e,"service-image.png"),alt:""}),(0,c.jsx)("div",{className:"bp-card-title",children:e.name})]})},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No categories found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:r,children:s}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:a,children:i})]})]})}function u({services:e,value:t,onChange:n,onBack:r,onNext:a,backLabel:s="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[l.map(e=>{const r=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:r?"bp-pickcard active":"bp-pickcard",onClick:()=>n(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:o(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description}),(0,c.jsxs)("div",{className:"bp-meta",children:[!!e.duration&&(0,c.jsxs)("span",{className:"bp-chip",children:[e.duration," min"]}),!!e.category_name&&(0,c.jsx)("span",{className:"bp-chip ghost",children:e.category_name})]})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Select"})}),(0,c.jsx)("div",{className:r?"bp-radio on":"bp-radio"})]})]},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No services found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:r,children:s}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:a,children:i})]})]})}function p({extras:e,value:t,onChange:n,onBack:r,onNext:a,backLabel:s="<- Back",nextLabel:i="Next ->"}){const l=e||[];return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[l.map(e=>{const r=(t||[]).some(t=>String(t)===String(e.id));return(0,c.jsxs)("button",{type:"button",className:r?"bp-pickcard active":"bp-pickcard",onClick:()=>function(e){const r=String(e),a=(t||[]).some(e=>String(e)===r)?(t||[]).filter(e=>String(e)!==r):[...t||[],e];n(a)}(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:o(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),(e.description||e.desc||e.summary)&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description||e.desc||e.summary})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Extra"})}),(0,c.jsx)("div",{className:r?"bp-check on":"bp-check"})]})]},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No extras for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:r,children:s}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!1,onClick:a,children:i})]})]})}function m({agents:e,value:t,onChange:n,onBack:r,onNext:a,backLabel:s="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[l.map(e=>{const r=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:r?"bp-pickcard active":"bp-pickcard",onClick:()=>n(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-avatar",src:o(e,"default-avatar.jpg"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.title&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.title}),!!e.email&&(0,c.jsx)("div",{className:"bp-pickcard-sub small",children:e.email})]}),(0,c.jsx)("div",{className:"bp-pickcard-right",children:(0,c.jsx)("div",{className:r?"bp-radio on":"bp-radio"})})]},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No agents available for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:r,children:s}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:a,children:i})]})]})}const b=(e,t,n)=>new Date(Date.UTC(e,t,n,12,0,0)),f=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,h=(e,t)=>b(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+t),g=e=>{const t=new Date,n=b(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return e.getTime()<n.getTime()};async function y(e,t,{signal:n}={}){const r=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",a=window.BP_FRONT?.nonce,s=await fetch(`${r}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...a?{"X-WP-Nonce":a}:{}},body:JSON.stringify(t),signal:n,credentials:"same-origin"}),i=await s.text();let o;try{o=JSON.parse(i)}catch(e){o={ok:!1,raw:i}}if(!s.ok){const e=o?.message||o?.raw||`HTTP ${s.status}`;throw new Error(e)}return o}function v({serviceId:t,agentId:n,locationId:r,valueDate:a,valueSlot:s,onChangeDate:i,onChangeSlot:o,onBack:l,onNext:d,backLabel:u="<- Back",nextLabel:p="Next ->"}){const[m,v]=(0,e.useState)(()=>{const e=new Date;return b(e.getUTCFullYear(),e.getUTCMonth(),1)}),[x,j]=(0,e.useState)(a||null),[k,N]=(0,e.useState)([]),[w,S]=(0,e.useState)(!1),[_,C]=(0,e.useState)([]),[P,E]=(0,e.useState)(!1),[O,T]=(0,e.useState)(""),I=(0,e.useRef)(new Map),L=(0,e.useRef)(new Map),$=(0,e.useRef)(null),B=(0,e.useRef)(null),R=(0,e.useMemo)(()=>{var e;return`${m.getUTCFullYear()}-${e=m.getUTCMonth()+1,String(e).padStart(2,"0")}`},[m]),M=(0,e.useMemo)(()=>({service_id:t,agent_id:n,location_id:r,month:R}),[t,n,r,R]);(0,e.useEffect)(()=>{if(!t||!n)return;const e=JSON.stringify(M);if(I.current.has(e))return void N(I.current.get(e));$.current&&$.current.abort();const r=new AbortController;$.current=r,S(!0),y("/front/availability/month",M,{signal:r.signal}).then(t=>{const n=t?.data?.days||[];I.current.set(e,n),N(n)}).catch(()=>{}).finally(()=>S(!1))},[M,t,n]),(0,e.useEffect)(()=>{a&&a!==x&&j(a)},[a]);const A=(0,e.useMemo)(()=>({service_id:t,agent_id:n,location_id:r,date:x}),[t,n,r,x]);(0,e.useEffect)(()=>{if(!x||!t||!n)return;const e=JSON.stringify(A);if(L.current.has(e))return void C(L.current.get(e));B.current&&B.current.abort();const r=new AbortController;B.current=r,E(!0),C([]),T(""),y("/front/availability/day",A,{signal:r.signal}).then(t=>{const n=t?.slots||[];L.current.set(e,n),C(n)}).catch(e=>{"AbortError"!==e.name&&(C([]),T("No available times for this date."))}).finally(()=>E(!1))},[A,x,t,n]);const U=(0,e.useMemo)(()=>{const e=new Map;return k.forEach(t=>e.set(t.date,t)),e},[k]),F=(0,e.useMemo)(()=>(e=>{const t=b((n=e).getUTCFullYear(),n.getUTCMonth(),1);var n;const r=(e=>(e.getUTCDay()+6)%7)(t),a=h(t,-r);return Array.from({length:42},(e,t)=>h(a,t))})(m),[m]),D=!!x&&!!s?.start_time;return(0,c.jsxs)("div",{className:"bp-step bp-datetime",children:[(0,c.jsxs)("div",{className:"bp-calendar",children:[(0,c.jsxs)("div",{className:"bp-cal-header",children:[(0,c.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>v(e=>b(e.getUTCFullYear(),e.getUTCMonth()-1,1)),children:"<"}),(0,c.jsx)("div",{className:"bp-cal-title",children:m.toLocaleString(void 0,{month:"long",year:"numeric",timeZone:"UTC"})}),(0,c.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>v(e=>b(e.getUTCFullYear(),e.getUTCMonth()+1,1)),children:">"})]}),(0,c.jsx)("div",{className:"bp-cal-weekdays",children:["M","T","W","T","F","S","S"].map(e=>(0,c.jsx)("div",{className:"bp-cal-wd",children:e},e))}),(0,c.jsx)("div",{className:"bp-cal-grid",children:F.map((e,t)=>{const n=(a=m,(r=e).getUTCFullYear()===a.getUTCFullYear()&&r.getUTCMonth()===a.getUTCMonth());var r,a;const s=g(e)||!n,l=f(e),d=x===l,u=U.get(l),p=!!u&&u.has_slots;return(0,c.jsxs)("button",{type:"button",className:`bp-cal-day ${n?"":"is-out"} ${d?"is-selected":""}`,disabled:s,onClick:()=>function(e){if(g(e))return;const t=f(e);o?.(null),i?.(t)}(e),children:[(0,c.jsx)("div",{children:e.getUTCDate()}),(0,c.jsx)("div",{style:{height:4,width:28,borderRadius:999,margin:"6px auto 0",background:p?"#22c55e":"#e5e7eb",opacity:w&&!u?.3:1}})]},`${l}-${t}`)})})]}),(0,c.jsxs)("div",{className:"bp-slots",children:[(0,c.jsxs)("div",{className:"bp-slots-title",children:["Pick a slot for ",(0,c.jsx)("strong",{children:x||"—"})]}),!x&&(0,c.jsx)("div",{className:"bp-muted",children:"Select a date to see available times."}),x&&P&&(0,c.jsxs)("div",{className:"bp-slot-skeleton",children:[(0,c.jsx)("div",{className:"bp-skel"}),(0,c.jsx)("div",{className:"bp-skel"}),(0,c.jsx)("div",{className:"bp-skel"})]}),x&&!P&&O&&(0,c.jsx)("div",{className:"bp-error",children:O}),x&&!P&&!O&&(0,c.jsxs)("div",{className:"bp-slot-grid",children:[_.map((e,t)=>(0,c.jsx)("button",{type:"button",className:"bp-slot "+(s?.start_time===e.time?"is-selected":""),onClick:()=>o?.({start_time:e.time,end_time:e.end||""}),children:e.time},`${e.time}-${t}`)),0===_.length&&(0,c.jsx)("div",{className:"bp-muted",children:"No times found for this date."})]})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:l,children:u}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!D,onClick:d,children:p})]})]})}function x(e){return e?.id||e?.field_key||e?.name_key||""}function j(e){var t,n;return e&&"object"==typeof e?null!==(t=null!==(n=e.label)&&void 0!==n?n:e.value)&&void 0!==t?t:"":String(e)}function k(e){var t,n;return e&&"object"==typeof e?null!==(t=null!==(n=e.value)&&void 0!==n?n:e.label)&&void 0!==t?t:"":String(e)}function N({defs:e=[],layout:t=[],values:n,onChange:r,scope:a}){const s=t.map(t=>({layout:t,def:e.find(e=>x(e)===t.id)})).filter(e=>!!e.def),i=(e,t)=>{const s=a?`${a}.${e}`:e;r({...n||{},[s]:t})};return(0,c.jsx)("div",{className:"bp-fields-grid",children:s.map(({layout:e,def:t})=>{var r,s,o;const l=x(t),d=null!==(r=e.required)&&void 0!==r?r:!!(null!==(s=t.is_required)&&void 0!==s?s:t.required),u="half"===e.width?"half":"full",p=a?`${a}.${l}`:l,m=null!==(o=(n||{})[p])&&void 0!==o?o:"",b=(0,c.jsxs)("label",{className:"bp-label",children:[t.label," ",d?(0,c.jsx)("span",{className:"bp-req",children:"*"}):null]});if("textarea"===t.type)return(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("textarea",{className:"bp-textarea",placeholder:t.placeholder||"",value:m,onChange:e=>i(l,e.target.value)})]},p);if("select"===t.type){const e=Array.isArray(t.options)?t.options:t.options?.choices||[];return(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsxs)("select",{className:"bp-select",value:m,onChange:e=>i(l,e.target.value),children:[(0,c.jsx)("option",{value:"",children:"Select…"}),e.map((e,t)=>(0,c.jsx)("option",{value:k(e),children:j(e)},t))]})]},p)}return"checkbox"===t.type?(0,c.jsx)("div",{className:`bp-field bp-${u}`,children:(0,c.jsxs)("label",{className:"bp-checkbox-row",children:[(0,c.jsx)("input",{type:"checkbox",checked:!!m,onChange:e=>i(l,e.target.checked)}),(0,c.jsxs)("span",{children:[t.label," ",d?(0,c.jsx)("span",{className:"bp-req",children:"*"}):null]})]})},p):"date"===t.type?(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("input",{className:"bp-input-field",type:"date",value:m,onChange:e=>i(l,e.target.value)})]},p):(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("input",{className:"bp-input-field",type:"tel"===t.type?"tel":"email"===t.type?"email":"text",placeholder:t.placeholder||"",value:m,onChange:e=>i(l,e.target.value)})]},p)})})}function w(e,t){return"checkbox"===t?!e:null==e||(Array.isArray(e)?0===e.length:""===String(e).trim())}function S(e){return e?.id||e?.field_key||e?.name_key||""}function _(e=[]){return e.map(e=>{var t,n;return{id:S(e),required:!(null===(t=null!==(n=e?.is_required)&&void 0!==n?n:e?.required)||void 0===t||!t),width:"full"}}).filter(e=>e.id)}function C({formFields:e,answers:t,onChange:n,onBack:r,onNext:a,onError:s,layout:i,backLabel:o="<- Back",nextLabel:l="Next ->"}){const d=e?.customer||[],u=e?.booking||[],p=i?.customer?.fields?.length?i.customer.fields:_(d),m=i?.booking?.fields?.length?i.booking.fields:_(u);function b(e,t){n(e&&"object"==typeof e&&void 0===t?e:n=>({...n,[e]:t}))}function f(e){var n;return null!==(n=t?.[e])&&void 0!==n?n:""}return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)(N,{defs:d,layout:p,values:t,onChange:b,scope:"customer"}),u.length?(0,c.jsx)("div",{style:{marginTop:14},children:(0,c.jsx)(N,{defs:u,layout:m,values:t,onChange:b,scope:"booking"})}):null,(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:r,children:o}),(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:function(){const e=[{scope:"customer",defs:d,layout:p},{scope:"booking",defs:u,layout:m}];for(const a of e)for(const e of a.layout){var t,n,r;const i=a.defs.find(t=>S(t)===e.id);if(i&&((null!==(t=e.required)&&void 0!==t?t:null!==(n=null!==(r=i.is_required)&&void 0!==r?r:i.required)&&void 0!==n&&n)&&w(f(`${a.scope}.${e.id}`),i.type)))return void s?.(`${i.label||e.id} is required`)}s?.(""),a()},children:l})]})]})}const P={free:"Free (no payment)",cash:"Pay at location (Cash)",woocommerce:"Pay with card",stripe:"Pay with Stripe",paypal:"Pay with PayPal"},E={cash:"Pay when you arrive.",free:"No payment required.",woocommerce:"Visa / MasterCard / Amex and more.",stripe:"Secure card payment via Stripe.",paypal:"Pay using PayPal account or card."},O={cash:"payment_type_cash.png",free:"payment_later.png",woocommerce:"payment_type_cards.png",stripe:"processor-stripe.png",paypal:"processor-paypal.png"};function T({enabledMethods:e=["cash"],selected:t,onSelect:n,totalLabel:r="-",imagesBase:a="",onBack:s,onNext:i,backLabel:o="<- Back",nextLabel:l="Next ->",loading:d=!1}){const u=Array.isArray(e)&&e.length?e:["cash"],p=a||(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-card-lite bp-p-14",children:[(0,c.jsx)("div",{className:"bp-font-900",children:"Payment Method"}),(0,c.jsxs)("div",{className:"bp-text-sm bp-muted bp-mt-6",children:["Total: ",(0,c.jsx)("strong",{children:r})]}),(0,c.jsx)("div",{className:"bp-mt-12 bp-pay-grid",children:u.map(e=>(0,c.jsxs)("button",{type:"button",className:"bp-pay-option "+(t===e?"is-active":""),onClick:()=>n?.(e),children:[(0,c.jsx)("div",{className:"bp-pay-logo",children:O[e]?(0,c.jsx)("img",{src:`${p}${O[e]}`,alt:""}):null}),(0,c.jsxs)("div",{className:"bp-pay-meta",children:[(0,c.jsx)("div",{className:"bp-font-800",children:P[e]||e}),(0,c.jsx)("div",{className:"bp-text-xs bp-muted",children:E[e]||""})]})]},e))})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:o}),(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:i,disabled:d,children:l})]})]})}function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}var L,$="clover",B="https://js.stripe.com",R="".concat(B,"/").concat($,"/stripe.js"),M=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,A=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,U="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",F=function(e){return M.test(e)||A.test(e)},D=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(R).concat(t);var r=document.head||document.body;if(!r)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return r.appendChild(n),n},q=null,Y=null,J=null,W=!1,z=function(){return L||(L=(e=null,null!==q?q:(q=new Promise(function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(U),window.Stripe)t(window.Stripe);else try{var r=function(){for(var e=document.querySelectorAll('script[src^="'.concat(B,'"]')),t=0;t<e.length;t++){var n=e[t];if(F(n.src))return n}return null}();if(r&&e)console.warn(U);else if(r){if(r&&null!==J&&null!==Y){var a;r.removeEventListener("load",J),r.removeEventListener("error",Y),null===(a=r.parentNode)||void 0===a||a.removeChild(r),r=D(e)}}else r=D(e);J=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),Y=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),r.addEventListener("load",J),r.addEventListener("error",Y)}catch(e){return void n(e)}else t(null)})).catch(function(e){return q=null,Promise.reject(e)})).catch(function(e){return L=null,Promise.reject(e)}));var e};Promise.resolve().then(function(){return z()}).catch(function(e){W||console.warn(e)});var H=n(556);function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach(function(t){Z(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function V(e){return V="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V(e)}function Z(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var r,a,s=[],_n=!0,i=!1;try{for(n=n.call(e);!(_n=(r=n.next()).done)&&(s.push(r.value),!t||s.length!==t);_n=!0);}catch(e){i=!0,a=e}finally{try{_n||null==n.return||n.return()}finally{if(i)throw a}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Q(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ee=function(t,n,r){var a=!!r,s=e.useRef(r);e.useEffect(function(){s.current=r},[r]),e.useEffect(function(){if(!a||!t)return function(){};var e=function(){s.current&&s.current.apply(s,arguments)};return t.on(n,e),function(){t.off(n,e)}},[a,n,t,s])},te=function(t){var n=e.useRef(t);return e.useEffect(function(){n.current=t},[t]),n.current},ne=function(e){return null!==e&&"object"===V(e)},re="[object Object]",ae=function e(t,n){if(!ne(t)||!ne(n))return t===n;var r=Array.isArray(t);if(r!==Array.isArray(n))return!1;var a=Object.prototype.toString.call(t)===re;if(a!==(Object.prototype.toString.call(n)===re))return!1;if(!a&&!r)return t===n;var s=Object.keys(t),i=Object.keys(n);if(s.length!==i.length)return!1;for(var o={},c=0;c<s.length;c+=1)o[s[c]]=!0;for(var l=0;l<i.length;l+=1)o[i[l]]=!0;var d=Object.keys(o);if(d.length!==s.length)return!1;var u=t,p=n;return d.every(function(t){return e(u[t],p[t])})},se=function(e,t,n){return ne(e)?Object.keys(e).reduce(function(r,a){var s=!ne(t)||!ae(e[a],t[a]);return n.includes(a)?(s&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),r):s?X(X({},r||{}),{},Z({},a,e[a])):r},null):null},ie="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",oe=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ie;if(null===e||ne(t=e)&&"function"==typeof t.elements&&"function"==typeof t.createToken&&"function"==typeof t.createPaymentMethod&&"function"==typeof t.confirmCardPayment)return e;throw new Error(n)},ce=e.createContext(null);ce.displayName="ElementsContext";var le=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},de=function(t){var n=t.stripe,r=t.options,a=t.children,s=e.useMemo(function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ie;if(function(e){return ne(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return oe(e,t)})};var n=oe(e,t);return null===n?{tag:"empty"}:{tag:"sync",stripe:n}}(n)},[n]),i=G(e.useState(function(){return{stripe:"sync"===s.tag?s.stripe:null,elements:"sync"===s.tag?s.stripe.elements(r):null}}),2),o=i[0],c=i[1];e.useEffect(function(){var e=!0,t=function(e){c(function(t){return t.stripe?t:{stripe:e,elements:e.elements(r)}})};return"async"!==s.tag||o.stripe?"sync"!==s.tag||o.stripe||t(s.stripe):s.stripePromise.then(function(n){n&&e&&t(n)}),function(){e=!1}},[s,o,r]);var l=te(n);e.useEffect(function(){null!==l&&l!==n&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[l,n]);var d=te(r);return e.useEffect(function(){if(o.elements){var e=se(r,d,["clientSecret","fonts"]);e&&o.elements.update(e)}},[r,d,o.elements]),e.useEffect(function(){var e;(e=o.stripe)&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"5.5.0"}),e.registerAppInfo({name:"react-stripe-js",version:"5.5.0",url:"https://stripe.com/docs/stripe-js/react"}))},[o.stripe]),e.createElement(ce.Provider,{value:o},a)};de.propTypes={stripe:H.any,options:H.object};H.func.isRequired;var ue=e.createContext(null);ue.displayName="CheckoutContext",H.any,H.shape({clientSecret:H.oneOfType([H.string,H.instanceOf(Promise)]).isRequired,elementsOptions:H.object}).isRequired;var pe=function(t){var n=e.useContext(ue),r=e.useContext(ce);if(n){if(r)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CheckoutProvider> and <Elements> providers."));return n}return le(r,t)},me=["mode"],be=function(t,n){var r,a="".concat((r=t).charAt(0).toUpperCase()+r.slice(1),"Element"),s=n?function(t){pe("mounts <".concat(a,">"));var n=t.id,r=t.className;return e.createElement("div",{id:n,className:r})}:function(n){var r,s=n.id,i=n.className,o=n.options,c=void 0===o?{}:o,l=n.onBlur,d=n.onFocus,u=n.onReady,p=n.onChange,m=n.onEscape,b=n.onClick,f=n.onLoadError,h=n.onLoaderStart,g=n.onNetworksChange,y=n.onConfirm,v=n.onCancel,x=n.onShippingAddressChange,j=n.onShippingRateChange,k=n.onSavedPaymentMethodRemove,N=n.onSavedPaymentMethodUpdate,w=pe("mounts <".concat(a,">")),S="elements"in w?w.elements:null,_="checkoutState"in w?w.checkoutState:null,C="success"===(null==_?void 0:_.type)||"loading"===(null==_?void 0:_.type)?_.sdk:null,P=G(e.useState(null),2),E=P[0],O=P[1],T=e.useRef(null),I=e.useRef(null);ee(E,"blur",l),ee(E,"focus",d),ee(E,"escape",m),ee(E,"click",b),ee(E,"loaderror",f),ee(E,"loaderstart",h),ee(E,"networkschange",g),ee(E,"confirm",y),ee(E,"cancel",v),ee(E,"shippingaddresschange",x),ee(E,"shippingratechange",j),ee(E,"savedpaymentmethodremove",k),ee(E,"savedpaymentmethodupdate",N),ee(E,"change",p),u&&(r="expressCheckout"===t?u:function(){u(E)}),ee(E,"ready",r),e.useLayoutEffect(function(){if(null===T.current&&null!==I.current&&(S||C)){var e=null;if(C)switch(t){case"paymentForm":e=C.createPaymentFormElement(c);break;case"payment":e=C.createPaymentElement(c);break;case"address":if(!("mode"in c))throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");var n=c.mode,r=function(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}(c,me);if("shipping"===n)e=C.createShippingAddressElement(r);else{if("billing"!==n)throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.");e=C.createBillingAddressElement(r)}break;case"expressCheckout":e=C.createExpressCheckoutElement(c);break;case"currencySelector":e=C.createCurrencySelectorElement();break;case"taxId":e=C.createTaxIdElement(c);break;default:throw new Error("Invalid Element type ".concat(a,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else S&&(e=S.create(t,c));T.current=e,O(e),e&&e.mount(I.current)}},[S,C,c]);var L=te(c);return e.useEffect(function(){if(T.current){var e=se(c,L,["paymentRequest"]);e&&"update"in T.current&&T.current.update(e)}},[c,L]),e.useLayoutEffect(function(){return function(){if(T.current&&"function"==typeof T.current.destroy)try{T.current.destroy(),T.current=null}catch(e){}}},[]),e.createElement("div",{id:s,className:i,ref:I})};return s.propTypes={id:H.string,className:H.string,onChange:H.func,onBlur:H.func,onFocus:H.func,onReady:H.func,onEscape:H.func,onClick:H.func,onLoadError:H.func,onLoaderStart:H.func,onNetworksChange:H.func,onConfirm:H.func,onCancel:H.func,onShippingAddressChange:H.func,onShippingRateChange:H.func,onSavedPaymentMethodRemove:H.func,onSavedPaymentMethodUpdate:H.func,options:H.object},s.displayName=a,s.__elementType=t,s},fe="undefined"==typeof window;e.createContext(null).displayName="EmbeddedCheckoutProviderContext",be("auBankAccount",fe),be("card",fe),be("cardNumber",fe),be("cardExpiry",fe),be("cardCvc",fe),be("iban",fe);var he=be("payment",fe);function ge({bookingId:t,onPaid:n,onError:r}){const a=pe("calls useStripe()").stripe,s=(u="calls useElements()",p=e.useContext(ce),le(p,u)).elements,[i,o]=(0,e.useState)(!1),[l,d]=(0,e.useState)("");var u,p;return(0,c.jsxs)("div",{className:"bp-pay-card",children:[(0,c.jsx)("div",{className:"bp-pay-box",children:(0,c.jsx)(he,{})}),l?(0,c.jsx)("div",{className:"bp-error",children:l}):null,(0,c.jsx)("button",{className:"bp-btn bp-btn-primary",onClick:async()=>{if(d(""),a&&s){o(!0);try{const{error:e,paymentIntent:i}=await a.confirmPayment({elements:s,confirmParams:{return_url:window.location.href},redirect:"if_required"});if(e)return d(e.message||"Payment failed"),void r?.(e.message||"Payment failed");const o=await fetch("/wp-json/bp/v1/front/payment/stripe/confirm",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({booking_id:t,payment_intent_id:i?.id,status:i?.status})}),c=await o.json();c?.success?n?.():d("Payment not completed yet. Please try again.")}catch(e){const t=e?.message||"Payment error";d(t),r?.(t)}finally{o(!1)}}},disabled:!a||i,children:i?"Processing...":"Pay now"})]})}function ye({bookingId:t,publishableKey:n,amountLabel:r,onPaid:a,onError:s}){const i=(0,e.useMemo)(()=>function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];W=!0;var r=Date.now();return z().then(function(e){return function(e,t,n){if(null===e)return null;var r=t[0];if("string"!=typeof r)throw new Error("Expected publishable key to be of type string, got type ".concat(I(r)," instead."));var a=r.match(/^pk_test/),s=function(e){return 3===e?"v3":e}(e.version),i=$;a&&s!==i&&console.warn("Stripe.js@".concat(s," was loaded on the page, but @stripe/stripe-js@").concat("8.6.4"," expected Stripe.js@").concat(i,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var o=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"8.6.4",startTime:t})}(o,n),o}(e,t,r)})}(n),[n]),[o,l]=(0,e.useState)(""),[d,u]=(0,e.useState)(!1),[p,m]=(0,e.useState)("");return(0,e.useEffect)(()=>{t&&!o&&(async()=>{m(""),u(!0);try{const e=await fetch("/wp-json/bp/v1/front/payment/stripe/start",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify({booking_id:t})}),n=await e.json();if(!n?.success||!n?.client_secret)throw new Error(n?.message||"Could not start payment.");l(n.client_secret)}catch(e){m(e?.message||"Stripe start error"),s?.(e?.message||"Stripe start error")}finally{u(!1)}})()},[t,o]),n?(0,c.jsxs)("div",{className:"bp-payment-step",children:[(0,c.jsxs)("div",{className:"bp-h-row",children:[(0,c.jsx)("h3",{children:"Payment"}),(0,c.jsx)("div",{className:"bp-amount",children:r})]}),p?(0,c.jsx)("div",{className:"bp-error",children:p}):null,d&&!o?(0,c.jsx)("div",{className:"bp-muted",children:"Preparing secure payment..."}):null,o?(0,c.jsx)(de,{stripe:i,options:{clientSecret:o},children:(0,c.jsx)(ge,{bookingId:t,onPaid:a,onError:s})}):null]}):(0,c.jsx)("div",{className:"bp-error",children:"Stripe publishable key missing."})}function ve({locationId:t,categoryIds:n,serviceId:r,extraIds:a,agentId:s,date:i,slot:o,locations:l,categories:d,services:u,extras:p,agents:m,formFields:b,answers:f,paymentMethodLabel:h,totalLabel:g,onBack:y,onNext:v,isCreatingBooking:x,createError:j,loading:k,backLabel:N="<- Back",nextLabel:w="Next ->"}){const S=l.find(e=>String(e.id)===String(t)),_=u.find(e=>String(e.id)===String(r)),C=m.find(e=>String(e.id)===String(s)),P=d.filter(e=>n.includes(e.id)||n.includes(String(e.id))),E=p.filter(e=>a.includes(e.id)||a.includes(String(e.id))),O=(0,e.useMemo)(()=>[...b?.form||[],...b?.customer||[],...b?.booking||[]],[b]);return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-review",children:[(0,c.jsx)(xe,{label:"Location",value:S?.name}),(0,c.jsx)(xe,{label:"Categories",value:P.length?P.map(e=>e.name).join(", "):"-"}),(0,c.jsx)(xe,{label:"Service",value:_?.name}),(0,c.jsx)(xe,{label:"Agent",value:C?.name}),(0,c.jsx)(xe,{label:"Date",value:i}),(0,c.jsx)(xe,{label:"Time",value:o?.start_time?`${o.start_time} - ${o.end_time}`:"-"}),(0,c.jsx)(xe,{label:"Extras",value:E.length?E.map(e=>e.name).join(", "):"-"}),h?(0,c.jsx)(xe,{label:"Payment Method",value:h}):null,g?(0,c.jsx)(xe,{label:"Total",value:g}):null,(0,c.jsx)("div",{className:"bp-review-section",children:"Customer Information"}),O.map(e=>{var t;const n=e.field_key||e.name_key||"",r=`${e.scope}.${n}`;let a=null!==(t=f?.[r])&&void 0!==t?t:"";return"checkbox"===e.type&&(a="1"===a?"Yes":"No"),(0,c.jsx)(xe,{label:e.label,value:String(a||"")},r)})]}),j?(0,c.jsx)("div",{className:"bp-alert bp-alert-error bp-mt-12",children:j}):null,(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:y,children:N}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:k||x,onClick:v,children:x?"Preparing payment...":k?"Submitting...":w})]})]})}function xe({label:e,value:t}){return(0,c.jsxs)("div",{className:"bp-review-row",children:[(0,c.jsx)("div",{className:"k",children:e}),(0,c.jsx)("div",{className:"v",children:t||"-"})]})}function je({booking:e,confirmData:t,returnLoading:n,returnError:r,onRetry:a,onClose:s}){const i=!0===t?.paid,o=!0===t?.pending,l=t?.error||r||"",d=t?.booking?.id||e?.booking_id||t?.booking_id,u=t&&!i&&!o;let p="Booking confirmed";return i?p="Paid & confirmed":o?p="Payment processing":(u||l)&&(p="Payment cancelled/failed"),(0,c.jsx)("div",{className:"bp-step bp-done",children:(0,c.jsxs)("div",{className:"bp-done-card",children:[(0,c.jsx)("div",{className:"bp-done-title",children:p}),n?(0,c.jsx)("div",{className:"bp-done-sub",children:"Processing payment..."}):null,!n&&l?(0,c.jsx)("div",{className:"bp-done-sub",children:l}):null,!n&&o?(0,c.jsx)("div",{className:"bp-done-sub",children:"Payment is still processing. Please refresh or wait."}):null,d?(0,c.jsxs)("div",{className:"bp-done-sub",children:["Booking ID: ",d]}):null,e?.manage_url?(0,c.jsx)("a",{className:"bp-done-link",href:e.manage_url,target:"_blank",rel:"noreferrer",children:"Manage your booking"}):null,(0,c.jsxs)("div",{className:"bp-done-actions",children:[u?(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:a,children:"Retry payment"}):null,(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:s,children:"Close"})]})]})})}be("expressCheckout",fe),be("paymentRequestButton",fe),be("linkAuthentication",fe),be("address",fe),be("shippingAddress",fe),be("paymentMethodMessaging",fe),be("taxId",fe);let ke="undefined"!=typeof window&&window.BP_FRONT?.settings||null;const Ne=["location","category","service","extras","agent","datetime","customer","review","payment","done"],we=[{key:"location",title:"Location Selection",icon:"location-image.png"},{key:"category",title:"Choose Category",icon:"service-image.png"},{key:"service",title:"Choose Service",icon:"service-image.png"},{key:"extras",title:"Service Extras",icon:"service-image.png"},{key:"agent",title:"Choose Agent",icon:"default-avatar.jpg"},{key:"datetime",title:"Choose Date & Time",icon:"blue-dot.png"},{key:"customer",title:"Customer Information",icon:"default-avatar.jpg"},{key:"review",title:"Review Order",icon:"white-curve.png"},{key:"payment",title:"Payment",icon:"payment_now.png"},{key:"done",title:"Confirm",icon:"logo.png"}];function Se(){return(window.BP_FRONT?.restUrl||"/wp-json/bp/v1").replace(/\/$/,"")}async function _e(e){const t=await fetch(`${Se()}/front/bookings/${e}/status?_t=${Date.now()}`,{credentials:"same-origin"}),n=await t.json().catch(()=>({}));if(!t.ok)throw new Error(n?.message||"Status fetch failed");return n.booking}function Ce({open:t,onClose:n,brand:o}){const[b,f]=(0,e.useState)(0),{config:h,loading:g,error:y}=function(t){const[n,r]=(0,e.useState)(!1),[a,s]=(0,e.useState)(null),[i,o]=(0,e.useState)("");return(0,e.useEffect)(()=>{if(!t)return;let e=!0;r(!0),o("");const n=`/wp-json/bp/v1/front/booking-form-design?_t=${Date.now()}`;return fetch(n,{credentials:"same-origin"}).then(async e=>{const t=await e.json().catch(()=>null);if(!e.ok)throw new Error(t?.message||`Design fetch failed (${e.status})`);return t}).then(t=>{e&&s(t?.config||null)}).catch(t=>{e&&(s(null),o(t.message||"Design fetch failed"))}).finally(()=>{e&&r(!1)}),()=>{e=!1}},[t]),{config:a,loading:n,error:i}}(t),x=(0,e.useMemo)(()=>function(e){const t=(Array.isArray(e?.steps)?e.steps:[]).filter(e=>e&&e.key&&!1!==e.enabled),n=new Map(we.map(e=>[e.key,e])),r=t.length?function(e=[]){const t=new Set(Ne),n=[];for(const r of e)t.has(r)&&!n.includes(r)&&n.push(r);for(const e of Ne)n.includes(e)||n.push(e);return Ne.filter(e=>n.includes(e))}(t.map(e=>{return"agents"===(t=e.key)?"agent":"confirm"===t||"confirmation"===t?"done":t;var t}).filter(Boolean)).map(e=>({...n.get(e)||{key:e,title:e,icon:"service-image.png"},key:e,title:n.get(e)?.title||e,subtitle:n.get(e)?.subtitle||""})):we.slice(),a=new Set;return r.filter(e=>!a.has(e.key)&&(a.add(e.key),!0))}(h),[h]),{settings:j}=function(t){const[n,r]=(0,e.useState)(ke),[a,s]=(0,e.useState)(!ke&&!!t);return(0,e.useEffect)(()=>{if(!t)return;if(ke)return void r(ke);let e=!0;return s(!0),fetch(`/wp-json/bp/v1/front/settings?_t=${Date.now()}`,{credentials:"same-origin"}).then(e=>e.json()).then(t=>{if(!e)return;const n=t?.settings||null;ke=n,r(n)}).catch(()=>{e&&r(null)}).finally(()=>{e&&s(!1)}),()=>{e=!1}},[t]),{settings:n,loading:a}}(t),[k,N]=(0,e.useState)(null),[w,S]=(0,e.useState)([]),[_,P]=(0,e.useState)(null),[E,O]=(0,e.useState)([]),[I,L]=(0,e.useState)(null),[$,B]=(0,e.useState)(null),[R,M]=(0,e.useState)(null),[A,U]=(0,e.useState)(""),[F,D]=(0,e.useState)(0),[q,Y]=(0,e.useState)(null),[J,W]=(0,e.useState)(!1),[z,H]=(0,e.useState)(null),[K,X]=(0,e.useState)({mode:"",bookingId:0,token:"",action:""}),[V,Z]=(0,e.useState)(!1),[G,Q]=(0,e.useState)(""),[ee,te]=(0,e.useState)(null),[ne,re]=(0,e.useState)({form:[],customer:[],booking:[]}),[ae,se]=(0,e.useState)({}),[ie,oe]=(0,e.useState)([]),[ce,le]=(0,e.useState)([]),[de,ue]=(0,e.useState)([]),[pe,me]=(0,e.useState)([]),[be,fe]=(0,e.useState)([]),[he,ge]=(0,e.useState)(!1),[xe,Ce]=(0,e.useState)(""),Oe=Array.isArray(j?.payments_enabled_methods)&&j.payments_enabled_methods.length?j.payments_enabled_methods:["cash"],Te=0!==j?.payments_enabled,Ie=(0,e.useMemo)(()=>Te?x:x.filter(e=>"payment"!==e.key),[x,Te]),Le=Ie[b]||Ie[0]||we[0],$e=(0,e.useMemo)(()=>{if(Le?.imageUrl)return Le.imageUrl;const e=Le?.icon||Le?.image||"service-image.png";return o?.imagesBase?o.imagesBase+e:""},[o,Le]),Be=h?.texts?.helpTitle||"Need help?",Re=h?.texts?.helpPhone||h?.layout?.helpPhone||o?.helpPhone||"",Me=!1!==Le?.showLeftPanel,Ae=!1!==Le?.showHelpBox,Ue=(0,e.useMemo)(()=>{const e=de.find(e=>String(e.id)===String(_));return(null!=e?.price?Number(e.price):0)+pe.filter(e=>E.includes(e.id)||E.includes(String(e.id))).reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0)},[de,_,pe,E]);function Fe(){Ce(""),"payment"!==Le?.key||A?"payment"!==Le?.key||"stripe"!==A?f(e=>Math.min(e+1,Ie.length-1)):Ce("Please complete the payment."):Ce("Select a payment method")}function De(){Ce(""),f(e=>Math.max(e-1,0))}function qe(e){const t=Ie.findIndex(t=>t.key===e);t>=0&&f(t)}(0,e.useEffect)(()=>{if(t)return document.body.classList.add("bp-modal-open"),()=>document.body.classList.remove("bp-modal-open")},[t]),(0,e.useEffect)(()=>{t&&(f(0),Ce(""),N(null),S([]),P(null),O([]),L(null),B(null),M(null),U(""),D(0),Y(null),W(!1),H(null),X({mode:"",bookingId:0,token:"",action:""}),Z(!1),Q(""),te(null),se({}))},[t]),(0,e.useEffect)(()=>{t&&(Te?!A&&j?.payments_default_method&&U(j.payments_default_method):U("cash"))},[t,j,A,Te]),(0,e.useEffect)(()=>{if(!t)return;const e=new URLSearchParams(window.location.search),n=e.get("bp_payment"),r=e.get("token")||"",a=Number(e.get("booking_id")||0),s="paypal_return"===n||"paypal_cancel"===n;a&&("stripe_success"===n||"stripe_cancel"===n?X({mode:"stripe",bookingId:a,token:"",action:"stripe_cancel"===n?"cancel":"success"}):s&&X({mode:"paypal",bookingId:a,token:r,action:"paypal_cancel"===n?"cancel":"success"}))},[t]),(0,e.useEffect)(()=>{if(!t)return;if(!K.bookingId||!K.mode)return;let e=!0;return Z(!0),Q(""),(async()=>{try{if("cancel"===K.action)throw"paypal"===K.mode&&await fetch(`${Se()}/front/bookings/${K.bookingId}/payment-cancel`,{method:"POST",credentials:"same-origin"}),new Error("Payment cancelled.");if("paypal"===K.mode){if(!K.token)throw await fetch(`${Se()}/front/bookings/${K.bookingId}/payment-cancel`,{method:"POST",credentials:"same-origin"}),new Error("Payment cancelled.");await async function(e,t){const n=await fetch(`${Se()}/front/payments/paypal/capture`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:e,booking_id:t})}),r=await n.json().catch(()=>({}));if(!n.ok)throw new Error(r?.message||"PayPal capture failed");return r}(K.token,K.bookingId)}const t=await async function(e){let t=null;for(let n=0;n<10;n++){const n=await _e(e);if(t=n,"confirmed"===n?.status&&"paid"===n?.payment_status)return n;await new Promise(e=>setTimeout(e,1e3))}return t}(K.bookingId);if(!e)return;se(e=>({...e,__booking:{booking_id:K.bookingId}})),te("confirmed"===t?.status&&"paid"===t?.payment_status?{booking:t,paid:!0,error:""}:{booking:t,paid:!1,error:"",pending:!0}),qe("done")}catch(t){if(!e)return;const n=t?.message||"Payment failed";Q(n),se(e=>({...e,__booking:{booking_id:K.bookingId}})),te({booking:{id:K.bookingId},paid:!1,error:n}),qe("done")}finally{if(!e)return;Z(!1),function(){const e=new URL(window.location.href);e.searchParams.delete("bp_payment"),e.searchParams.delete("booking_id"),e.searchParams.delete("token"),window.history.replaceState({},"",e.toString())}()}})(),()=>{e=!1}},[t,K]),(0,e.useEffect)(()=>{"Select a payment method"===xe&&A&&Ce("")},[xe,A]),(0,e.useEffect)(()=>{t&&(async()=>{try{ge(!0);const[e,t,n]=await Promise.all([r("/front/locations"),r("/front/categories"),i()]);oe(e),le(t),re(n)}catch(e){Ce(e?.message||"Failed to load booking data.")}finally{ge(!1)}})()},[t]),(0,e.useEffect)(()=>{t&&Ie.map(e=>e.key).join("|")&&f(0)},[t,Ie]),(0,e.useEffect)(()=>{f(e=>e<0?0:e>=Ie.length?Math.max(0,Ie.length-1):e)},[Ie.length]),(0,e.useEffect)(()=>{t&&(async()=>{try{if("service"===Le.key||"extras"===Le.key||"agent"===Le.key||"datetime"===Le.key||"review"===Le.key){const e=await(({category_ids:e=[],location_id:t=null})=>r("/front/services",{method:"POST",body:JSON.stringify({category_ids:e,location_id:t})}))({category_ids:w,location_id:k});ue(e)}}catch(e){ue([])}})()},[t,Le.key,w,k]),(0,e.useEffect)(()=>{t&&(async()=>{try{if(!_)return;const[e,t]=await Promise.all([a({service_id:_}),s({service_id:_,location_id:k})]);me(e),fe(t)}catch(e){me([]),fe([])}})()},[t,_,k]);const Ye=()=>{const e={},t={};return Object.entries(ae||{}).forEach(([n,r])=>{n.startsWith("customer.")?e[n.slice(9)]=r:n.startsWith("booking.")&&(t[n.slice(8)]=r)}),{location_id:k,category_ids:w,service_id:_,extra_ids:E,agent_id:I,date:$,start_time:R?.start_time||R?.start||"",end_time:R?.end_time||R?.end||"",field_values:ae,customer_fields:e,booking_fields:t,extras:E,total_price:Ue,currency:j?.currency||"USD"}};return t?g&&!h?(0,c.jsx)("div",{className:"bp-wizard-loading",children:"Loading booking form…"}):y&&!h?(0,c.jsxs)("div",{className:"bp-wizard-loading",children:["Wizard error: ",y]}):Ie.length?(0,c.jsx)("div",{className:"bp-modal-overlay",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"bp-modal",children:[(0,c.jsx)("button",{className:"bp-modal-close",onClick:n,"aria-label":"Close",children:"x"}),(0,c.jsxs)("div",{className:"bp-modal-grid",children:[Me?(0,c.jsxs)("aside",{className:"bp-side",children:[(0,c.jsx)("div",{className:"bp-side-icon",children:$e?(0,c.jsx)("img",{src:$e,alt:""}):null}),(0,c.jsx)("h3",{className:"bp-side-title",children:Le.title}),(0,c.jsx)("p",{className:"bp-side-desc",children:Le.subtitle||"Please complete the steps to schedule your booking."}),Ae?(0,c.jsxs)("div",{className:"bp-side-help",children:[(0,c.jsx)("div",{children:Be}),(0,c.jsx)("div",{className:"bp-help-phone",children:Re})]}):null]}):null,(0,c.jsxs)("main",{className:"bp-main",children:[(0,c.jsxs)("div",{className:"bp-main-head",children:[(0,c.jsx)("h2",{children:Le.title}),(0,c.jsx)("div",{className:"bp-step-dots",children:Ie.slice(0,8).map((e,t)=>(0,c.jsx)("span",{className:t===b?"bp-dot active":"bp-dot"},e.key))})]}),xe?(0,c.jsx)("div",{className:"bp-error",children:xe}):null,he?(0,c.jsx)("div",{className:"bp-loading",children:"Loading..."}):null,"location"===Le.key&&(0,c.jsx)(l,{locations:ie,value:k,onChange:N,onNext:Fe}),"category"===Le.key&&(0,c.jsx)(d,{categories:ce,value:w,onChange:S,onBack:De,onNext:Fe}),"service"===Le.key&&(0,c.jsx)(u,{services:de,value:_,onChange:P,onBack:De,onNext:Fe}),"extras"===Le.key&&(0,c.jsx)(p,{extras:pe,value:E,onChange:O,onBack:De,onNext:Fe}),"agent"===Le.key&&(0,c.jsx)(m,{agents:be,value:I,onChange:L,onBack:De,onNext:Fe}),"datetime"===Le.key&&(0,c.jsx)(v,{locationId:k,serviceId:_,agentId:I,serviceDurationMin:de.find(e=>String(e.id)===String(_))?.duration||30,valueDate:$,valueSlot:R,onChangeDate:e=>{B(e),M(null)},onChangeSlot:M,onBack:De,onNext:Fe}),"customer"===Le.key&&(0,c.jsx)(C,{formFields:ne,answers:ae,onChange:se,onBack:De,onNext:Fe,onError:Ce,layout:h?.fieldsLayout}),"payment"===Le.key&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(T,{enabledMethods:Oe,selected:A,onSelect:U,totalLabel:Pe(Ue,j),imagesBase:o?.imagesBase||"",onBack:De,onNext:Fe}),"stripe"===A?(0,c.jsx)(ye,{bookingId:F,publishableKey:j?.stripe_publishable_key||"",amountLabel:Pe(Ue,j),onPaid:()=>{te({booking:{id:F},paid:!0,error:""}),qe("done")},onError:e=>Ce(e)}):null]}),"review"===Le.key&&(0,c.jsx)(ve,{locationId:k,categoryIds:w,serviceId:_,extraIds:E,agentId:I,date:$,slot:R,locations:ie,categories:ce,services:de,extras:pe,agents:be,formFields:ne,answers:ae,paymentMethodLabel:{free:"Free (no payment)",cash:"Pay at location (Cash)",woocommerce:"Pay with WooCommerce",stripe:"Pay with Stripe",paypal:"Pay with PayPal"}[A]||A||"-",totalLabel:Pe(Ue,j),onBack:De,onNext:async()=>{if("stripe"===A)return await(async()=>{if(q)return q;W(!0),H(null);try{const e=Ye(),t=A||j?.payments_default_method||"stripe";e.payment_method=t;const n=await(e=>r("/front/booking/create",{method:"POST",body:JSON.stringify(e)}))(e),a=Number(n?.booking_id||0);if(!a)throw new Error(n?.message||"Could not create booking.");return Y(a),D(a),se(e=>({...e,__booking:{booking_id:a}})),a}catch(e){throw H(e?.message||"Create booking failed"),e}finally{W(!1)}})(),void qe("payment");await async function(){try{ge(!0),Ce("");const e=Ye(),t=Te&&(A||j?.payments_default_method)||"cash";if(e.payment_method=t,"woocommerce"===t){const t=await(e=>r("/front/payments/woocommerce/start",{method:"POST",body:JSON.stringify(e)}))(e);if(!t?.checkout_url)throw new Error("Checkout URL missing");return void(window.location.href=t.checkout_url)}if("stripe"===t){const t=await(e=>r("/front/payments/stripe/start",{method:"POST",body:JSON.stringify(e)}))(e);if(!t?.checkout_url)throw new Error("Stripe checkout URL missing");return void(window.location.href=t.checkout_url)}if("paypal"===t){const t=await(e=>r("/front/payments/paypal/start",{method:"POST",body:JSON.stringify(e)}))(e);if(!t?.approve_url)throw new Error("PayPal approve URL missing");return void(window.location.href=t.approve_url)}if("cash"!==t&&"free"!==t)throw new Error("Unsupported payment method");const n=await(e=>r("/front/bookings",{method:"POST",body:JSON.stringify(e)}))(e);se(e=>({...e,__booking:n}));const a=Ie.findIndex(e=>"done"===e.key);f(a>=0?a:Ie.length-1)}catch(e){Ce(e?.message||"Could not submit booking.")}finally{ge(!1)}}()},isCreatingBooking:J,createError:z,loading:he,nextLabel:"Submit booking"}),"done"===Le.key&&(0,c.jsx)(je,{booking:ae.__booking,confirmData:ee,returnLoading:V,returnError:G,onRetry:()=>qe("payment"),onClose:n})]}),(0,c.jsxs)("aside",{className:"bp-summary",children:[(0,c.jsx)("div",{className:"bp-summary-title",children:"Summary"}),(0,c.jsx)("div",{className:"bp-summary-box",children:(0,c.jsx)(Ee,{locations:ie,categories:ce,services:de,extras:pe,agents:be,locationId:k,categoryIds:w,serviceId:_,extraIds:E,agentId:I,date:$,slot:R})})]})]})]})}):(0,c.jsx)("div",{className:"bp-wizard-loading",children:"Wizard config invalid (no steps)"}):null}function Pe(e,t={}){if(null==e)return"-";const n=Number(e);if(!Number.isFinite(n))return"-";const r=t.currency||"USD",a="after"===t.currency_position?"after":"before",s=n.toLocaleString(void 0,{minimumFractionDigits:n%1==0?0:2,maximumFractionDigits:2});return"after"===a?`${s} ${r}`:`${r} ${s}`}function Ee(e){const{locations:t,categories:n,services:r,extras:a,agents:s,locationId:i,categoryIds:o,serviceId:l,extraIds:d,agentId:u,date:p,slot:m}=e,b=t.find(e=>String(e.id)===String(i)),f=r.find(e=>String(e.id)===String(l)),h=s.find(e=>String(e.id)===String(u)),g=a.filter(e=>d.includes(e.id)||d.includes(String(e.id))),y=n.filter(e=>o.includes(e.id)||o.includes(String(e.id))),v=null!=f?.price?Number(f.price):0,x=g.reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0),j=v+x;function k(e){return e||0===e?`${Number(e).toFixed(0)} Kr`:"-"}return(0,c.jsxs)("div",{className:"bp-summary-items",children:[(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Location"}),(0,c.jsx)("div",{className:"v",children:b?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Category"}),(0,c.jsx)("div",{className:"v",children:y.length?y.map(e=>e.name).join(", "):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Service"}),(0,c.jsx)("div",{className:"v",children:f?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Service Price"}),(0,c.jsx)("div",{className:"v",children:null!=f?.price?k(v):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Agent"}),(0,c.jsx)("div",{className:"v",children:h?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Date"}),(0,c.jsx)("div",{className:"v",children:p||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Time"}),(0,c.jsx)("div",{className:"v",children:m?.start_time?`${m.start_time} - ${m.end_time}`:"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Extras"}),(0,c.jsx)("div",{className:"v",children:g.length?g.map(e=>e.name).join(", "):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Extras Price"}),(0,c.jsx)("div",{className:"v",children:g.length?k(x):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Total"}),(0,c.jsx)("div",{className:"v",children:null!=f?.price||g.length?k(j):"-"})]})]})}function Oe({label:t,mountEl:n}){const[r,a]=(0,e.useState)(!1),s="1"===n?.getAttribute("data-bp-fallback"),i=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",o=(0,e.useMemo)(()=>({imagesBase:i,helpPhone:"+45 91 67 14 52"}),[i]);return(0,e.useEffect)(()=>function(e,t){return e?(e.__bpOpen=()=>t(!0),()=>{e.__bpOpen&&delete e.__bpOpen}):()=>{}}(n,a),[n]),(0,c.jsxs)(c.Fragment,{children:[!s&&(0,c.jsx)("button",{className:"bp-book-btn",type:"button",onClick:()=>a(!0),children:t||"Book Now"}),(0,c.jsx)(Ce,{open:r,onClose:()=>a(!1),brand:o})]})}function Te(){const e=document.querySelectorAll(".bp-front-root[data-bp-widget='wizard']");e.length?(e.forEach(e=>{const n=(0,t.H)(e),r=e.getAttribute("data-bp-label")||"Book Now";n.render((0,c.jsx)(Oe,{label:r,mountEl:e}))}),document.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element))return;const n=t.closest('.bp-fallback-btn, [data-bp-open="wizard"]');if(!n)return;const r=n.nextElementSibling,a=r&&r.classList.contains("bp-front-root")?r:n.closest(".bp-front-root")||document.querySelector(".bp-front-root");a&&"function"==typeof a.__bpOpen&&(e.preventDefault(),a.__bpOpen())})):function(){const e=document.getElementById("bp-front-root");if(!e)return;const n=(0,t.H)(e),r={imagesBase:(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",helpPhone:"+45 91 67 14 52"};document.addEventListener("click",t=>{const a=t.target;a instanceof Element&&a.closest(".bp-open-wizard")&&(t.preventDefault(),e.style.display="block",n.render((0,c.jsx)(Ce,{open:!0,onClose:()=>{n.render(null),e.style.display="none"},brand:r})))})}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Te):Te()})()})();