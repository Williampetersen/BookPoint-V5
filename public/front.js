(()=>{var e={338(e,t,n){"use strict";var s=n(795);t.H=s.createRoot,s.hydrateRoot},556(e,t,n){e.exports=n(694)()},694(e,t,n){"use strict";var s=n(925);function r(){}function a(){}a.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,a,i){if(i!==s){var o=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw o.name="Invariant Violation",o}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:r};return n.PropTypes=n,n}},795(e){"use strict";e.exports=window.ReactDOM},925(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},t={};function n(s){var r=t[s];if(void 0!==r)return r.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,n),a.exports}(()=>{"use strict";const e=window.React;var t=n(338);async function s(e,t={}){var n;const s=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",r=window.BP_FRONT?.nonce,a=await fetch(`${s}${e}`,{...t,headers:{"Content-Type":"application/json",...r?{"X-WP-Nonce":r}:{},...t.headers||{}}}),i=await a.json().catch(()=>({}));if(!a.ok||"error"===i?.status)throw new Error(i?.message||"Request failed");return null!==(n=i?.data)&&void 0!==n?n:i}const r=({service_id:e})=>s("/front/extras",{method:"POST",body:JSON.stringify({service_id:e})}),a=({service_id:e,location_id:t})=>s("/front/agents",{method:"POST",body:JSON.stringify({service_id:e,location_id:t})}),i=async()=>{const e=await s("/front/form-fields/active");if(e&&e.form&&e.customer&&e.booking)return e;const t=await s("/front/form-fields"),n=[],r=[],a=[];return(Array.isArray(t)?t:[]).forEach(e=>{const t=e.scope||"customer";"booking"===t?a.push(e):"form"===t?n.push(e):r.push(e)}),{form:n,customer:r,booking:a}};function o(e,t){const n=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return e?.image_url||e?.image||""||n+t}const c=window.ReactJSXRuntime;function l({locations:e,value:t,onChange:n,onNext:s,nextLabel:r="Next ->"}){const a=e||[],i=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-list",children:[a.map(e=>(0,c.jsx)("button",{type:"button",className:String(t)===String(e.id)?"bp-card active":"bp-card",onClick:()=>n(e.id),children:(0,c.jsxs)("div",{className:"bp-card-row",children:[(0,c.jsx)("img",{className:"bp-card-thumb",src:o(e,"location-image.png"),alt:""}),(0,c.jsxs)("div",{children:[(0,c.jsx)("div",{className:"bp-card-title",children:e.name}),(0,c.jsx)("div",{className:"bp-card-sub",children:e.address||""})]})]})},e.id)),a.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No locations found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("div",{}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!i,onClick:()=>s(),children:r})]})]})}function d({categories:e,value:t,onChange:n,onBack:s,onNext:r,backLabel:a="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=(t||[]).length>0;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-list",children:[l.map(e=>{const s=(t||[]).some(t=>String(t)===String(e.id));return(0,c.jsx)("button",{type:"button",className:s?"bp-card active":"bp-card",onClick:()=>{return t=e.id,void n([t]);var t},children:(0,c.jsxs)("div",{className:"bp-card-row",children:[(0,c.jsx)("img",{className:"bp-card-thumb",src:o(e,"service-image.png"),alt:""}),(0,c.jsx)("div",{className:"bp-card-title",children:e.name})]})},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No categories found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:a}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:r,children:i})]})]})}function u({services:e,value:t,onChange:n,onBack:s,onNext:r,backLabel:a="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[l.map(e=>{const s=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>n(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:o(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description}),(0,c.jsxs)("div",{className:"bp-meta",children:[!!e.duration&&(0,c.jsxs)("span",{className:"bp-chip",children:[e.duration," min"]}),!!e.category_name&&(0,c.jsx)("span",{className:"bp-chip ghost",children:e.category_name})]})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Select"})}),(0,c.jsx)("div",{className:s?"bp-radio on":"bp-radio"})]})]},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No services found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:a}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:r,children:i})]})]})}function p({extras:e,value:t,onChange:n,onBack:s,onNext:r,backLabel:a="<- Back",nextLabel:i="Next ->"}){const l=e||[];return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[l.map(e=>{const s=(t||[]).some(t=>String(t)===String(e.id));return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>function(e){const s=String(e),r=(t||[]).some(e=>String(e)===s)?(t||[]).filter(e=>String(e)!==s):[...t||[],e];n(r)}(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:o(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),(e.description||e.desc||e.summary)&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description||e.desc||e.summary})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Extra"})}),(0,c.jsx)("div",{className:s?"bp-check on":"bp-check"})]})]},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No extras for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:a}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!1,onClick:r,children:i})]})]})}function m({agents:e,value:t,onChange:n,onBack:s,onNext:r,backLabel:a="<- Back",nextLabel:i="Next ->"}){const l=e||[],d=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-cardlist",children:[l.map(e=>{const s=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>n(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-avatar",src:o(e,"default-avatar.jpg"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.title&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.title}),!!e.email&&(0,c.jsx)("div",{className:"bp-pickcard-sub small",children:e.email})]}),(0,c.jsx)("div",{className:"bp-pickcard-right",children:(0,c.jsx)("div",{className:s?"bp-radio on":"bp-radio"})})]},e.id)}),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No agents available for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:a}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:r,children:i})]})]})}const b=(e,t,n)=>new Date(Date.UTC(e,t,n,12,0,0)),f=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,h=(e,t)=>b(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+t),g=e=>{const t=new Date,n=b(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return e.getTime()<n.getTime()};async function y(e,t,{signal:n}={}){const s=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",r=window.BP_FRONT?.nonce,a=await fetch(`${s}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...r?{"X-WP-Nonce":r}:{}},body:JSON.stringify(t),signal:n,credentials:"same-origin"}),i=await a.text();let o;try{o=JSON.parse(i)}catch(e){o={ok:!1,raw:i}}if(!a.ok){const e=o?.message||o?.raw||`HTTP ${a.status}`;throw new Error(e)}return o}function v({serviceId:t,agentId:n,locationId:s,valueDate:r,valueSlot:a,onChangeDate:i,onChangeSlot:o,onBack:l,onNext:d,backLabel:u="<- Back",nextLabel:p="Next ->"}){const[m,v]=(0,e.useState)(()=>{const e=new Date;return b(e.getUTCFullYear(),e.getUTCMonth(),1)}),[x,j]=(0,e.useState)(r||null),[k,N]=(0,e.useState)([]),[w,S]=(0,e.useState)(!1),[C,_]=(0,e.useState)([]),[P,E]=(0,e.useState)(!1),[O,T]=(0,e.useState)(""),I=(0,e.useRef)(new Map),B=(0,e.useRef)(new Map),$=(0,e.useRef)(null),L=(0,e.useRef)(null),R=(0,e.useMemo)(()=>{var e;return`${m.getUTCFullYear()}-${e=m.getUTCMonth()+1,String(e).padStart(2,"0")}`},[m]),F=(0,e.useMemo)(()=>({service_id:t,agent_id:n,location_id:s,month:R}),[t,n,s,R]);(0,e.useEffect)(()=>{if(!t||!n)return;const e=JSON.stringify(F);if(I.current.has(e))return void N(I.current.get(e));$.current&&$.current.abort();const s=new AbortController;$.current=s,S(!0),y("/front/availability/month",F,{signal:s.signal}).then(t=>{const n=t?.data?.days||[];I.current.set(e,n),N(n)}).catch(()=>{}).finally(()=>S(!1))},[F,t,n]),(0,e.useEffect)(()=>{r&&r!==x&&j(r)},[r]);const M=(0,e.useMemo)(()=>({service_id:t,agent_id:n,location_id:s,date:x}),[t,n,s,x]);(0,e.useEffect)(()=>{if(!x||!t||!n)return;const e=JSON.stringify(M);if(B.current.has(e))return void _(B.current.get(e));L.current&&L.current.abort();const s=new AbortController;L.current=s,E(!0),_([]),T(""),y("/front/availability/day",M,{signal:s.signal}).then(t=>{const n=t?.slots||[];B.current.set(e,n),_(n)}).catch(e=>{"AbortError"!==e.name&&(_([]),T("No available times for this date."))}).finally(()=>E(!1))},[M,x,t,n]);const A=(0,e.useMemo)(()=>{const e=new Map;return k.forEach(t=>e.set(t.date,t)),e},[k]),U=(0,e.useMemo)(()=>(e=>{const t=b((n=e).getUTCFullYear(),n.getUTCMonth(),1);var n;const s=(e=>(e.getUTCDay()+6)%7)(t),r=h(t,-s);return Array.from({length:42},(e,t)=>h(r,t))})(m),[m]),D=!!x&&!!a?.start_time;return(0,c.jsxs)("div",{className:"bp-step bp-datetime",children:[(0,c.jsxs)("div",{className:"bp-calendar",children:[(0,c.jsxs)("div",{className:"bp-cal-header",children:[(0,c.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>v(e=>b(e.getUTCFullYear(),e.getUTCMonth()-1,1)),children:"<"}),(0,c.jsx)("div",{className:"bp-cal-title",children:m.toLocaleString(void 0,{month:"long",year:"numeric",timeZone:"UTC"})}),(0,c.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>v(e=>b(e.getUTCFullYear(),e.getUTCMonth()+1,1)),children:">"})]}),(0,c.jsx)("div",{className:"bp-cal-weekdays",children:["M","T","W","T","F","S","S"].map(e=>(0,c.jsx)("div",{className:"bp-cal-wd",children:e},e))}),(0,c.jsx)("div",{className:"bp-cal-grid",children:U.map((e,t)=>{const n=(r=m,(s=e).getUTCFullYear()===r.getUTCFullYear()&&s.getUTCMonth()===r.getUTCMonth());var s,r;const a=g(e)||!n,l=f(e),d=x===l,u=A.get(l),p=!!u&&u.has_slots;return(0,c.jsxs)("button",{type:"button",className:`bp-cal-day ${n?"":"is-out"} ${d?"is-selected":""}`,disabled:a,onClick:()=>function(e){if(g(e))return;const t=f(e);o?.(null),i?.(t)}(e),children:[(0,c.jsx)("div",{children:e.getUTCDate()}),(0,c.jsx)("div",{style:{height:4,width:28,borderRadius:999,margin:"6px auto 0",background:p?"#22c55e":"#e5e7eb",opacity:w&&!u?.3:1}})]},`${l}-${t}`)})})]}),(0,c.jsxs)("div",{className:"bp-slots",children:[(0,c.jsxs)("div",{className:"bp-slots-title",children:["Pick a slot for ",(0,c.jsx)("strong",{children:x||"—"})]}),!x&&(0,c.jsx)("div",{className:"bp-muted",children:"Select a date to see available times."}),x&&P&&(0,c.jsxs)("div",{className:"bp-slot-skeleton",children:[(0,c.jsx)("div",{className:"bp-skel"}),(0,c.jsx)("div",{className:"bp-skel"}),(0,c.jsx)("div",{className:"bp-skel"})]}),x&&!P&&O&&(0,c.jsx)("div",{className:"bp-error",children:O}),x&&!P&&!O&&(0,c.jsxs)("div",{className:"bp-slot-grid",children:[C.map((e,t)=>(0,c.jsx)("button",{type:"button",className:"bp-slot "+(a?.start_time===e.time?"is-selected":""),onClick:()=>o?.({start_time:e.time,end_time:e.end||""}),children:e.time},`${e.time}-${t}`)),0===C.length&&(0,c.jsx)("div",{className:"bp-muted",children:"No times found for this date."})]})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:l,children:u}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!D,onClick:d,children:p})]})]})}function x(e){return e?.id||e?.field_key||e?.name_key||""}function j(e){var t,n;return e&&"object"==typeof e?null!==(t=null!==(n=e.label)&&void 0!==n?n:e.value)&&void 0!==t?t:"":String(e)}function k(e){var t,n;return e&&"object"==typeof e?null!==(t=null!==(n=e.value)&&void 0!==n?n:e.label)&&void 0!==t?t:"":String(e)}function N({defs:e=[],layout:t=[],values:n,onChange:s,scope:r}){const a=t.map(t=>({layout:t,def:e.find(e=>x(e)===t.id)})).filter(e=>!!e.def),i=(e,t)=>{const a=r?`${r}.${e}`:e;s({...n||{},[a]:t})};return(0,c.jsx)("div",{className:"bp-fields-grid",children:a.map(({layout:e,def:t})=>{var s,a,o;const l=x(t),d=null!==(s=e.required)&&void 0!==s?s:!!(null!==(a=t.is_required)&&void 0!==a?a:t.required),u="half"===e.width?"half":"full",p=r?`${r}.${l}`:l,m=null!==(o=(n||{})[p])&&void 0!==o?o:"",b=(0,c.jsxs)("label",{className:"bp-label",children:[t.label," ",d?(0,c.jsx)("span",{className:"bp-req",children:"*"}):null]});if("textarea"===t.type)return(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("textarea",{className:"bp-textarea",placeholder:t.placeholder||"",value:m,onChange:e=>i(l,e.target.value)})]},p);if("select"===t.type){const e=Array.isArray(t.options)?t.options:t.options?.choices||[];return(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsxs)("select",{className:"bp-select",value:m,onChange:e=>i(l,e.target.value),children:[(0,c.jsx)("option",{value:"",children:"Select…"}),e.map((e,t)=>(0,c.jsx)("option",{value:k(e),children:j(e)},t))]})]},p)}return"checkbox"===t.type?(0,c.jsx)("div",{className:`bp-field bp-${u}`,children:(0,c.jsxs)("label",{className:"bp-checkbox-row",children:[(0,c.jsx)("input",{type:"checkbox",checked:!!m,onChange:e=>i(l,e.target.checked)}),(0,c.jsxs)("span",{children:[t.label," ",d?(0,c.jsx)("span",{className:"bp-req",children:"*"}):null]})]})},p):"date"===t.type?(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("input",{className:"bp-input-field",type:"date",value:m,onChange:e=>i(l,e.target.value)})]},p):(0,c.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,c.jsx)("input",{className:"bp-input-field",type:"tel"===t.type?"tel":"email"===t.type?"email":"text",placeholder:t.placeholder||"",value:m,onChange:e=>i(l,e.target.value)})]},p)})})}function w(e,t){return"checkbox"===t?!e:null==e||(Array.isArray(e)?0===e.length:""===String(e).trim())}function S(e){return e?.id||e?.field_key||e?.name_key||""}function C(e=[]){return e.map(e=>{var t,n;return{id:S(e),required:!(null===(t=null!==(n=e?.is_required)&&void 0!==n?n:e?.required)||void 0===t||!t),width:"full"}}).filter(e=>e.id)}function _({formFields:e,answers:t,onChange:n,onBack:s,onNext:r,onError:a,layout:i,backLabel:o="<- Back",nextLabel:l="Next ->"}){const d=e?.customer||[],u=e?.booking||[],p=i?.customer?.fields?.length?i.customer.fields:C(d),m=i?.booking?.fields?.length?i.booking.fields:C(u);function b(e,t){n(e&&"object"==typeof e&&void 0===t?e:n=>({...n,[e]:t}))}function f(e){var n;return null!==(n=t?.[e])&&void 0!==n?n:""}return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)(N,{defs:d,layout:p,values:t,onChange:b,scope:"customer"}),u.length?(0,c.jsx)("div",{style:{marginTop:14},children:(0,c.jsx)(N,{defs:u,layout:m,values:t,onChange:b,scope:"booking"})}):null,(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:s,children:o}),(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:function(){const e=[{scope:"customer",defs:d,layout:p},{scope:"booking",defs:u,layout:m}];for(const r of e)for(const e of r.layout){var t,n,s;const i=r.defs.find(t=>S(t)===e.id);if(i&&((null!==(t=e.required)&&void 0!==t?t:null!==(n=null!==(s=i.is_required)&&void 0!==s?s:i.required)&&void 0!==n&&n)&&w(f(`${r.scope}.${e.id}`),i.type)))return void a?.(`${i.label||e.id} is required`)}a?.(""),r()},children:l})]})]})}function P(e){return P="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},P(e)}var E,O="clover",T="https://js.stripe.com",I="".concat(T,"/").concat(O,"/stripe.js"),B=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,$=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/,L="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",R=function(e){return B.test(e)||$.test(e)},F=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(I).concat(t);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(n),n},M=null,A=null,U=null,D=!1,q=function(){return E||(E=(e=null,null!==M?M:(M=new Promise(function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(L),window.Stripe)t(window.Stripe);else try{var s=function(){for(var e=document.querySelectorAll('script[src^="'.concat(T,'"]')),t=0;t<e.length;t++){var n=e[t];if(R(n.src))return n}return null}();if(s&&e)console.warn(L);else if(s){if(s&&null!==U&&null!==A){var r;s.removeEventListener("load",U),s.removeEventListener("error",A),null===(r=s.parentNode)||void 0===r||r.removeChild(s),s=F(e)}}else s=F(e);U=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}}(t,n),A=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}}(n),s.addEventListener("load",U),s.addEventListener("error",A)}catch(e){return void n(e)}else t(null)})).catch(function(e){return M=null,Promise.reject(e)})).catch(function(e){return E=null,Promise.reject(e)}));var e};Promise.resolve().then(function(){return q()}).catch(function(e){D||console.warn(e)});var W=n(556);function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,s)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach(function(t){X(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function z(e){return z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},z(e)}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function H(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=e&&("undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"]);if(null!=n){var s,r,a=[],_n=!0,i=!1;try{for(n=n.call(e);!(_n=(s=n.next()).done)&&(a.push(s.value),!t||a.length!==t);_n=!0);}catch(e){i=!0,r=e}finally{try{_n||null==n.return||n.return()}finally{if(i)throw r}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return K(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?K(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function K(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}var V=function(t,n,s){var r=!!s,a=e.useRef(s);e.useEffect(function(){a.current=s},[s]),e.useEffect(function(){if(!r||!t)return function(){};var e=function(){a.current&&a.current.apply(a,arguments)};return t.on(n,e),function(){t.off(n,e)}},[r,n,t,a])},Z=function(t){var n=e.useRef(t);return e.useEffect(function(){n.current=t},[t]),n.current},G=function(e){return null!==e&&"object"===z(e)},Q="[object Object]",ee=function e(t,n){if(!G(t)||!G(n))return t===n;var s=Array.isArray(t);if(s!==Array.isArray(n))return!1;var r=Object.prototype.toString.call(t)===Q;if(r!==(Object.prototype.toString.call(n)===Q))return!1;if(!r&&!s)return t===n;var a=Object.keys(t),i=Object.keys(n);if(a.length!==i.length)return!1;for(var o={},c=0;c<a.length;c+=1)o[a[c]]=!0;for(var l=0;l<i.length;l+=1)o[i[l]]=!0;var d=Object.keys(o);if(d.length!==a.length)return!1;var u=t,p=n;return d.every(function(t){return e(u[t],p[t])})},te=function(e,t,n){return G(e)?Object.keys(e).reduce(function(s,r){var a=!G(t)||!ee(e[r],t[r]);return n.includes(r)?(a&&console.warn("Unsupported prop change: options.".concat(r," is not a mutable property.")),s):a?J(J({},s||{}),{},X({},r,e[r])):s},null):null},ne="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",se=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne;if(null===e||G(t=e)&&"function"==typeof t.elements&&"function"==typeof t.createToken&&"function"==typeof t.createPaymentMethod&&"function"==typeof t.confirmCardPayment)return e;throw new Error(n)},re=e.createContext(null);re.displayName="ElementsContext";var ae=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},ie=function(t){var n=t.stripe,s=t.options,r=t.children,a=e.useMemo(function(){return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ne;if(function(e){return G(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(e){return se(e,t)})};var n=se(e,t);return null===n?{tag:"empty"}:{tag:"sync",stripe:n}}(n)},[n]),i=H(e.useState(function(){return{stripe:"sync"===a.tag?a.stripe:null,elements:"sync"===a.tag?a.stripe.elements(s):null}}),2),o=i[0],c=i[1];e.useEffect(function(){var e=!0,t=function(e){c(function(t){return t.stripe?t:{stripe:e,elements:e.elements(s)}})};return"async"!==a.tag||o.stripe?"sync"!==a.tag||o.stripe||t(a.stripe):a.stripePromise.then(function(n){n&&e&&t(n)}),function(){e=!1}},[a,o,s]);var l=Z(n);e.useEffect(function(){null!==l&&l!==n&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[l,n]);var d=Z(s);return e.useEffect(function(){if(o.elements){var e=te(s,d,["clientSecret","fonts"]);e&&o.elements.update(e)}},[s,d,o.elements]),e.useEffect(function(){var e;(e=o.stripe)&&e._registerWrapper&&e.registerAppInfo&&(e._registerWrapper({name:"react-stripe-js",version:"5.5.0"}),e.registerAppInfo({name:"react-stripe-js",version:"5.5.0",url:"https://stripe.com/docs/stripe-js/react"}))},[o.stripe]),e.createElement(re.Provider,{value:o},r)};ie.propTypes={stripe:W.any,options:W.object};W.func.isRequired;var oe=e.createContext(null);oe.displayName="CheckoutContext",W.any,W.shape({clientSecret:W.oneOfType([W.string,W.instanceOf(Promise)]).isRequired,elementsOptions:W.object}).isRequired;var ce=function(t){var n=e.useContext(oe),s=e.useContext(re);if(n){if(s)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CheckoutProvider> and <Elements> providers."));return n}return ae(s,t)},le=["mode"],de=function(t,n){var s,r="".concat((s=t).charAt(0).toUpperCase()+s.slice(1),"Element"),a=n?function(t){ce("mounts <".concat(r,">"));var n=t.id,s=t.className;return e.createElement("div",{id:n,className:s})}:function(n){var s,a=n.id,i=n.className,o=n.options,c=void 0===o?{}:o,l=n.onBlur,d=n.onFocus,u=n.onReady,p=n.onChange,m=n.onEscape,b=n.onClick,f=n.onLoadError,h=n.onLoaderStart,g=n.onNetworksChange,y=n.onConfirm,v=n.onCancel,x=n.onShippingAddressChange,j=n.onShippingRateChange,k=n.onSavedPaymentMethodRemove,N=n.onSavedPaymentMethodUpdate,w=ce("mounts <".concat(r,">")),S="elements"in w?w.elements:null,C="checkoutState"in w?w.checkoutState:null,_="success"===(null==C?void 0:C.type)||"loading"===(null==C?void 0:C.type)?C.sdk:null,P=H(e.useState(null),2),E=P[0],O=P[1],T=e.useRef(null),I=e.useRef(null);V(E,"blur",l),V(E,"focus",d),V(E,"escape",m),V(E,"click",b),V(E,"loaderror",f),V(E,"loaderstart",h),V(E,"networkschange",g),V(E,"confirm",y),V(E,"cancel",v),V(E,"shippingaddresschange",x),V(E,"shippingratechange",j),V(E,"savedpaymentmethodremove",k),V(E,"savedpaymentmethodupdate",N),V(E,"change",p),u&&(s="expressCheckout"===t?u:function(){u(E)}),V(E,"ready",s),e.useLayoutEffect(function(){if(null===T.current&&null!==I.current&&(S||_)){var e=null;if(_)switch(t){case"paymentForm":e=_.createPaymentFormElement(c);break;case"payment":e=_.createPaymentElement(c);break;case"address":if(!("mode"in c))throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");var n=c.mode,s=function(e,t){if(null==e)return{};var n,s,r=function(e,t){if(null==e)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)n=a[s],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(c,le);if("shipping"===n)e=_.createShippingAddressElement(s);else{if("billing"!==n)throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.");e=_.createBillingAddressElement(s)}break;case"expressCheckout":e=_.createExpressCheckoutElement(c);break;case"currencySelector":e=_.createCurrencySelectorElement();break;case"taxId":e=_.createTaxIdElement(c);break;default:throw new Error("Invalid Element type ".concat(r,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else S&&(e=S.create(t,c));T.current=e,O(e),e&&e.mount(I.current)}},[S,_,c]);var B=Z(c);return e.useEffect(function(){if(T.current){var e=te(c,B,["paymentRequest"]);e&&"update"in T.current&&T.current.update(e)}},[c,B]),e.useLayoutEffect(function(){return function(){if(T.current&&"function"==typeof T.current.destroy)try{T.current.destroy(),T.current=null}catch(e){}}},[]),e.createElement("div",{id:a,className:i,ref:I})};return a.propTypes={id:W.string,className:W.string,onChange:W.func,onBlur:W.func,onFocus:W.func,onReady:W.func,onEscape:W.func,onClick:W.func,onLoadError:W.func,onLoaderStart:W.func,onNetworksChange:W.func,onConfirm:W.func,onCancel:W.func,onShippingAddressChange:W.func,onShippingRateChange:W.func,onSavedPaymentMethodRemove:W.func,onSavedPaymentMethodUpdate:W.func,options:W.object},a.displayName=r,a.__elementType=t,a},ue="undefined"==typeof window;e.createContext(null).displayName="EmbeddedCheckoutProviderContext",de("auBankAccount",ue),de("card",ue),de("cardNumber",ue),de("cardExpiry",ue),de("cardCvc",ue),de("iban",ue);var pe=de("payment",ue);function me({bookingId:t,onPaid:n,onBack:s}){const r=ce("calls useStripe()").stripe,a=(u="calls useElements()",p=e.useContext(re),ae(p,u)).elements,[i,o]=(0,e.useState)(!1),[l,d]=(0,e.useState)("");var u,p;return(0,c.jsxs)("div",{className:"bp-pay-wrap",children:[(0,c.jsx)("div",{className:"bp-pay-box",children:(0,c.jsx)(pe,{})}),l?(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:l}):null,(0,c.jsxs)("div",{className:"bp-pay-actions",children:[(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:s,disabled:i,children:"Back"}),(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-primary",onClick:async()=>{if(d(""),r&&a){o(!0);try{const{error:e,paymentIntent:s}=await r.confirmPayment({elements:a,confirmParams:{return_url:window.location.href},redirect:"if_required"});if(e)return d(e.message||"Payment failed."),void o(!1);const i=await fetch("/wp-json/bp/v1/front/payment/stripe/confirm",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.BP_FRONT?.nonce||""},body:JSON.stringify({booking_id:t,payment_intent_id:s?.id||"",status:s?.status||""})}),c=await i.json();if(c?.success)return void n();d("Payment not completed yet. Please try again.")}catch(e){d(e?.message||"Payment error.")}finally{o(!1)}}},disabled:!r||i,children:i?"Processing...":"Pay now"})]})]})}function be({bookingId:t,totalLabel:n,paymentMethod:s,onPaid:r,onBack:a}){const i=window.BP_FRONT?.stripe_pk||"",o=(0,e.useMemo)(()=>i?function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];D=!0;var s=Date.now();return q().then(function(e){return function(e,t,n){if(null===e)return null;var s=t[0];if("string"!=typeof s)throw new Error("Expected publishable key to be of type string, got type ".concat(P(s)," instead."));var r=s.match(/^pk_test/),a=function(e){return 3===e?"v3":e}(e.version),i=O;r&&a!==i&&console.warn("Stripe.js@".concat(a," was loaded on the page, but @stripe/stripe-js@").concat("8.6.4"," expected Stripe.js@").concat(i,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var o=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"8.6.4",startTime:t})}(o,n),o}(e,t,s)})}(i):null,[i]),[l,d]=(0,e.useState)(""),[u,p]=(0,e.useState)(!1),[m,b]=(0,e.useState)("");return(0,e.useEffect)(()=>{if(!t)return;if("stripe"!==s)return;let e=!0;return b(""),p(!0),fetch("/wp-json/bp/v1/front/payment/stripe/start",{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json","X-WP-Nonce":window.BP_FRONT?.nonce||""},body:JSON.stringify({booking_id:t})}).then(e=>e.json().then(t=>({ok:e.ok,j:t}))).then(({ok:t,j:n})=>{if(e){if(!t||!n?.success||!n?.client_secret)throw new Error(n?.message||"Could not start Stripe payment.");d(n.client_secret)}}).catch(t=>{e&&b(t?.message||"Stripe start error.")}).finally(()=>e&&p(!1)),()=>{e=!1}},[t,s]),"stripe"!==s?(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("h3",{children:"Payment"}),(0,c.jsxs)("div",{className:"bp-muted",children:["Selected method: ",s]}),(0,c.jsx)("div",{className:"bp-pay-actions",style:{marginTop:12},children:(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:a,children:"Back"})})]}):i?(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-step-head",children:[(0,c.jsx)("h3",{children:"Payment"}),(0,c.jsx)("div",{className:"bp-total",children:n})]}),m?(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:m}):null,u&&!l?(0,c.jsx)("div",{className:"bp-muted",children:"Preparing secure payment..."}):null,l&&o?(0,c.jsx)(ie,{stripe:o,options:{clientSecret:l},children:(0,c.jsx)(me,{bookingId:t,onPaid:r,onBack:a})}):null]}):(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("h3",{children:"Payment"}),(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:"Stripe publishable key is missing. Please configure it in BookPoint Settings."}),(0,c.jsx)("div",{className:"bp-pay-actions",children:(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:a,children:"Back"})})]})}function fe({locationId:t,categoryIds:n,serviceId:s,extraIds:r,agentId:a,date:i,slot:o,locations:l,categories:d,services:u,extras:p,agents:m,formFields:b,answers:f,paymentMethodLabel:h,totalLabel:g,onBack:y,onNext:v,isCreatingBooking:x,createError:j,loading:k,backLabel:N="<- Back",nextLabel:w="Next ->"}){const S=l.find(e=>String(e.id)===String(t)),C=u.find(e=>String(e.id)===String(s)),_=m.find(e=>String(e.id)===String(a)),P=d.filter(e=>n.includes(e.id)||n.includes(String(e.id))),E=p.filter(e=>r.includes(e.id)||r.includes(String(e.id))),O=(0,e.useMemo)(()=>[...b?.form||[],...b?.customer||[],...b?.booking||[]],[b]);return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-review",children:[(0,c.jsx)(he,{label:"Location",value:S?.name}),(0,c.jsx)(he,{label:"Categories",value:P.length?P.map(e=>e.name).join(", "):"-"}),(0,c.jsx)(he,{label:"Service",value:C?.name}),(0,c.jsx)(he,{label:"Agent",value:_?.name}),(0,c.jsx)(he,{label:"Date",value:i}),(0,c.jsx)(he,{label:"Time",value:o?.start_time?`${o.start_time} - ${o.end_time}`:"-"}),(0,c.jsx)(he,{label:"Extras",value:E.length?E.map(e=>e.name).join(", "):"-"}),h?(0,c.jsx)(he,{label:"Payment Method",value:h}):null,g?(0,c.jsx)(he,{label:"Total",value:g}):null,(0,c.jsx)("div",{className:"bp-review-section",children:"Customer Information"}),O.map(e=>{var t;const n=e.field_key||e.name_key||"",s=`${e.scope}.${n}`;let r=null!==(t=f?.[s])&&void 0!==t?t:"";return"checkbox"===e.type&&(r="1"===r?"Yes":"No"),(0,c.jsx)(he,{label:e.label,value:String(r||"")},s)})]}),j?(0,c.jsx)("div",{className:"bp-alert bp-alert-error bp-mt-12",children:j}):null,(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:y,children:N}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!!x,onClick:v,children:x?"Preparing payment...":w})]})]})}function he({label:e,value:t}){return(0,c.jsxs)("div",{className:"bp-review-row",children:[(0,c.jsx)("div",{className:"k",children:e}),(0,c.jsx)("div",{className:"v",children:t||"-"})]})}function ge({bookingId:e,confirmInfo:t,loading:n,error:s,onRetry:r,onClose:a,summary:i}){const o=t?.status||"",l=t?.payment_status||"",d="confirmed"===o&&"paid"===l,u="pending_payment"===o||"unpaid"===l||"processing"===l;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("div",{className:"bp-step-head",children:(0,c.jsx)("h3",{children:"Confirmation"})}),n?(0,c.jsx)("div",{className:"bp-muted",children:"Loading booking status..."}):null,s?(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:s}):null,n||s?null:(0,c.jsxs)(c.Fragment,{children:[d?(0,c.jsx)("div",{className:"bp-alert bp-alert-success",children:"✅ Payment successful. Your booking is confirmed."}):u?(0,c.jsx)("div",{className:"bp-alert bp-alert-warn",children:"⏳ Payment is still processing. If it doesn’t confirm in a moment, click Retry."}):(0,c.jsx)("div",{className:"bp-alert bp-alert-error",children:"❌ Payment was not completed. Please try again."}),(0,c.jsxs)("div",{className:"bp-confirm-card",children:[(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Booking ID:"})," ",(0,c.jsxs)("span",{children:["#",e]})]}),(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Status:"})," ",(0,c.jsx)("span",{children:o||"-"})]}),(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Payment:"})," ",(0,c.jsx)("span",{children:l||"-"})]}),t?.payment_method?(0,c.jsxs)("div",{className:"bp-row",children:[(0,c.jsx)("strong",{children:"Method:"})," ",(0,c.jsx)("span",{children:t.payment_method})]}):null]}),i?(0,c.jsxs)("div",{className:"bp-confirm-summary",children:[(0,c.jsx)("h4",{children:"Summary"}),(0,c.jsx)("div",{className:"bp-muted",children:i})]}):null,(0,c.jsxs)("div",{className:"bp-pay-actions",style:{justifyContent:"space-between"},children:[(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-light",onClick:a,children:"Close"}),d?null:(0,c.jsx)("button",{type:"button",className:"bp-btn bp-btn-primary",onClick:r,children:"Retry payment"})]})]})]})}de("expressCheckout",ue),de("paymentRequestButton",ue),de("linkAuthentication",ue),de("address",ue),de("shippingAddress",ue),de("paymentMethodMessaging",ue),de("taxId",ue);let ye="undefined"!=typeof window&&window.BP_FRONT?.settings||null;const ve=["location","category","service","extras","agent","datetime","customer","review","payment","confirmation"],xe=[{key:"location",title:"Location Selection",icon:"location-image.png"},{key:"category",title:"Choose Category",icon:"service-image.png"},{key:"service",title:"Choose Service",icon:"service-image.png"},{key:"extras",title:"Service Extras",icon:"service-image.png"},{key:"agent",title:"Choose Agent",icon:"default-avatar.jpg"},{key:"datetime",title:"Choose Date & Time",icon:"blue-dot.png"},{key:"customer",title:"Customer Information",icon:"default-avatar.jpg"},{key:"review",title:"Review Order",icon:"white-curve.png"},{key:"payment",title:"Payment",icon:"payment_now.png"},{key:"confirmation",title:"Confirm",icon:"logo.png"}];function je(e=[]){const t=new Set(ve),n=[];for(const s of e)t.has(s)&&!n.includes(s)&&n.push(s);for(const e of ve)n.includes(e)||n.push(e);return ve.filter(e=>n.includes(e))}function ke(){return(window.BP_FRONT?.restUrl||"/wp-json/bp/v1").replace(/\/$/,"")}async function Ne(e){const t=await fetch(`${ke()}/front/bookings/${e}/status?_t=${Date.now()}`,{credentials:"same-origin",headers:{"X-WP-Nonce":window.BP_FRONT?.nonce||""}}),n=await t.json().catch(()=>({}));if(!t.ok||!n?.success)throw new Error(n?.message||"Could not load booking status");return n.booking}function we({open:t,onClose:n,brand:o}){const[b,f]=(0,e.useState)(0),{config:h,loading:g,error:y}=function(t){const[n,s]=(0,e.useState)(!1),[r,a]=(0,e.useState)(null),[i,o]=(0,e.useState)("");return(0,e.useEffect)(()=>{if(!t)return;let e=!0;s(!0),o("");const n=`/wp-json/bp/v1/front/booking-form-design?_t=${Date.now()}`;return fetch(n,{credentials:"same-origin"}).then(async e=>{const t=await e.json().catch(()=>null);if(!e.ok)throw new Error(t?.message||`Design fetch failed (${e.status})`);return t}).then(t=>{e&&a(t?.config||null)}).catch(t=>{e&&(a(null),o(t.message||"Design fetch failed"))}).finally(()=>{e&&s(!1)}),()=>{e=!1}},[t]),{config:r,loading:n,error:i}}(t),x=(0,e.useMemo)(()=>function(e){const t=(Array.isArray(e?.steps)?e.steps:[]).filter(e=>e&&e.key&&!1!==e.enabled),n=new Map(xe.map(e=>[e.key,e])),s=je(t.length?t.map(e=>{return"agents"===(t=e.key)||"agent"===t?"agent":"done"===t||"confirm"===t||"confirmation"===t?"confirmation":t;var t}).filter(Boolean):xe.map(e=>e.key)),r=s.length?je(s).map(e=>({...n.get(e)||{key:e,title:e,icon:"service-image.png"},key:e,title:n.get(e)?.title||e,subtitle:n.get(e)?.subtitle||""})):xe.slice(),a=new Set;return r.filter(e=>!a.has(e.key)&&(a.add(e.key),!0))}(h),[h]),{settings:j}=function(t){const[n,s]=(0,e.useState)(ye),[r,a]=(0,e.useState)(!ye&&!!t);return(0,e.useEffect)(()=>{if(!t)return;if(ye)return void s(ye);let e=!0;return a(!0),fetch(`/wp-json/bp/v1/front/settings?_t=${Date.now()}`,{credentials:"same-origin"}).then(e=>e.json()).then(t=>{if(!e)return;const n=t?.settings||null;ye=n,s(n)}).catch(()=>{e&&s(null)}).finally(()=>{e&&a(!1)}),()=>{e=!1}},[t]),{settings:n,loading:r}}(t),[k,N]=(0,e.useState)(null),[w,S]=(0,e.useState)([]),[C,P]=(0,e.useState)(null),[E,O]=(0,e.useState)([]),[T,I]=(0,e.useState)(null),[B,$]=(0,e.useState)(null),[L,R]=(0,e.useState)(null),[F,M]=(0,e.useState)(""),[A,U]=(0,e.useState)(0),[D,q]=(0,e.useState)(null),[W,Y]=(0,e.useState)(!1),[J,z]=(0,e.useState)(null),[X,H]=(0,e.useState)({mode:"",bookingId:0,token:"",action:""}),[K,V]=(0,e.useState)(!1),[Z,G]=(0,e.useState)(""),[Q,ee]=(0,e.useState)(null),[te,ne]=(0,e.useState)(null),[se,re]=(0,e.useState)(!1),[ae,ie]=(0,e.useState)(""),[oe,ce]=(0,e.useState)({form:[],customer:[],booking:[]}),[le,de]=(0,e.useState)({}),[ue,pe]=(0,e.useState)([]),[me,he]=(0,e.useState)([]),[ve,we]=(0,e.useState)([]),[_e,Pe]=(0,e.useState)([]),[Ee,Oe]=(0,e.useState)([]),[Te,Ie]=(0,e.useState)(!1),[Be,$e]=(0,e.useState)(""),Le=(Array.isArray(j?.payments_enabled_methods)&&j.payments_enabled_methods.length&&j.payments_enabled_methods,0!==j?.payments_enabled),Re=(0,e.useMemo)(()=>Le?x:x.filter(e=>"payment"!==e.key),[x,Le]),Fe=Re[b]||Re[0]||xe[0],Me=(0,e.useMemo)(()=>{if(Fe?.imageUrl)return Fe.imageUrl;const e=Fe?.icon||Fe?.image||"service-image.png";return o?.imagesBase?o.imagesBase+e:""},[o,Fe]),Ae=h?.texts?.helpTitle||"Need help?",Ue=h?.texts?.helpPhone||h?.layout?.helpPhone||o?.helpPhone||"",De=!1!==Fe?.showLeftPanel,qe=!1!==Fe?.showHelpBox,We=(0,e.useMemo)(()=>{const e=ve.find(e=>String(e.id)===String(C));return(null!=e?.price?Number(e.price):0)+_e.filter(e=>E.includes(e.id)||E.includes(String(e.id))).reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0)},[ve,C,_e,E]);(0,e.useEffect)(()=>{if(t)return document.body.classList.add("bp-modal-open"),()=>document.body.classList.remove("bp-modal-open")},[t]),(0,e.useEffect)(()=>{t&&(f(0),$e(""),N(null),S([]),P(null),O([]),I(null),$(null),R(null),M(""),U(0),q(null),Y(!1),z(null),H({mode:"",bookingId:0,token:"",action:""}),V(!1),G(""),ee(null),de({}))},[t]),(0,e.useEffect)(()=>{t&&(Le?!F&&j?.payments_default_method&&M(j.payments_default_method):M("cash"))},[t,j,F,Le]),(0,e.useEffect)(()=>{if(!t)return;const e=new URLSearchParams(window.location.search),n=e.get("bp_payment"),s=e.get("token")||"",r=Number(e.get("booking_id")||0),a="paypal_return"===n||"paypal_cancel"===n;r&&("stripe_success"===n||"stripe_cancel"===n?H({mode:"stripe",bookingId:r,token:"",action:"stripe_cancel"===n?"cancel":"success"}):a&&H({mode:"paypal",bookingId:r,token:s,action:"paypal_cancel"===n?"cancel":"success"}))},[t]),(0,e.useEffect)(()=>{if(!t)return;if(!X.bookingId||!X.mode)return;let e=!0;return V(!0),G(""),(async()=>{try{if("cancel"===X.action)throw await fetch(`${ke()}/front/bookings/${X.bookingId}/payment-cancel`,{method:"POST",credentials:"same-origin"}),new Error("Payment cancelled.");if("paypal"===X.mode){if(!X.token)throw await fetch(`${ke()}/front/bookings/${X.bookingId}/payment-cancel`,{method:"POST",credentials:"same-origin"}),new Error("Payment cancelled.");await async function(e,t){const n=await fetch(`${ke()}/front/payments/paypal/capture`,{method:"POST",credentials:"same-origin",headers:{"Content-Type":"application/json"},body:JSON.stringify({order_id:e,booking_id:t})}),s=await n.json().catch(()=>({}));if(!n.ok)throw new Error(s?.message||"PayPal capture failed");return s}(X.token,X.bookingId)}const t=await async function(e){let t=null;for(let n=0;n<10;n++){const n=await Ne(e);if(t=n,"confirmed"===n?.status&&"paid"===n?.payment_status)return n;await new Promise(e=>setTimeout(e,1e3))}return t}(X.bookingId);if(!e)return;q(X.bookingId),U(X.bookingId),de(e=>({...e,__booking:{booking_id:X.bookingId}})),ee("confirmed"===t?.status&&"paid"===t?.payment_status?{booking:t,paid:!0,error:""}:{booking:t,paid:!1,error:"",pending:!0}),Xe("confirmation")}catch(t){if(!e)return;const n=t?.message||"Payment failed";G(n),q(X.bookingId),U(X.bookingId),de(e=>({...e,__booking:{booking_id:X.bookingId}})),ee({booking:{id:X.bookingId},paid:!1,error:n}),Xe("confirmation")}finally{if(!e)return;V(!1),function(){const e=new URL(window.location.href);e.searchParams.delete("bp_payment"),e.searchParams.delete("booking_id"),e.searchParams.delete("token"),window.history.replaceState({},"",e.toString())}()}})(),()=>{e=!1}},[t,X]),(0,e.useEffect)(()=>{"Select a payment method"===Be&&F&&$e("")},[Be,F]),(0,e.useEffect)(()=>{t&&(async()=>{try{Ie(!0);const[e,t,n]=await Promise.all([s("/front/locations"),s("/front/categories"),i()]);pe(e),he(t),ce(n)}catch(e){$e(e?.message||"Failed to load booking data.")}finally{Ie(!1)}})()},[t]),(0,e.useEffect)(()=>{t&&Re.map(e=>e.key).join("|")&&f(0)},[t,Re]),(0,e.useEffect)(()=>{f(e=>e<0?0:e>=Re.length?Math.max(0,Re.length-1):e)},[Re.length]);const Ye=Re[b]?.key;function Je(){$e(""),"payment"!==Fe?.key||F?f(e=>Math.min(e+1,Re.length-1)):$e("Select a payment method")}function ze(){$e(""),f(e=>Math.max(e-1,0))}function Xe(e){const t=Re.findIndex(t=>t.key===e);t>=0&&f(t)}(0,e.useEffect)(()=>{if(!t)return;if("confirmation"!==Ye)return;if(!D)return;let e=!0;return re(!0),ie(""),Ne(D).then(t=>e&&ne(t)).catch(t=>e&&ie(t.message||"Error")).finally(()=>e&&re(!1)),()=>{e=!1}},[t,Ye,D]),(0,e.useEffect)(()=>{t&&(async()=>{try{if("service"===Fe.key||"extras"===Fe.key||"agent"===Fe.key||"datetime"===Fe.key||"review"===Fe.key){const e=await(({category_ids:e=[],location_id:t=null})=>s("/front/services",{method:"POST",body:JSON.stringify({category_ids:e,location_id:t})}))({category_ids:w,location_id:k});we(e)}}catch(e){we([])}})()},[t,Fe.key,w,k]),(0,e.useEffect)(()=>{t&&(async()=>{try{if(!C)return;const[e,t]=await Promise.all([r({service_id:C}),a({service_id:C,location_id:k})]);Pe(e),Oe(t)}catch(e){Pe([]),Oe([])}})()},[t,C,k]);return t?g&&!h?(0,c.jsx)("div",{className:"bp-wizard-loading",children:"Loading booking form…"}):y&&!h?(0,c.jsxs)("div",{className:"bp-wizard-loading",children:["Wizard error: ",y]}):Re.length?(0,c.jsx)("div",{className:"bp-modal-overlay",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"bp-modal",children:[(0,c.jsx)("button",{className:"bp-modal-close",onClick:n,"aria-label":"Close",children:"x"}),(0,c.jsxs)("div",{className:"bp-modal-grid",children:[De?(0,c.jsxs)("aside",{className:"bp-side",children:[(0,c.jsx)("div",{className:"bp-side-icon",children:Me?(0,c.jsx)("img",{src:Me,alt:""}):null}),(0,c.jsx)("h3",{className:"bp-side-title",children:Fe.title}),(0,c.jsx)("p",{className:"bp-side-desc",children:Fe.subtitle||"Please complete the steps to schedule your booking."}),qe?(0,c.jsxs)("div",{className:"bp-side-help",children:[(0,c.jsx)("div",{children:Ae}),(0,c.jsx)("div",{className:"bp-help-phone",children:Ue})]}):null]}):null,(0,c.jsxs)("main",{className:"bp-main",children:[(0,c.jsxs)("div",{className:"bp-main-head",children:[(0,c.jsx)("h2",{children:Fe.title}),(0,c.jsx)("div",{className:"bp-step-dots",children:Re.slice(0,8).map((e,t)=>(0,c.jsx)("span",{className:t===b?"bp-dot active":"bp-dot"},e.key))})]}),Be?(0,c.jsx)("div",{className:"bp-error",children:Be}):null,Te?(0,c.jsx)("div",{className:"bp-loading",children:"Loading..."}):null,"location"===Fe.key&&(0,c.jsx)(l,{locations:ue,value:k,onChange:N,onNext:Je}),"category"===Fe.key&&(0,c.jsx)(d,{categories:me,value:w,onChange:S,onBack:ze,onNext:Je}),"service"===Fe.key&&(0,c.jsx)(u,{services:ve,value:C,onChange:P,onBack:ze,onNext:Je}),"extras"===Fe.key&&(0,c.jsx)(p,{extras:_e,value:E,onChange:O,onBack:ze,onNext:Je}),"agent"===Fe.key&&(0,c.jsx)(m,{agents:Ee,value:T,onChange:I,onBack:ze,onNext:Je}),"datetime"===Fe.key&&(0,c.jsx)(v,{locationId:k,serviceId:C,agentId:T,serviceDurationMin:ve.find(e=>String(e.id)===String(C))?.duration||30,valueDate:B,valueSlot:L,onChangeDate:e=>{$(e),R(null)},onChangeSlot:R,onBack:ze,onNext:Je}),"customer"===Fe.key&&(0,c.jsx)(_,{formFields:oe,answers:le,onChange:de,onBack:ze,onNext:Je,onError:$e,layout:h?.fieldsLayout}),"payment"===Fe.key&&(0,c.jsx)(be,{bookingId:D,paymentMethod:F,totalLabel:Se(We,j),onBack:()=>Xe("review"),onPaid:()=>Xe("confirmation")}),"review"===Fe.key&&(0,c.jsx)(fe,{locationId:k,categoryIds:w,serviceId:C,extraIds:E,agentId:T,date:B,slot:L,locations:ue,categories:me,services:ve,extras:_e,agents:Ee,formFields:oe,answers:le,bookingId:D,paymentMethodLabel:{free:"Free (no payment)",cash:"Pay at location (Cash)",woocommerce:"Pay with WooCommerce",stripe:"Pay with Stripe",paypal:"Pay with PayPal"}[F]||F||"-",totalLabel:Se(We,j),onBack:ze,onNext:async()=>{await(async()=>{if(D)return D;Y(!0),z(null);try{const e=(()=>{const e={},t={};return Object.entries(le||{}).forEach(([n,s])=>{n.startsWith("customer.")?e[n.slice(9)]=s:n.startsWith("booking.")&&(t[n.slice(8)]=s)}),{location_id:k,category_ids:w,service_id:C,extra_ids:E,agent_id:T,date:B,start_time:L?.start_time||L?.start||"",end_time:L?.end_time||L?.end||"",field_values:le,customer_fields:e,booking_fields:t,extras:E,total_price:We,currency:j?.currency||"USD"}})();e.payment_method=F||"cash";const t=await fetch(`${ke()}/front/booking/create`,{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":window.BP_FRONT?.nonce||""},credentials:"same-origin",body:JSON.stringify(e)}),n=await t.json().catch(()=>({}));if(!t.ok||!n?.success)throw new Error(n?.message||"Could not create booking");return q(n.booking_id),n.booking_id}catch(e){throw z(e.message||"Create booking failed"),e}finally{Y(!1)}})(),Xe("payment")},isCreatingBooking:W,createError:J,loading:Te}),"confirmation"===Fe.key&&(0,c.jsx)(ge,{bookingId:D,confirmInfo:te,loading:se,error:ae,summary:null,onClose:n,onRetry:()=>Xe("payment")})]}),(0,c.jsxs)("aside",{className:"bp-summary",children:[(0,c.jsx)("div",{className:"bp-summary-title",children:"Summary"}),(0,c.jsx)("div",{className:"bp-summary-box",children:(0,c.jsx)(Ce,{locations:ue,categories:me,services:ve,extras:_e,agents:Ee,locationId:k,categoryIds:w,serviceId:C,extraIds:E,agentId:T,date:B,slot:L})})]})]})]})}):(0,c.jsx)("div",{className:"bp-wizard-loading",children:"Wizard config invalid (no steps)"}):null}function Se(e,t={}){if(null==e)return"-";const n=Number(e);if(!Number.isFinite(n))return"-";const s=t.currency||"USD",r="after"===t.currency_position?"after":"before",a=n.toLocaleString(void 0,{minimumFractionDigits:n%1==0?0:2,maximumFractionDigits:2});return"after"===r?`${a} ${s}`:`${s} ${a}`}function Ce(e){const{locations:t,categories:n,services:s,extras:r,agents:a,locationId:i,categoryIds:o,serviceId:l,extraIds:d,agentId:u,date:p,slot:m}=e,b=t.find(e=>String(e.id)===String(i)),f=s.find(e=>String(e.id)===String(l)),h=a.find(e=>String(e.id)===String(u)),g=r.filter(e=>d.includes(e.id)||d.includes(String(e.id))),y=n.filter(e=>o.includes(e.id)||o.includes(String(e.id))),v=null!=f?.price?Number(f.price):0,x=g.reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0),j=v+x;function k(e){return e||0===e?`${Number(e).toFixed(0)} Kr`:"-"}return(0,c.jsxs)("div",{className:"bp-summary-items",children:[(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Location"}),(0,c.jsx)("div",{className:"v",children:b?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Category"}),(0,c.jsx)("div",{className:"v",children:y.length?y.map(e=>e.name).join(", "):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Service"}),(0,c.jsx)("div",{className:"v",children:f?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Service Price"}),(0,c.jsx)("div",{className:"v",children:null!=f?.price?k(v):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Agent"}),(0,c.jsx)("div",{className:"v",children:h?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Date"}),(0,c.jsx)("div",{className:"v",children:p||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Time"}),(0,c.jsx)("div",{className:"v",children:m?.start_time?`${m.start_time} - ${m.end_time}`:"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Extras"}),(0,c.jsx)("div",{className:"v",children:g.length?g.map(e=>e.name).join(", "):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Extras Price"}),(0,c.jsx)("div",{className:"v",children:g.length?k(x):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Total"}),(0,c.jsx)("div",{className:"v",children:null!=f?.price||g.length?k(j):"-"})]})]})}function _e({label:t,mountEl:n}){const[s,r]=(0,e.useState)(!1),a="1"===n?.getAttribute("data-bp-fallback"),i=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",o=(0,e.useMemo)(()=>({imagesBase:i,helpPhone:"+45 91 67 14 52"}),[i]);return(0,e.useEffect)(()=>function(e,t){return e?(e.__bpOpen=()=>t(!0),()=>{e.__bpOpen&&delete e.__bpOpen}):()=>{}}(n,r),[n]),(0,c.jsxs)(c.Fragment,{children:[!a&&(0,c.jsx)("button",{className:"bp-book-btn",type:"button",onClick:()=>r(!0),children:t||"Book Now"}),(0,c.jsx)(we,{open:s,onClose:()=>r(!1),brand:o})]})}function Pe(){const e=document.querySelectorAll(".bp-front-root[data-bp-widget='wizard']");e.length?(e.forEach(e=>{const n=(0,t.H)(e),s=e.getAttribute("data-bp-label")||"Book Now";n.render((0,c.jsx)(_e,{label:s,mountEl:e}))}),document.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element))return;const n=t.closest('.bp-fallback-btn, [data-bp-open="wizard"]');if(!n)return;const s=n.nextElementSibling,r=s&&s.classList.contains("bp-front-root")?s:n.closest(".bp-front-root")||document.querySelector(".bp-front-root");r&&"function"==typeof r.__bpOpen&&(e.preventDefault(),r.__bpOpen())})):function(){const e=document.getElementById("bp-front-root");if(!e)return;const n=(0,t.H)(e),s={imagesBase:(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",helpPhone:"+45 91 67 14 52"};document.addEventListener("click",t=>{const r=t.target;r instanceof Element&&r.closest(".bp-open-wizard")&&(t.preventDefault(),e.style.display="block",n.render((0,c.jsx)(we,{open:!0,onClose:()=>{n.render(null),e.style.display="none"},brand:s})))})}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",Pe):Pe()})()})();