(()=>{"use strict";var e={338(e,t,s){var a=s(795);t.H=a.createRoot,a.hydrateRoot},795(e){e.exports=window.ReactDOM}},t={};const s=window.React;var a=function s(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}(338);async function n(e,t={}){var s;const a=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",n=window.BP_FRONT?.nonce,i=await fetch(`${a}${e}`,{...t,headers:{"Content-Type":"application/json",...n?{"X-WP-Nonce":n}:{},...t.headers||{}}}),l=await i.json().catch(()=>({}));if(!i.ok||"error"===l?.status)throw new Error(l?.message||"Request failed");return null!==(s=l?.data)&&void 0!==s?s:l}const i=({service_id:e})=>n("/front/extras",{method:"POST",body:JSON.stringify({service_id:e})}),l=({service_id:e,location_id:t})=>n("/front/agents",{method:"POST",body:JSON.stringify({service_id:e,location_id:t})}),r=async()=>{const e=await n("/front/form-fields/active");if(e&&e.form&&e.customer&&e.booking)return e;const t=await n("/front/form-fields"),s=[],a=[],i=[];return(Array.isArray(t)?t:[]).forEach(e=>{const t=e.scope||"customer";"booking"===t?i.push(e):"form"===t?s.push(e):a.push(e)}),{form:s,customer:a,booking:i}};function c(e,t){const s=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return e?.image_url||e?.image||""||s+t}const o=window.ReactJSXRuntime;function d({locations:e,value:t,onChange:s,onNext:a,nextLabel:n="Next ->"}){const i=e||[],l=!!t;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-list",children:[i.map(e=>(0,o.jsx)("button",{type:"button",className:String(t)===String(e.id)?"bp-card active":"bp-card",onClick:()=>s(e.id),children:(0,o.jsxs)("div",{className:"bp-card-row",children:[(0,o.jsx)("img",{className:"bp-card-thumb",src:c(e,"location-image.png"),alt:""}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"bp-card-title",children:e.name}),(0,o.jsx)("div",{className:"bp-card-sub",children:e.address||""})]})]})},e.id)),i.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No locations found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("div",{}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!l,onClick:()=>a(),children:n})]})]})}function u({categories:e,value:t,onChange:s,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const r=e||[],d=(t||[]).length>0;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-list",children:[r.map(e=>{const a=(t||[]).some(t=>String(t)===String(e.id));return(0,o.jsx)("button",{type:"button",className:a?"bp-card active":"bp-card",onClick:()=>{return t=e.id,void s([t]);var t},children:(0,o.jsxs)("div",{className:"bp-card-row",children:[(0,o.jsx)("img",{className:"bp-card-thumb",src:c(e,"service-image.png"),alt:""}),(0,o.jsx)("div",{className:"bp-card-title",children:e.name})]})},e.id)}),r.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No categories found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:n,children:l})]})]})}function m({services:e,value:t,onChange:s,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const r=e||[],d=!!t;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[r.map(e=>{const a=String(t)===String(e.id);return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>s(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-thumb",src:c(e,"service-image.png"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.description}),(0,o.jsxs)("div",{className:"bp-meta",children:[!!e.duration&&(0,o.jsxs)("span",{className:"bp-chip",children:[e.duration," min"]}),!!e.category_name&&(0,o.jsx)("span",{className:"bp-chip ghost",children:e.category_name})]})]}),(0,o.jsxs)("div",{className:"bp-pickcard-right",children:[(0,o.jsx)("div",{className:"bp-price",children:null!=e.price?(0,o.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,o.jsx)("span",{className:"bp-price-cur",children:"Select"})}),(0,o.jsx)("div",{className:a?"bp-radio on":"bp-radio"})]})]},e.id)}),r.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No services found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:n,children:l})]})]})}function p({extras:e,value:t,onChange:s,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const r=e||[];return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[r.map(e=>{const a=(t||[]).some(t=>String(t)===String(e.id));return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>function(e){const a=String(e),n=(t||[]).some(e=>String(e)===a)?(t||[]).filter(e=>String(e)!==a):[...t||[],e];s(n)}(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-thumb",src:c(e,"service-image.png"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),(e.description||e.desc||e.summary)&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.description||e.desc||e.summary})]}),(0,o.jsxs)("div",{className:"bp-pickcard-right",children:[(0,o.jsx)("div",{className:"bp-price",children:null!=e.price?(0,o.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,o.jsx)("span",{className:"bp-price-cur",children:"Extra"})}),(0,o.jsx)("div",{className:a?"bp-check on":"bp-check"})]})]},e.id)}),r.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No extras for this service."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!1,onClick:n,children:l})]})]})}function b({agents:e,value:t,onChange:s,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const r=e||[],d=!!t;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[r.map(e=>{const a=String(t)===String(e.id);return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>s(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-avatar",src:c(e,"default-avatar.jpg"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.title&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.title}),!!e.email&&(0,o.jsx)("div",{className:"bp-pickcard-sub small",children:e.email})]}),(0,o.jsx)("div",{className:"bp-pickcard-right",children:(0,o.jsx)("div",{className:a?"bp-radio on":"bp-radio"})})]},e.id)}),r.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No agents available for this service."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:n,children:l})]})]})}const h=(e,t,s)=>new Date(Date.UTC(e,t,s,12,0,0)),g=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,x=(e,t)=>h(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+t),v=e=>{const t=new Date,s=h(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate());return e.getTime()<s.getTime()};async function f(e,t,{signal:s}={}){const a=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",n=window.BP_FRONT?.nonce,i=await fetch(`${a}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...n?{"X-WP-Nonce":n}:{}},body:JSON.stringify(t),signal:s,credentials:"same-origin"}),l=await i.text();let r;try{r=JSON.parse(l)}catch(e){r={ok:!1,raw:l}}if(!i.ok){const e=r?.message||r?.raw||`HTTP ${i.status}`;throw new Error(e)}return r}function y({serviceId:e,agentId:t,locationId:a,valueDate:n,valueSlot:i,onChangeDate:l,onChangeSlot:r,onBack:c,onNext:d,backLabel:u="<- Back",nextLabel:m="Next ->"}){const[p,b]=(0,s.useState)(()=>{const e=new Date;return h(e.getUTCFullYear(),e.getUTCMonth(),1)}),[y,N]=(0,s.useState)(n||null),[j,k]=(0,s.useState)([]),[S,w]=(0,s.useState)(!1),[_,C]=(0,s.useState)([]),[T,P]=(0,s.useState)(!1),[$,E]=(0,s.useState)(""),B=(0,s.useRef)(new Map),L=(0,s.useRef)(new Map),U=(0,s.useRef)(null),O=(0,s.useRef)(null),M=(0,s.useMemo)(()=>{var e;return`${p.getUTCFullYear()}-${e=p.getUTCMonth()+1,String(e).padStart(2,"0")}`},[p]),F=(0,s.useMemo)(()=>({service_id:e,agent_id:t,location_id:a,month:M}),[e,t,a,M]);(0,s.useEffect)(()=>{if(!e||!t)return;const s=JSON.stringify(F);if(B.current.has(s))return void k(B.current.get(s));U.current&&U.current.abort();const a=new AbortController;U.current=a,w(!0),f("/front/availability/month",F,{signal:a.signal}).then(e=>{const t=e?.data?.days||[];B.current.set(s,t),k(t)}).catch(()=>{}).finally(()=>w(!1))},[F,e,t]),(0,s.useEffect)(()=>{n&&n!==y&&N(n)},[n]);const I=(0,s.useMemo)(()=>({service_id:e,agent_id:t,location_id:a,date:y}),[e,t,a,y]);(0,s.useEffect)(()=>{if(!y||!e||!t)return;const s=JSON.stringify(I);if(L.current.has(s))return void C(L.current.get(s));O.current&&O.current.abort();const a=new AbortController;O.current=a,P(!0),C([]),E(""),f("/front/availability/day",I,{signal:a.signal}).then(e=>{const t=e?.slots||[];L.current.set(s,t),C(t)}).catch(e=>{"AbortError"!==e.name&&(C([]),E("No available times for this date."))}).finally(()=>P(!1))},[I,y,e,t]);const D=(0,s.useMemo)(()=>{const e=new Map;return j.forEach(t=>e.set(t.date,t)),e},[j]),R=(0,s.useMemo)(()=>(e=>{const t=h((s=e).getUTCFullYear(),s.getUTCMonth(),1);var s;const a=(e=>(e.getUTCDay()+6)%7)(t),n=x(t,-a);return Array.from({length:42},(e,t)=>x(n,t))})(p),[p]),A=!!y&&!!i?.start_time;return(0,o.jsxs)("div",{className:"bp-step bp-datetime",children:[(0,o.jsxs)("div",{className:"bp-calendar",children:[(0,o.jsxs)("div",{className:"bp-cal-header",children:[(0,o.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>b(e=>h(e.getUTCFullYear(),e.getUTCMonth()-1,1)),children:"<"}),(0,o.jsx)("div",{className:"bp-cal-title",children:p.toLocaleString(void 0,{month:"long",year:"numeric",timeZone:"UTC"})}),(0,o.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>b(e=>h(e.getUTCFullYear(),e.getUTCMonth()+1,1)),children:">"})]}),(0,o.jsx)("div",{className:"bp-cal-weekdays",children:["M","T","W","T","F","S","S"].map(e=>(0,o.jsx)("div",{className:"bp-cal-wd",children:e},e))}),(0,o.jsx)("div",{className:"bp-cal-grid",children:R.map((e,t)=>{const s=(n=p,(a=e).getUTCFullYear()===n.getUTCFullYear()&&a.getUTCMonth()===n.getUTCMonth());var a,n;const i=v(e)||!s,c=g(e),d=y===c,u=D.get(c),m=!!u&&u.has_slots;return(0,o.jsxs)("button",{type:"button",className:`bp-cal-day ${s?"":"is-out"} ${d?"is-selected":""}`,disabled:i,onClick:()=>function(e){if(v(e))return;const t=g(e);r?.(null),l?.(t)}(e),children:[(0,o.jsx)("div",{children:e.getUTCDate()}),(0,o.jsx)("div",{style:{height:4,width:28,borderRadius:999,margin:"6px auto 0",background:m?"#22c55e":"#e5e7eb",opacity:S&&!u?.3:1}})]},`${c}-${t}`)})})]}),(0,o.jsxs)("div",{className:"bp-slots",children:[(0,o.jsxs)("div",{className:"bp-slots-title",children:["Pick a slot for ",(0,o.jsx)("strong",{children:y||"—"})]}),!y&&(0,o.jsx)("div",{className:"bp-muted",children:"Select a date to see available times."}),y&&T&&(0,o.jsxs)("div",{className:"bp-slot-skeleton",children:[(0,o.jsx)("div",{className:"bp-skel"}),(0,o.jsx)("div",{className:"bp-skel"}),(0,o.jsx)("div",{className:"bp-skel"})]}),y&&!T&&$&&(0,o.jsx)("div",{className:"bp-error",children:$}),y&&!T&&!$&&(0,o.jsxs)("div",{className:"bp-slot-grid",children:[_.map((e,t)=>(0,o.jsx)("button",{type:"button",className:"bp-slot "+(i?.start_time===e.time?"is-selected":""),onClick:()=>r?.({start_time:e.time,end_time:e.end||""}),children:e.time},`${e.time}-${t}`)),0===_.length&&(0,o.jsx)("div",{className:"bp-muted",children:"No times found for this date."})]})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:c,children:u}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!A,onClick:d,children:m})]})]})}function N(e){return e?.id||e?.field_key||e?.name_key||""}function j(e){var t,s;return e&&"object"==typeof e?null!==(t=null!==(s=e.label)&&void 0!==s?s:e.value)&&void 0!==t?t:"":String(e)}function k(e){var t,s;return e&&"object"==typeof e?null!==(t=null!==(s=e.value)&&void 0!==s?s:e.label)&&void 0!==t?t:"":String(e)}function S({defs:e=[],layout:t=[],values:s,onChange:a,scope:n}){const i=t.map(t=>({layout:t,def:e.find(e=>N(e)===t.id)})).filter(e=>!!e.def),l=(e,t)=>{const i=n?`${n}.${e}`:e;a({...s||{},[i]:t})};return(0,o.jsx)("div",{className:"bp-fields-grid",children:i.map(({layout:e,def:t})=>{var a,i,r;const c=N(t),d=null!==(a=e.required)&&void 0!==a?a:!!(null!==(i=t.is_required)&&void 0!==i?i:t.required),u="half"===e.width?"half":"full",m=n?`${n}.${c}`:c,p=null!==(r=(s||{})[m])&&void 0!==r?r:"",b=(0,o.jsxs)("label",{className:"bp-label",children:[t.label," ",d?(0,o.jsx)("span",{className:"bp-req",children:"*"}):null]});if("textarea"===t.type)return(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsx)("textarea",{className:"bp-textarea",placeholder:t.placeholder||"",value:p,onChange:e=>l(c,e.target.value)})]},m);if("select"===t.type){const e=Array.isArray(t.options)?t.options:t.options?.choices||[];return(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsxs)("select",{className:"bp-select",value:p,onChange:e=>l(c,e.target.value),children:[(0,o.jsx)("option",{value:"",children:"Select…"}),e.map((e,t)=>(0,o.jsx)("option",{value:k(e),children:j(e)},t))]})]},m)}return"checkbox"===t.type?(0,o.jsx)("div",{className:`bp-field bp-${u}`,children:(0,o.jsxs)("label",{className:"bp-checkbox-row",children:[(0,o.jsx)("input",{type:"checkbox",checked:!!p,onChange:e=>l(c,e.target.checked)}),(0,o.jsxs)("span",{children:[t.label," ",d?(0,o.jsx)("span",{className:"bp-req",children:"*"}):null]})]})},m):"date"===t.type?(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsx)("input",{className:"bp-input-field",type:"date",value:p,onChange:e=>l(c,e.target.value)})]},m):(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsx)("input",{className:"bp-input-field",type:"tel"===t.type?"tel":"email"===t.type?"email":"text",placeholder:t.placeholder||"",value:p,onChange:e=>l(c,e.target.value)})]},m)})})}function w(e,t){return"checkbox"===t?!e:null==e||(Array.isArray(e)?0===e.length:""===String(e).trim())}function _(e){return e?.id||e?.field_key||e?.name_key||""}function C(e=[]){return e.map(e=>{var t,s;return{id:_(e),required:!(null===(t=null!==(s=e?.is_required)&&void 0!==s?s:e?.required)||void 0===t||!t),width:"full"}}).filter(e=>e.id)}function T({formFields:e,answers:t,onChange:s,onBack:a,onNext:n,onError:i,layout:l,backLabel:r="<- Back",nextLabel:c="Next ->"}){const d=e?.customer||[],u=e?.booking||[],m=l?.customer?.fields?.length?l.customer.fields:C(d),p=l?.booking?.fields?.length?l.booking.fields:C(u);function b(e,t){s(e&&"object"==typeof e&&void 0===t?e:s=>({...s,[e]:t}))}function h(e){var s;return null!==(s=t?.[e])&&void 0!==s?s:""}return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsx)(S,{defs:d,layout:m,values:t,onChange:b,scope:"customer"}),u.length?(0,o.jsx)("div",{style:{marginTop:14},children:(0,o.jsx)(S,{defs:u,layout:p,values:t,onChange:b,scope:"booking"})}):null,(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:r}),(0,o.jsx)("button",{type:"button",className:"bp-next",onClick:function(){const e=[{scope:"customer",defs:d,layout:m},{scope:"booking",defs:u,layout:p}];for(const n of e)for(const e of n.layout){var t,s,a;const l=n.defs.find(t=>_(t)===e.id);if(l&&((null!==(t=e.required)&&void 0!==t?t:null!==(s=null!==(a=l.is_required)&&void 0!==a?a:l.required)&&void 0!==s&&s)&&w(h(`${n.scope}.${e.id}`),l.type)))return void i?.(`${l.label||e.id} is required`)}i?.(""),n()},children:c})]})]})}const P={free:"Free (no payment)",cash:"Pay at location (Cash)",woocommerce:"Pay with WooCommerce",stripe:"Pay with Stripe",paypal:"Pay with PayPal"},$={cash:"Pay when you arrive.",free:"No payment required.",woocommerce:"Card / PayPal / gateways via WooCommerce.",stripe:"Secure card payment via Stripe.",paypal:"Pay using PayPal account or card."};function E({enabledMethods:e=["cash"],selected:t,onSelect:s,totalLabel:a="-",onBack:n,onNext:i,backLabel:l="<- Back",nextLabel:r="Next ->",loading:c=!1}){const d=Array.isArray(e)&&e.length?e:["cash"];return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-card-lite bp-p-14",children:[(0,o.jsx)("div",{className:"bp-font-900",children:"Payment Method"}),(0,o.jsxs)("div",{className:"bp-text-sm bp-muted bp-mt-6",children:["Total: ",(0,o.jsx)("strong",{children:a})]}),(0,o.jsx)("div",{className:"bp-mt-12 bp-pay-grid",children:d.map(e=>(0,o.jsxs)("button",{type:"button",className:"bp-pay-option "+(t===e?"is-active":""),onClick:()=>s?.(e),children:[(0,o.jsx)("div",{className:"bp-font-800",children:P[e]||e}),(0,o.jsx)("div",{className:"bp-text-xs bp-muted",children:$[e]||""})]},e))})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:n,children:l}),(0,o.jsx)("button",{type:"button",className:"bp-next",onClick:i,disabled:c,children:r})]})]})}function B({locationId:e,categoryIds:t,serviceId:a,extraIds:n,agentId:i,date:l,slot:r,locations:c,categories:d,services:u,extras:m,agents:p,formFields:b,answers:h,onBack:g,onSubmit:x,loading:v,backLabel:f="<- Back",nextLabel:y="Next ->"}){const N=c.find(t=>String(t.id)===String(e)),j=u.find(e=>String(e.id)===String(a)),k=p.find(e=>String(e.id)===String(i)),S=d.filter(e=>t.includes(e.id)||t.includes(String(e.id))),w=m.filter(e=>n.includes(e.id)||n.includes(String(e.id))),_=(0,s.useMemo)(()=>[...b?.form||[],...b?.customer||[],...b?.booking||[]],[b]);return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-review",children:[(0,o.jsx)(L,{label:"Location",value:N?.name}),(0,o.jsx)(L,{label:"Categories",value:S.length?S.map(e=>e.name).join(", "):"-"}),(0,o.jsx)(L,{label:"Service",value:j?.name}),(0,o.jsx)(L,{label:"Agent",value:k?.name}),(0,o.jsx)(L,{label:"Date",value:l}),(0,o.jsx)(L,{label:"Time",value:r?.start_time?`${r.start_time} - ${r.end_time}`:"-"}),(0,o.jsx)(L,{label:"Extras",value:w.length?w.map(e=>e.name).join(", "):"-"}),(0,o.jsx)("div",{className:"bp-review-section",children:"Customer Information"}),_.map(e=>{var t;const s=e.field_key||e.name_key||"",a=`${e.scope}.${s}`;let n=null!==(t=h?.[a])&&void 0!==t?t:"";return"checkbox"===e.type&&(n="1"===n?"Yes":"No"),(0,o.jsx)(L,{label:e.label,value:String(n||"")},a)})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:g,children:f}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:v,onClick:x,children:v?"Submitting...":y})]})]})}function L({label:e,value:t}){return(0,o.jsxs)("div",{className:"bp-review-row",children:[(0,o.jsx)("div",{className:"k",children:e}),(0,o.jsx)("div",{className:"v",children:t||"-"})]})}function U({booking:e,onClose:t}){return(0,o.jsx)("div",{className:"bp-step bp-done",children:(0,o.jsxs)("div",{className:"bp-done-card",children:[(0,o.jsx)("div",{className:"bp-done-title",children:"Booking confirmed"}),e?.booking_id?(0,o.jsxs)("div",{className:"bp-done-sub",children:["Booking ID: ",e.booking_id]}):null,e?.manage_url?(0,o.jsx)("a",{className:"bp-done-link",href:e.manage_url,target:"_blank",rel:"noreferrer",children:"Manage your booking"}):null,(0,o.jsx)("div",{className:"bp-done-actions",children:(0,o.jsx)("button",{type:"button",className:"bp-next",onClick:t,children:"Close"})})]})})}let O="undefined"!=typeof window&&window.BP_FRONT?.settings||null;const M=[{key:"location",title:"Location Selection",icon:"location-image.png"},{key:"category",title:"Choose Category",icon:"service-image.png"},{key:"service",title:"Choose Service",icon:"service-image.png"},{key:"extras",title:"Service Extras",icon:"service-image.png"},{key:"agent",title:"Choose Agent",icon:"default-avatar.jpg"},{key:"datetime",title:"Choose Date & Time",icon:"blue-dot.png"},{key:"customer",title:"Customer Information",icon:"default-avatar.jpg"},{key:"review",title:"Review Order",icon:"white-curve.png"},{key:"done",title:"Done",icon:"logo.png"}];function F({open:e,onClose:t,brand:a}){const[c,h]=(0,s.useState)(0),{config:g,loading:x,error:v}=function(e){const[t,a]=(0,s.useState)(!1),[n,i]=(0,s.useState)(null),[l,r]=(0,s.useState)("");return(0,s.useEffect)(()=>{if(!e)return;let t=!0;a(!0),r("");const s=`/wp-json/bp/v1/front/booking-form-design?_t=${Date.now()}`;return fetch(s,{credentials:"same-origin"}).then(async e=>{const t=await e.json().catch(()=>null);if(!e.ok)throw new Error(t?.message||`Design fetch failed (${e.status})`);return t}).then(e=>{t&&i(e?.config||null)}).catch(e=>{t&&(i(null),r(e.message||"Design fetch failed"))}).finally(()=>{t&&a(!1)}),()=>{t=!1}},[e]),{config:n,loading:t,error:l}}(e),f=(0,s.useMemo)(()=>function(e){const t=(Array.isArray(e?.steps)?e.steps:[]).filter(e=>e&&e.key&&!1!==e.enabled),s=new Map(M.map(e=>[e.key,e])),a=e=>"agents"===e?"agent":"confirm"===e||"confirmation"===e?"done":e,n=t.length?t.map(e=>({...s.get(a(e.key))||{key:a(e.key),title:e.title||e.key,icon:"service-image.png"},...e,key:a(e.key),title:e.title||s.get(a(e.key))?.title||e.key,subtitle:e.subtitle||""})):M.slice(),i=new Set;return n.filter(e=>!i.has(e.key)&&(i.add(e.key),!0))}(g),[g]),{settings:N}=function(e){const[t,a]=(0,s.useState)(O),[n,i]=(0,s.useState)(!O&&!!e);return(0,s.useEffect)(()=>{if(!e)return;if(O)return void a(O);let t=!0;return i(!0),fetch(`/wp-json/bp/v1/front/settings?_t=${Date.now()}`,{credentials:"same-origin"}).then(e=>e.json()).then(e=>{if(!t)return;const s=e?.settings||null;O=s,a(s)}).catch(()=>{t&&a(null)}).finally(()=>{t&&i(!1)}),()=>{t=!1}},[e]),{settings:t,loading:n}}(e),[j,k]=(0,s.useState)(null),[S,w]=(0,s.useState)([]),[_,C]=(0,s.useState)(null),[P,$]=(0,s.useState)([]),[L,F]=(0,s.useState)(null),[R,A]=(0,s.useState)(null),[q,J]=(0,s.useState)(null),[Y,W]=(0,s.useState)(null),[z,H]=(0,s.useState)(!1),[K,X]=(0,s.useState)({form:[],customer:[],booking:[]}),[Z,G]=(0,s.useState)({}),[Q,V]=(0,s.useState)([]),[ee,te]=(0,s.useState)([]),[se,ae]=(0,s.useState)([]),[ne,ie]=(0,s.useState)([]),[le,re]=(0,s.useState)([]),[ce,oe]=(0,s.useState)(!1),[de,ue]=(0,s.useState)(""),me=f[c]||f[0]||M[0],pe=(0,s.useMemo)(()=>{if(me?.imageUrl)return me.imageUrl;const e=me?.icon||me?.image||"service-image.png";return a?.imagesBase?a.imagesBase+e:""},[a,me]),be=g?.texts?.helpTitle||"Need help?",he=g?.texts?.helpPhone||g?.layout?.helpPhone||a?.helpPhone||"",ge=!1!==me?.showLeftPanel,xe=!1!==me?.showHelpBox,ve=Array.isArray(N?.payments_enabled_methods)&&N.payments_enabled_methods.length?N.payments_enabled_methods:["cash"],fe=(0,s.useMemo)(()=>{const e=se.find(e=>String(e.id)===String(_));return(null!=e?.price?Number(e.price):0)+ne.filter(e=>P.includes(e.id)||P.includes(String(e.id))).reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0)},[se,_,ne,P]);function ye(){ue(""),"payment"!==me?.key||Y?h(e=>Math.min(e+1,f.length-1)):ue("Select a payment method")}function Ne(){ue(""),h(e=>Math.max(e-1,0))}return(0,s.useEffect)(()=>{if(e)return document.body.classList.add("bp-modal-open"),()=>document.body.classList.remove("bp-modal-open")},[e]),(0,s.useEffect)(()=>{e&&(h(0),ue(""),k(null),w([]),C(null),$([]),F(null),A(null),J(null),W(null),H(!1),G({}))},[e]),(0,s.useEffect)(()=>{e&&!Y&&N?.payments_default_method&&W(N.payments_default_method)},[e,N,Y]),(0,s.useEffect)(()=>{if(!e||z)return;const t=new URLSearchParams(window.location.search),s=t.get("bp_payment"),a=t.get("token"),i=Number(t.get("booking_id")||0),l=f.findIndex(e=>"done"===e.key),r=e=>{G(t=>({...t,__booking:{booking_id:e}})),h(l>=0?l:f.length-1)},c=()=>{const e=new URL(window.location.href);e.searchParams.delete("bp_payment"),e.searchParams.delete("token"),e.searchParams.delete("booking_id"),window.history.replaceState({},document.title,e.toString())};return"paypal_cancel"===s?(H(!0),ue("PayPal payment cancelled"),void c()):"stripe_cancel"===s?(H(!0),ue("Stripe payment cancelled"),void c()):("paypal_return"===s||"paypal"===s)&&a&&i?(H(!0),oe(!0),void(o={order_id:a,booking_id:i},n("/front/payments/paypal/capture",{method:"POST",body:JSON.stringify(o)})).then(()=>{r(i),c()}).catch(e=>ue(e?.message||"PayPal capture failed")).finally(()=>oe(!1))):void("stripe_success"===s&&i&&(H(!0),r(i),c()));var o},[e,z,f]),(0,s.useEffect)(()=>{"Select a payment method"===de&&Y&&ue("")},[de,Y]),(0,s.useEffect)(()=>{e&&(async()=>{try{oe(!0);const[e,t,s]=await Promise.all([n("/front/locations"),n("/front/categories"),r()]);V(e),te(t),X(s)}catch(e){ue(e?.message||"Failed to load booking data.")}finally{oe(!1)}})()},[e]),(0,s.useEffect)(()=>{e&&f.map(e=>e.key).join("|")&&h(0)},[e,f]),(0,s.useEffect)(()=>{h(e=>e<0?0:e>=f.length?Math.max(0,f.length-1):e)},[f.length]),(0,s.useEffect)(()=>{e&&(async()=>{try{if("service"===me.key||"extras"===me.key||"agent"===me.key||"datetime"===me.key||"review"===me.key){const e=await(({category_ids:e=[],location_id:t=null})=>n("/front/services",{method:"POST",body:JSON.stringify({category_ids:e,location_id:t})}))({category_ids:S,location_id:j});ae(e)}}catch(e){ae([])}})()},[e,me.key,S,j]),(0,s.useEffect)(()=>{e&&(async()=>{try{if(!_)return;const[e,t]=await Promise.all([i({service_id:_}),l({service_id:_,location_id:j})]);ie(e),re(t)}catch(e){ie([]),re([])}})()},[e,_,j]),e?x&&!g?(0,o.jsx)("div",{className:"bp-wizard-loading",children:"Loading booking form…"}):v&&!g?(0,o.jsxs)("div",{className:"bp-wizard-loading",children:["Wizard error: ",v]}):f.length?(0,o.jsx)("div",{className:"bp-modal-overlay",role:"dialog","aria-modal":"true",children:(0,o.jsxs)("div",{className:"bp-modal",children:[(0,o.jsx)("button",{className:"bp-modal-close",onClick:t,"aria-label":"Close",children:"x"}),(0,o.jsxs)("div",{className:"bp-modal-grid",children:[ge?(0,o.jsxs)("aside",{className:"bp-side",children:[(0,o.jsx)("div",{className:"bp-side-icon",children:pe?(0,o.jsx)("img",{src:pe,alt:""}):null}),(0,o.jsx)("h3",{className:"bp-side-title",children:me.title}),(0,o.jsx)("p",{className:"bp-side-desc",children:me.subtitle||"Please complete the steps to schedule your booking."}),xe?(0,o.jsxs)("div",{className:"bp-side-help",children:[(0,o.jsx)("div",{children:be}),(0,o.jsx)("div",{className:"bp-help-phone",children:he})]}):null]}):null,(0,o.jsxs)("main",{className:"bp-main",children:[(0,o.jsxs)("div",{className:"bp-main-head",children:[(0,o.jsx)("h2",{children:me.title}),(0,o.jsx)("div",{className:"bp-step-dots",children:f.slice(0,8).map((e,t)=>(0,o.jsx)("span",{className:t===c?"bp-dot active":"bp-dot"},e.key))})]}),de?(0,o.jsx)("div",{className:"bp-error",children:de}):null,ce?(0,o.jsx)("div",{className:"bp-loading",children:"Loading..."}):null,"location"===me.key&&(0,o.jsx)(d,{locations:Q,value:j,onChange:k,onNext:ye}),"category"===me.key&&(0,o.jsx)(u,{categories:ee,value:S,onChange:w,onBack:Ne,onNext:ye}),"service"===me.key&&(0,o.jsx)(m,{services:se,value:_,onChange:C,onBack:Ne,onNext:ye}),"extras"===me.key&&(0,o.jsx)(p,{extras:ne,value:P,onChange:$,onBack:Ne,onNext:ye}),"agent"===me.key&&(0,o.jsx)(b,{agents:le,value:L,onChange:F,onBack:Ne,onNext:ye}),"datetime"===me.key&&(0,o.jsx)(y,{locationId:j,serviceId:_,agentId:L,serviceDurationMin:se.find(e=>String(e.id)===String(_))?.duration||30,valueDate:R,valueSlot:q,onChangeDate:e=>{A(e),J(null)},onChangeSlot:J,onBack:Ne,onNext:ye}),"customer"===me.key&&(0,o.jsx)(T,{formFields:K,answers:Z,onChange:G,onBack:Ne,onNext:ye,onError:ue,layout:g?.fieldsLayout}),"payment"===me.key&&(0,o.jsx)(E,{enabledMethods:ve,selected:Y,onSelect:W,totalLabel:I(fe,N),onBack:Ne,onNext:ye}),"review"===me.key&&(0,o.jsx)(B,{locationId:j,categoryIds:S,serviceId:_,extraIds:P,agentId:L,date:R,slot:q,locations:Q,categories:ee,services:se,extras:ne,agents:le,formFields:K,answers:Z,onBack:Ne,onSubmit:async function(){try{oe(!0),ue("");const e={},t={};Object.entries(Z||{}).forEach(([s,a])=>{s.startsWith("customer.")?e[s.slice(9)]=a:s.startsWith("booking.")&&(t[s.slice(8)]=a)});const s={location_id:j,category_ids:S,service_id:_,extra_ids:P,agent_id:L,date:R,start_time:q?.start_time||q?.start||"",end_time:q?.end_time||q?.end||"",field_values:Z,customer_fields:e,booking_fields:t,extras:P,total_price:fe,currency:N?.currency||"USD"},a=Y||N?.payments_default_method||"cash";if(s.payment_method=a,"woocommerce"===a){const e=await(e=>n("/front/payments/woocommerce/start",{method:"POST",body:JSON.stringify(e)}))(s);if(!e?.checkout_url)throw new Error("Checkout URL missing");return void(window.location.href=e.checkout_url)}if("stripe"===a){const e=await(e=>n("/front/payments/stripe/start",{method:"POST",body:JSON.stringify(e)}))(s);if(!e?.checkout_url)throw new Error("Stripe checkout URL missing");return void(window.location.href=e.checkout_url)}if("paypal"===a){const e=await(e=>n("/front/payments/paypal/start",{method:"POST",body:JSON.stringify(e)}))(s);if(!e?.approve_url)throw new Error("PayPal approve URL missing");return void(window.location.href=e.approve_url)}if("cash"!==a&&"free"!==a)throw new Error("Unsupported payment method");const i=await(e=>n("/front/bookings",{method:"POST",body:JSON.stringify(e)}))(s);G(e=>({...e,__booking:i}));const l=f.findIndex(e=>"done"===e.key);h(l>=0?l:f.length-1)}catch(e){ue(e?.message||"Could not submit booking.")}finally{oe(!1)}},loading:ce}),"done"===me.key&&(0,o.jsx)(U,{booking:Z.__booking,onClose:t})]}),(0,o.jsxs)("aside",{className:"bp-summary",children:[(0,o.jsx)("div",{className:"bp-summary-title",children:"Summary"}),(0,o.jsx)("div",{className:"bp-summary-box",children:(0,o.jsx)(D,{locations:Q,categories:ee,services:se,extras:ne,agents:le,locationId:j,categoryIds:S,serviceId:_,extraIds:P,agentId:L,date:R,slot:q})})]})]})]})}):(0,o.jsx)("div",{className:"bp-wizard-loading",children:"Wizard config invalid (no steps)"}):null}function I(e,t={}){if(null==e)return"-";const s=Number(e);if(!Number.isFinite(s))return"-";const a=t.currency||"USD",n="after"===t.currency_position?"after":"before",i=s.toLocaleString(void 0,{minimumFractionDigits:s%1==0?0:2,maximumFractionDigits:2});return"after"===n?`${i} ${a}`:`${a} ${i}`}function D(e){const{locations:t,categories:s,services:a,extras:n,agents:i,locationId:l,categoryIds:r,serviceId:c,extraIds:d,agentId:u,date:m,slot:p}=e,b=t.find(e=>String(e.id)===String(l)),h=a.find(e=>String(e.id)===String(c)),g=i.find(e=>String(e.id)===String(u)),x=n.filter(e=>d.includes(e.id)||d.includes(String(e.id))),v=s.filter(e=>r.includes(e.id)||r.includes(String(e.id))),f=null!=h?.price?Number(h.price):0,y=x.reduce((e,t)=>e+(null!=t?.price?Number(t.price):0),0),N=f+y;function j(e){return e||0===e?`${Number(e).toFixed(0)} Kr`:"-"}return(0,o.jsxs)("div",{className:"bp-summary-items",children:[(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Location"}),(0,o.jsx)("div",{className:"v",children:b?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Category"}),(0,o.jsx)("div",{className:"v",children:v.length?v.map(e=>e.name).join(", "):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Service"}),(0,o.jsx)("div",{className:"v",children:h?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Service Price"}),(0,o.jsx)("div",{className:"v",children:null!=h?.price?j(f):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Agent"}),(0,o.jsx)("div",{className:"v",children:g?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Date"}),(0,o.jsx)("div",{className:"v",children:m||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Time"}),(0,o.jsx)("div",{className:"v",children:p?.start_time?`${p.start_time} - ${p.end_time}`:"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Extras"}),(0,o.jsx)("div",{className:"v",children:x.length?x.map(e=>e.name).join(", "):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Extras Price"}),(0,o.jsx)("div",{className:"v",children:x.length?j(y):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Total"}),(0,o.jsx)("div",{className:"v",children:null!=h?.price||x.length?j(N):"-"})]})]})}function R({label:e,mountEl:t}){const[a,n]=(0,s.useState)(!1),i="1"===t?.getAttribute("data-bp-fallback"),l=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",r=(0,s.useMemo)(()=>({imagesBase:l,helpPhone:"+45 91 67 14 52"}),[l]);return(0,s.useEffect)(()=>function(e,t){return e?(e.__bpOpen=()=>t(!0),()=>{e.__bpOpen&&delete e.__bpOpen}):()=>{}}(t,n),[t]),(0,o.jsxs)(o.Fragment,{children:[!i&&(0,o.jsx)("button",{className:"bp-book-btn",type:"button",onClick:()=>n(!0),children:e||"Book Now"}),(0,o.jsx)(F,{open:a,onClose:()=>n(!1),brand:r})]})}function A(){const e=document.querySelectorAll(".bp-front-root[data-bp-widget='wizard']");e.length?(e.forEach(e=>{const t=(0,a.H)(e),s=e.getAttribute("data-bp-label")||"Book Now";t.render((0,o.jsx)(R,{label:s,mountEl:e}))}),document.addEventListener("click",e=>{const t=e.target;if(!(t instanceof Element))return;const s=t.closest('.bp-fallback-btn, [data-bp-open="wizard"]');if(!s)return;const a=s.nextElementSibling,n=a&&a.classList.contains("bp-front-root")?a:s.closest(".bp-front-root")||document.querySelector(".bp-front-root");n&&"function"==typeof n.__bpOpen&&(e.preventDefault(),n.__bpOpen())})):function(){const e=document.getElementById("bp-front-root");if(!e)return;const t=(0,a.H)(e),s={imagesBase:(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",helpPhone:"+45 91 67 14 52"};document.addEventListener("click",a=>{const n=a.target;n instanceof Element&&n.closest(".bp-open-wizard")&&(a.preventDefault(),e.style.display="block",t.render((0,o.jsx)(F,{open:!0,onClose:()=>{t.render(null),e.style.display="none"},brand:s})))})}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",A):A()})();