(()=>{"use strict";var e={338(e,s,t){var a=t(795);s.H=a.createRoot,a.hydrateRoot},795(e){e.exports=window.ReactDOM}},s={};const t=window.React;var a=function t(a){var n=s[a];if(void 0!==n)return n.exports;var i=s[a]={exports:{}};return e[a](i,i.exports,t),i.exports}(338);async function n(e,s={}){var t;const a=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",n=window.BP_FRONT?.nonce,i=await fetch(`${a}${e}`,{...s,headers:{"Content-Type":"application/json",...n?{"X-WP-Nonce":n}:{},...s.headers||{}}}),l=await i.json().catch(()=>({}));if(!i.ok||"error"===l?.status)throw new Error(l?.message||"Request failed");return null!==(t=l?.data)&&void 0!==t?t:l}const i=({service_id:e})=>n("/front/extras",{method:"POST",body:JSON.stringify({service_id:e})}),l=({service_id:e,location_id:s})=>n("/front/agents",{method:"POST",body:JSON.stringify({service_id:e,location_id:s})}),c=async()=>{const e=await n("/front/form-fields/active");if(e&&e.form&&e.customer&&e.booking)return e;const s=await n("/front/form-fields"),t=[],a=[],i=[];return(Array.isArray(s)?s:[]).forEach(e=>{const s=e.scope||"customer";"booking"===s?i.push(e):"form"===s?t.push(e):a.push(e)}),{form:t,customer:a,booking:i}};function r(e,s){const t=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return e?.image_url||e?.image||""||t+s}const o=window.ReactJSXRuntime;function d({locations:e,value:s,onChange:t,onNext:a,nextLabel:n="Next ->"}){const i=e||[],l=!!s;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-list",children:[i.map(e=>(0,o.jsx)("button",{type:"button",className:String(s)===String(e.id)?"bp-card active":"bp-card",onClick:()=>t(e.id),children:(0,o.jsxs)("div",{className:"bp-card-row",children:[(0,o.jsx)("img",{className:"bp-card-thumb",src:r(e,"location-image.png"),alt:""}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"bp-card-title",children:e.name}),(0,o.jsx)("div",{className:"bp-card-sub",children:e.address||""})]})]})},e.id)),i.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No locations found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("div",{}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!l,onClick:()=>a(),children:n})]})]})}function u({categories:e,value:s,onChange:t,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const c=e||[],d=(s||[]).length>0;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-list",children:[c.map(e=>{const a=(s||[]).some(s=>String(s)===String(e.id));return(0,o.jsx)("button",{type:"button",className:a?"bp-card active":"bp-card",onClick:()=>{return s=e.id,void t([s]);var s},children:(0,o.jsxs)("div",{className:"bp-card-row",children:[(0,o.jsx)("img",{className:"bp-card-thumb",src:r(e,"service-image.png"),alt:""}),(0,o.jsx)("div",{className:"bp-card-title",children:e.name})]})},e.id)}),c.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No categories found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:n,children:l})]})]})}function m({services:e,value:s,onChange:t,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const c=e||[],d=!!s;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[c.map(e=>{const a=String(s)===String(e.id);return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>t(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-thumb",src:r(e,"service-image.png"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.description}),(0,o.jsxs)("div",{className:"bp-meta",children:[!!e.duration&&(0,o.jsxs)("span",{className:"bp-chip",children:[e.duration," min"]}),!!e.category_name&&(0,o.jsx)("span",{className:"bp-chip ghost",children:e.category_name})]})]}),(0,o.jsxs)("div",{className:"bp-pickcard-right",children:[(0,o.jsx)("div",{className:"bp-price",children:null!=e.price?(0,o.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,o.jsx)("span",{className:"bp-price-cur",children:"Select"})}),(0,o.jsx)("div",{className:a?"bp-radio on":"bp-radio"})]})]},e.id)}),c.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No services found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:n,children:l})]})]})}function p({extras:e,value:s,onChange:t,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const c=e||[];return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[c.map(e=>{const a=(s||[]).some(s=>String(s)===String(e.id));return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>function(e){const a=String(e),n=(s||[]).some(e=>String(e)===a)?(s||[]).filter(e=>String(e)!==a):[...s||[],e];t(n)}(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-thumb",src:r(e,"service-image.png"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),(e.description||e.desc||e.summary)&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.description||e.desc||e.summary})]}),(0,o.jsxs)("div",{className:"bp-pickcard-right",children:[(0,o.jsx)("div",{className:"bp-price",children:null!=e.price?(0,o.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,o.jsx)("span",{className:"bp-price-cur",children:"Extra"})}),(0,o.jsx)("div",{className:a?"bp-check on":"bp-check"})]})]},e.id)}),c.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No extras for this service."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!1,onClick:n,children:l})]})]})}function b({agents:e,value:s,onChange:t,onBack:a,onNext:n,backLabel:i="<- Back",nextLabel:l="Next ->"}){const c=e||[],d=!!s;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[c.map(e=>{const a=String(s)===String(e.id);return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>t(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-avatar",src:r(e,"default-avatar.jpg"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.title&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.title}),!!e.email&&(0,o.jsx)("div",{className:"bp-pickcard-sub small",children:e.email})]}),(0,o.jsx)("div",{className:"bp-pickcard-right",children:(0,o.jsx)("div",{className:a?"bp-radio on":"bp-radio"})})]},e.id)}),c.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No agents available for this service."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:i}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!d,onClick:n,children:l})]})]})}const h=(e,s,t)=>new Date(Date.UTC(e,s,t,12,0,0)),g=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,x=(e,s)=>h(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+s),v=e=>{const s=new Date,t=h(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate());return e.getTime()<t.getTime()};async function f(e,s,{signal:t}={}){const a=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",n=window.BP_FRONT?.nonce,i=await fetch(`${a}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...n?{"X-WP-Nonce":n}:{}},body:JSON.stringify(s),signal:t,credentials:"same-origin"}),l=await i.text();let c;try{c=JSON.parse(l)}catch(e){c={ok:!1,raw:l}}if(!i.ok){const e=c?.message||c?.raw||`HTTP ${i.status}`;throw new Error(e)}return c}function j({serviceId:e,agentId:s,locationId:a,valueDate:n,valueSlot:i,onChangeDate:l,onChangeSlot:c,onBack:r,onNext:d,backLabel:u="<- Back",nextLabel:m="Next ->"}){const[p,b]=(0,t.useState)(()=>{const e=new Date;return h(e.getUTCFullYear(),e.getUTCMonth(),1)}),[j,N]=(0,t.useState)(n||null),[y,k]=(0,t.useState)([]),[S,C]=(0,t.useState)(!1),[w,_]=(0,t.useState)([]),[T,$]=(0,t.useState)(!1),[B,E]=(0,t.useState)(""),I=(0,t.useRef)(new Map),M=(0,t.useRef)(new Map),U=(0,t.useRef)(null),L=(0,t.useRef)(null),O=(0,t.useMemo)(()=>{var e;return`${p.getUTCFullYear()}-${e=p.getUTCMonth()+1,String(e).padStart(2,"0")}`},[p]),F=(0,t.useMemo)(()=>({service_id:e,agent_id:s,location_id:a,month:O}),[e,s,a,O]);(0,t.useEffect)(()=>{if(!e||!s)return;const t=JSON.stringify(F);if(I.current.has(t))return void k(I.current.get(t));U.current&&U.current.abort();const a=new AbortController;U.current=a,C(!0),f("/front/availability/month",F,{signal:a.signal}).then(e=>{const s=e?.data?.days||[];I.current.set(t,s),k(s)}).catch(()=>{}).finally(()=>C(!1))},[F,e,s]),(0,t.useEffect)(()=>{n&&n!==j&&N(n)},[n]);const P=(0,t.useMemo)(()=>({service_id:e,agent_id:s,location_id:a,date:j}),[e,s,a,j]);(0,t.useEffect)(()=>{if(!j||!e||!s)return;const t=JSON.stringify(P);if(M.current.has(t))return void _(M.current.get(t));L.current&&L.current.abort();const a=new AbortController;L.current=a,$(!0),_([]),E(""),f("/front/availability/day",P,{signal:a.signal}).then(e=>{const s=e?.slots||[];M.current.set(t,s),_(s)}).catch(e=>{"AbortError"!==e.name&&(_([]),E("No available times for this date."))}).finally(()=>$(!1))},[P,j,e,s]);const D=(0,t.useMemo)(()=>{const e=new Map;return y.forEach(s=>e.set(s.date,s)),e},[y]),R=(0,t.useMemo)(()=>(e=>{const s=h((t=e).getUTCFullYear(),t.getUTCMonth(),1);var t;const a=(e=>(e.getUTCDay()+6)%7)(s),n=x(s,-a);return Array.from({length:42},(e,s)=>x(n,s))})(p),[p]),A=!!j&&!!i?.start_time;return(0,o.jsxs)("div",{className:"bp-step bp-datetime",children:[(0,o.jsxs)("div",{className:"bp-calendar",children:[(0,o.jsxs)("div",{className:"bp-cal-header",children:[(0,o.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>b(e=>h(e.getUTCFullYear(),e.getUTCMonth()-1,1)),children:"<"}),(0,o.jsx)("div",{className:"bp-cal-title",children:p.toLocaleString(void 0,{month:"long",year:"numeric",timeZone:"UTC"})}),(0,o.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>b(e=>h(e.getUTCFullYear(),e.getUTCMonth()+1,1)),children:">"})]}),(0,o.jsx)("div",{className:"bp-cal-weekdays",children:["M","T","W","T","F","S","S"].map(e=>(0,o.jsx)("div",{className:"bp-cal-wd",children:e},e))}),(0,o.jsx)("div",{className:"bp-cal-grid",children:R.map((e,s)=>{const t=(n=p,(a=e).getUTCFullYear()===n.getUTCFullYear()&&a.getUTCMonth()===n.getUTCMonth());var a,n;const i=v(e)||!t,r=g(e),d=j===r,u=D.get(r),m=!!u&&u.has_slots;return(0,o.jsxs)("button",{type:"button",className:`bp-cal-day ${t?"":"is-out"} ${d?"is-selected":""}`,disabled:i,onClick:()=>function(e){if(v(e))return;const s=g(e);c?.(null),l?.(s)}(e),children:[(0,o.jsx)("div",{children:e.getUTCDate()}),(0,o.jsx)("div",{style:{height:4,width:28,borderRadius:999,margin:"6px auto 0",background:m?"#22c55e":"#e5e7eb",opacity:S&&!u?.3:1}})]},`${r}-${s}`)})})]}),(0,o.jsxs)("div",{className:"bp-slots",children:[(0,o.jsxs)("div",{className:"bp-slots-title",children:["Pick a slot for ",(0,o.jsx)("strong",{children:j||"—"})]}),!j&&(0,o.jsx)("div",{className:"bp-muted",children:"Select a date to see available times."}),j&&T&&(0,o.jsxs)("div",{className:"bp-slot-skeleton",children:[(0,o.jsx)("div",{className:"bp-skel"}),(0,o.jsx)("div",{className:"bp-skel"}),(0,o.jsx)("div",{className:"bp-skel"})]}),j&&!T&&B&&(0,o.jsx)("div",{className:"bp-error",children:B}),j&&!T&&!B&&(0,o.jsxs)("div",{className:"bp-slot-grid",children:[w.map((e,s)=>(0,o.jsx)("button",{type:"button",className:"bp-slot "+(i?.start_time===e.time?"is-selected":""),onClick:()=>c?.({start_time:e.time,end_time:e.end||""}),children:e.time},`${e.time}-${s}`)),0===w.length&&(0,o.jsx)("div",{className:"bp-muted",children:"No times found for this date."})]})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:r,children:u}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!A,onClick:d,children:m})]})]})}function N(e){return e?.id||e?.field_key||e?.name_key||""}function y(e){var s,t;return e&&"object"==typeof e?null!==(s=null!==(t=e.label)&&void 0!==t?t:e.value)&&void 0!==s?s:"":String(e)}function k(e){var s,t;return e&&"object"==typeof e?null!==(s=null!==(t=e.value)&&void 0!==t?t:e.label)&&void 0!==s?s:"":String(e)}function S({defs:e=[],layout:s=[],values:t,onChange:a,scope:n}){const i=s.map(s=>({layout:s,def:e.find(e=>N(e)===s.id)})).filter(e=>!!e.def),l=(e,s)=>{const i=n?`${n}.${e}`:e;a({...t||{},[i]:s})};return(0,o.jsx)("div",{className:"bp-fields-grid",children:i.map(({layout:e,def:s})=>{var a,i,c;const r=N(s),d=null!==(a=e.required)&&void 0!==a?a:!!(null!==(i=s.is_required)&&void 0!==i?i:s.required),u="half"===e.width?"half":"full",m=n?`${n}.${r}`:r,p=null!==(c=(t||{})[m])&&void 0!==c?c:"",b=(0,o.jsxs)("label",{className:"bp-label",children:[s.label," ",d?(0,o.jsx)("span",{className:"bp-req",children:"*"}):null]});if("textarea"===s.type)return(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsx)("textarea",{className:"bp-textarea",placeholder:s.placeholder||"",value:p,onChange:e=>l(r,e.target.value)})]},m);if("select"===s.type){const e=Array.isArray(s.options)?s.options:s.options?.choices||[];return(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsxs)("select",{className:"bp-select",value:p,onChange:e=>l(r,e.target.value),children:[(0,o.jsx)("option",{value:"",children:"Select…"}),e.map((e,s)=>(0,o.jsx)("option",{value:k(e),children:y(e)},s))]})]},m)}return"checkbox"===s.type?(0,o.jsx)("div",{className:`bp-field bp-${u}`,children:(0,o.jsxs)("label",{className:"bp-checkbox-row",children:[(0,o.jsx)("input",{type:"checkbox",checked:!!p,onChange:e=>l(r,e.target.checked)}),(0,o.jsxs)("span",{children:[s.label," ",d?(0,o.jsx)("span",{className:"bp-req",children:"*"}):null]})]})},m):"date"===s.type?(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsx)("input",{className:"bp-input-field",type:"date",value:p,onChange:e=>l(r,e.target.value)})]},m):(0,o.jsxs)("div",{className:`bp-field bp-${u}`,children:[b,(0,o.jsx)("input",{className:"bp-input-field",type:"tel"===s.type?"tel":"email"===s.type?"email":"text",placeholder:s.placeholder||"",value:p,onChange:e=>l(r,e.target.value)})]},m)})})}function C(e,s){return"checkbox"===s?!e:null==e||(Array.isArray(e)?0===e.length:""===String(e).trim())}function w(e){return e?.id||e?.field_key||e?.name_key||""}function _(e=[]){return e.map(e=>{var s,t;return{id:w(e),required:!(null===(s=null!==(t=e?.is_required)&&void 0!==t?t:e?.required)||void 0===s||!s),width:"full"}}).filter(e=>e.id)}function T({formFields:e,answers:s,onChange:t,onBack:a,onNext:n,onError:i,layout:l,backLabel:c="<- Back",nextLabel:r="Next ->"}){const d=e?.customer||[],u=e?.booking||[],m=l?.customer?.fields?.length?l.customer.fields:_(d),p=l?.booking?.fields?.length?l.booking.fields:_(u);function b(e,s){t(e&&"object"==typeof e&&void 0===s?e:t=>({...t,[e]:s}))}function h(e){var t;return null!==(t=s?.[e])&&void 0!==t?t:""}return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsx)(S,{defs:d,layout:m,values:s,onChange:b,scope:"customer"}),u.length?(0,o.jsx)("div",{style:{marginTop:14},children:(0,o.jsx)(S,{defs:u,layout:p,values:s,onChange:b,scope:"booking"})}):null,(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:c}),(0,o.jsx)("button",{type:"button",className:"bp-next",onClick:function(){const e=[{scope:"customer",defs:d,layout:m},{scope:"booking",defs:u,layout:p}];for(const n of e)for(const e of n.layout){var s,t,a;const l=n.defs.find(s=>w(s)===e.id);if(l&&((null!==(s=e.required)&&void 0!==s?s:null!==(t=null!==(a=l.is_required)&&void 0!==a?a:l.required)&&void 0!==t&&t)&&C(h(`${n.scope}.${e.id}`),l.type)))return void i?.(`${l.label||e.id} is required`)}i?.(""),n()},children:r})]})]})}function $({locationId:e,categoryIds:s,serviceId:a,extraIds:n,agentId:i,date:l,slot:c,locations:r,categories:d,services:u,extras:m,agents:p,formFields:b,answers:h,onBack:g,onSubmit:x,loading:v,backLabel:f="<- Back",nextLabel:j="Next ->"}){const N=r.find(s=>String(s.id)===String(e)),y=u.find(e=>String(e.id)===String(a)),k=p.find(e=>String(e.id)===String(i)),S=d.filter(e=>s.includes(e.id)||s.includes(String(e.id))),C=m.filter(e=>n.includes(e.id)||n.includes(String(e.id))),w=(0,t.useMemo)(()=>[...b?.form||[],...b?.customer||[],...b?.booking||[]],[b]);return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-review",children:[(0,o.jsx)(B,{label:"Location",value:N?.name}),(0,o.jsx)(B,{label:"Categories",value:S.length?S.map(e=>e.name).join(", "):"-"}),(0,o.jsx)(B,{label:"Service",value:y?.name}),(0,o.jsx)(B,{label:"Agent",value:k?.name}),(0,o.jsx)(B,{label:"Date",value:l}),(0,o.jsx)(B,{label:"Time",value:c?.start_time?`${c.start_time} - ${c.end_time}`:"-"}),(0,o.jsx)(B,{label:"Extras",value:C.length?C.map(e=>e.name).join(", "):"-"}),(0,o.jsx)("div",{className:"bp-review-section",children:"Customer Information"}),w.map(e=>{var s;const t=e.field_key||e.name_key||"",a=`${e.scope}.${t}`;let n=null!==(s=h?.[a])&&void 0!==s?s:"";return"checkbox"===e.type&&(n="1"===n?"Yes":"No"),(0,o.jsx)(B,{label:e.label,value:String(n||"")},a)})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:g,children:f}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:v,onClick:x,children:v?"Submitting...":j})]})]})}function B({label:e,value:s}){return(0,o.jsxs)("div",{className:"bp-review-row",children:[(0,o.jsx)("div",{className:"k",children:e}),(0,o.jsx)("div",{className:"v",children:s||"-"})]})}function E({booking:e,onClose:s}){return(0,o.jsx)("div",{className:"bp-step bp-done",children:(0,o.jsxs)("div",{className:"bp-done-card",children:[(0,o.jsx)("div",{className:"bp-done-title",children:"Booking confirmed"}),e?.booking_id?(0,o.jsxs)("div",{className:"bp-done-sub",children:["Booking ID: ",e.booking_id]}):null,e?.manage_url?(0,o.jsx)("a",{className:"bp-done-link",href:e.manage_url,target:"_blank",rel:"noreferrer",children:"Manage your booking"}):null,(0,o.jsx)("div",{className:"bp-done-actions",children:(0,o.jsx)("button",{type:"button",className:"bp-next",onClick:s,children:"Close"})})]})})}const I=[{key:"location",title:"Location Selection",icon:"location-image.png"},{key:"category",title:"Choose Category",icon:"service-image.png"},{key:"service",title:"Choose Service",icon:"service-image.png"},{key:"extras",title:"Service Extras",icon:"service-image.png"},{key:"agent",title:"Choose Agent",icon:"default-avatar.jpg"},{key:"datetime",title:"Choose Date & Time",icon:"blue-dot.png"},{key:"customer",title:"Customer Information",icon:"default-avatar.jpg"},{key:"review",title:"Review Order",icon:"white-curve.png"},{key:"done",title:"Done",icon:"logo.png"}];function M({open:e,onClose:s,brand:a}){const[r,h]=(0,t.useState)(0),{config:g,loading:x,error:v}=function(e){const[s,a]=(0,t.useState)(!1),[n,i]=(0,t.useState)(null),[l,c]=(0,t.useState)("");return(0,t.useEffect)(()=>{if(!e)return;let s=!0;a(!0),c("");const t=`/wp-json/bp/v1/front/booking-form-design?_t=${Date.now()}`;return fetch(t,{credentials:"same-origin"}).then(async e=>{const s=await e.json().catch(()=>null);if(!e.ok)throw new Error(s?.message||`Design fetch failed (${e.status})`);return s}).then(e=>{s&&i(e?.config||null)}).catch(e=>{s&&(i(null),c(e.message||"Design fetch failed"))}).finally(()=>{s&&a(!1)}),()=>{s=!1}},[e]),{config:n,loading:s,error:l}}(e),f=(0,t.useMemo)(()=>function(e){const s=(Array.isArray(e?.steps)?e.steps:[]).filter(e=>e&&e.key&&!1!==e.enabled),t=new Map(I.map(e=>[e.key,e])),a=e=>"agents"===e?"agent":"confirm"===e||"confirmation"===e?"done":e,n=s.length?s.map(e=>({...t.get(a(e.key))||{key:a(e.key),title:e.title||e.key,icon:"service-image.png"},...e,key:a(e.key),title:e.title||t.get(a(e.key))?.title||e.key,subtitle:e.subtitle||""})):I.slice(),i=new Set;return n.filter(e=>!i.has(e.key)&&(i.add(e.key),!0))}(g),[g]),[N,y]=(0,t.useState)(null),[k,S]=(0,t.useState)([]),[C,w]=(0,t.useState)(null),[_,B]=(0,t.useState)([]),[M,L]=(0,t.useState)(null),[O,F]=(0,t.useState)(null),[P,D]=(0,t.useState)(null),[R,A]=(0,t.useState)({form:[],customer:[],booking:[]}),[q,Y]=(0,t.useState)({}),[J,z]=(0,t.useState)([]),[W,H]=(0,t.useState)([]),[K,X]=(0,t.useState)([]),[Z,G]=(0,t.useState)([]),[Q,V]=(0,t.useState)([]),[ee,se]=(0,t.useState)(!1),[te,ae]=(0,t.useState)(""),ne=f[r]||f[0]||I[0],ie=(0,t.useMemo)(()=>{if(ne?.imageUrl)return ne.imageUrl;const e=ne?.icon||ne?.image||"service-image.png";return a?.imagesBase?a.imagesBase+e:""},[a,ne]),le=g?.texts?.helpTitle||"Need help?",ce=g?.texts?.helpPhone||g?.layout?.helpPhone||a?.helpPhone||"",re=!1!==ne?.showLeftPanel,oe=!1!==ne?.showHelpBox;function de(){ae(""),h(e=>Math.min(e+1,f.length-1))}function ue(){ae(""),h(e=>Math.max(e-1,0))}return(0,t.useEffect)(()=>{if(e)return document.body.classList.add("bp-modal-open"),()=>document.body.classList.remove("bp-modal-open")},[e]),(0,t.useEffect)(()=>{e&&(h(0),ae(""),y(null),S([]),w(null),B([]),L(null),F(null),D(null),Y({}))},[e]),(0,t.useEffect)(()=>{e&&(async()=>{try{se(!0);const[e,s,t]=await Promise.all([n("/front/locations"),n("/front/categories"),c()]);z(e),H(s),A(t)}catch(e){ae(e?.message||"Failed to load booking data.")}finally{se(!1)}})()},[e]),(0,t.useEffect)(()=>{e&&f.map(e=>e.key).join("|")&&h(0)},[e,f]),(0,t.useEffect)(()=>{h(e=>e<0?0:e>=f.length?Math.max(0,f.length-1):e)},[f.length]),(0,t.useEffect)(()=>{e&&(async()=>{try{if("service"===ne.key||"extras"===ne.key||"agent"===ne.key||"datetime"===ne.key||"review"===ne.key){const e=await(({category_ids:e=[],location_id:s=null})=>n("/front/services",{method:"POST",body:JSON.stringify({category_ids:e,location_id:s})}))({category_ids:k,location_id:N});X(e)}}catch(e){X([])}})()},[e,ne.key,k,N]),(0,t.useEffect)(()=>{e&&(async()=>{try{if(!C)return;const[e,s]=await Promise.all([i({service_id:C}),l({service_id:C,location_id:N})]);G(e),V(s)}catch(e){G([]),V([])}})()},[e,C,N]),e?x&&!g?(0,o.jsx)("div",{className:"bp-wizard-loading",children:"Loading booking form…"}):v&&!g?(0,o.jsxs)("div",{className:"bp-wizard-loading",children:["Wizard error: ",v]}):f.length?(0,o.jsx)("div",{className:"bp-modal-overlay",role:"dialog","aria-modal":"true",children:(0,o.jsxs)("div",{className:"bp-modal",children:[(0,o.jsx)("button",{className:"bp-modal-close",onClick:s,"aria-label":"Close",children:"x"}),(0,o.jsxs)("div",{className:"bp-modal-grid",children:[re?(0,o.jsxs)("aside",{className:"bp-side",children:[(0,o.jsx)("div",{className:"bp-side-icon",children:ie?(0,o.jsx)("img",{src:ie,alt:""}):null}),(0,o.jsx)("h3",{className:"bp-side-title",children:ne.title}),(0,o.jsx)("p",{className:"bp-side-desc",children:ne.subtitle||"Please complete the steps to schedule your booking."}),oe?(0,o.jsxs)("div",{className:"bp-side-help",children:[(0,o.jsx)("div",{children:le}),(0,o.jsx)("div",{className:"bp-help-phone",children:ce})]}):null]}):null,(0,o.jsxs)("main",{className:"bp-main",children:[(0,o.jsxs)("div",{className:"bp-main-head",children:[(0,o.jsx)("h2",{children:ne.title}),(0,o.jsx)("div",{className:"bp-step-dots",children:f.slice(0,8).map((e,s)=>(0,o.jsx)("span",{className:s===r?"bp-dot active":"bp-dot"},e.key))})]}),te?(0,o.jsx)("div",{className:"bp-error",children:te}):null,ee?(0,o.jsx)("div",{className:"bp-loading",children:"Loading..."}):null,"location"===ne.key&&(0,o.jsx)(d,{locations:J,value:N,onChange:y,onNext:de}),"category"===ne.key&&(0,o.jsx)(u,{categories:W,value:k,onChange:S,onBack:ue,onNext:de}),"service"===ne.key&&(0,o.jsx)(m,{services:K,value:C,onChange:w,onBack:ue,onNext:de}),"extras"===ne.key&&(0,o.jsx)(p,{extras:Z,value:_,onChange:B,onBack:ue,onNext:de}),"agent"===ne.key&&(0,o.jsx)(b,{agents:Q,value:M,onChange:L,onBack:ue,onNext:de}),"datetime"===ne.key&&(0,o.jsx)(j,{locationId:N,serviceId:C,agentId:M,serviceDurationMin:K.find(e=>String(e.id)===String(C))?.duration||30,valueDate:O,valueSlot:P,onChangeDate:e=>{F(e),D(null)},onChangeSlot:D,onBack:ue,onNext:de}),"customer"===ne.key&&(0,o.jsx)(T,{formFields:R,answers:q,onChange:Y,onBack:ue,onNext:de,onError:ae,layout:g?.fieldsLayout}),"review"===ne.key&&(0,o.jsx)($,{locationId:N,categoryIds:k,serviceId:C,extraIds:_,agentId:M,date:O,slot:P,locations:J,categories:W,services:K,extras:Z,agents:Q,formFields:R,answers:q,onBack:ue,onSubmit:async function(){try{se(!0),ae("");const e={},s={};Object.entries(q||{}).forEach(([t,a])=>{t.startsWith("customer.")?e[t.slice(9)]=a:t.startsWith("booking.")&&(s[t.slice(8)]=a)});const t={location_id:N,category_ids:k,service_id:C,extra_ids:_,agent_id:M,date:O,start_time:P?.start_time||P?.start||"",end_time:P?.end_time||P?.end||"",field_values:q,customer_fields:e,booking_fields:s,extras:_},a=await(e=>n("/front/bookings",{method:"POST",body:JSON.stringify(e)}))(t);Y(e=>({...e,__booking:a}));const i=f.findIndex(e=>"done"===e.key);h(i>=0?i:f.length-1)}catch(e){ae(e?.message||"Could not submit booking.")}finally{se(!1)}},loading:ee}),"done"===ne.key&&(0,o.jsx)(E,{booking:q.__booking,onClose:s})]}),(0,o.jsxs)("aside",{className:"bp-summary",children:[(0,o.jsx)("div",{className:"bp-summary-title",children:"Summary"}),(0,o.jsx)("div",{className:"bp-summary-box",children:(0,o.jsx)(U,{locations:J,categories:W,services:K,extras:Z,agents:Q,locationId:N,categoryIds:k,serviceId:C,extraIds:_,agentId:M,date:O,slot:P})})]})]})]})}):(0,o.jsx)("div",{className:"bp-wizard-loading",children:"Wizard config invalid (no steps)"}):null}function U(e){const{locations:s,categories:t,services:a,extras:n,agents:i,locationId:l,categoryIds:c,serviceId:r,extraIds:d,agentId:u,date:m,slot:p}=e,b=s.find(e=>String(e.id)===String(l)),h=a.find(e=>String(e.id)===String(r)),g=i.find(e=>String(e.id)===String(u)),x=n.filter(e=>d.includes(e.id)||d.includes(String(e.id))),v=t.filter(e=>c.includes(e.id)||c.includes(String(e.id))),f=null!=h?.price?Number(h.price):0,j=x.reduce((e,s)=>e+(null!=s?.price?Number(s.price):0),0),N=f+j;function y(e){return e||0===e?`${Number(e).toFixed(0)} Kr`:"-"}return(0,o.jsxs)("div",{className:"bp-summary-items",children:[(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Location"}),(0,o.jsx)("div",{className:"v",children:b?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Category"}),(0,o.jsx)("div",{className:"v",children:v.length?v.map(e=>e.name).join(", "):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Service"}),(0,o.jsx)("div",{className:"v",children:h?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Service Price"}),(0,o.jsx)("div",{className:"v",children:null!=h?.price?y(f):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Agent"}),(0,o.jsx)("div",{className:"v",children:g?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Date"}),(0,o.jsx)("div",{className:"v",children:m||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Time"}),(0,o.jsx)("div",{className:"v",children:p?.start_time?`${p.start_time} - ${p.end_time}`:"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Extras"}),(0,o.jsx)("div",{className:"v",children:x.length?x.map(e=>e.name).join(", "):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Extras Price"}),(0,o.jsx)("div",{className:"v",children:x.length?y(j):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Total"}),(0,o.jsx)("div",{className:"v",children:null!=h?.price||x.length?y(N):"-"})]})]})}function L({label:e,mountEl:s}){const[a,n]=(0,t.useState)(!1),i="1"===s?.getAttribute("data-bp-fallback"),l=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",c=(0,t.useMemo)(()=>({imagesBase:l,helpPhone:"+45 91 67 14 52"}),[l]);return(0,t.useEffect)(()=>function(e,s){return e?(e.__bpOpen=()=>s(!0),()=>{e.__bpOpen&&delete e.__bpOpen}):()=>{}}(s,n),[s]),(0,o.jsxs)(o.Fragment,{children:[!i&&(0,o.jsx)("button",{className:"bp-book-btn",type:"button",onClick:()=>n(!0),children:e||"Book Now"}),(0,o.jsx)(M,{open:a,onClose:()=>n(!1),brand:c})]})}function O(){const e=document.querySelectorAll(".bp-front-root[data-bp-widget='wizard']");e.length?(e.forEach(e=>{const s=(0,a.H)(e),t=e.getAttribute("data-bp-label")||"Book Now";s.render((0,o.jsx)(L,{label:t,mountEl:e}))}),document.addEventListener("click",e=>{const s=e.target;if(!(s instanceof Element))return;const t=s.closest('.bp-fallback-btn, [data-bp-open="wizard"]');if(!t)return;const a=t.nextElementSibling,n=a&&a.classList.contains("bp-front-root")?a:t.closest(".bp-front-root")||document.querySelector(".bp-front-root");n&&"function"==typeof n.__bpOpen&&(e.preventDefault(),n.__bpOpen())})):function(){const e=document.getElementById("bp-front-root");if(!e)return;const s=(0,a.H)(e),t={imagesBase:(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",helpPhone:"+45 91 67 14 52"};document.addEventListener("click",a=>{const n=a.target;n instanceof Element&&n.closest(".bp-open-wizard")&&(a.preventDefault(),e.style.display="block",s.render((0,o.jsx)(M,{open:!0,onClose:()=>{s.render(null),e.style.display="none"},brand:t})))})}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",O):O()})();