(()=>{"use strict";var e={338(e,t,s){var a=s(795);t.H=a.createRoot,a.hydrateRoot},795(e){e.exports=window.ReactDOM}},t={};const s=window.React;var a=function s(a){var n=t[a];if(void 0!==n)return n.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}(338);async function n(e,t={}){var s;const a=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",n=window.BP_FRONT?.nonce,i=await fetch(`${a}${e}`,{...t,headers:{"Content-Type":"application/json",...n?{"X-WP-Nonce":n}:{},...t.headers||{}}}),r=await i.json().catch(()=>({}));if(!i.ok||"error"===r?.status)throw new Error(r?.message||"Request failed");return null!==(s=r?.data)&&void 0!==s?s:r}const i=({service_id:e})=>n("/front/extras",{method:"POST",body:JSON.stringify({service_id:e})}),r=({service_id:e,location_id:t})=>n("/front/agents",{method:"POST",body:JSON.stringify({service_id:e,location_id:t})}),l=async()=>{const e=await n("/front/form-fields"),t=[],s=[],a=[];return(Array.isArray(e)?e:[]).forEach(e=>{const n=e.scope||"customer";"booking"===n?a.push(e):"form"===n?t.push(e):s.push(e)}),{form:t,customer:s,booking:a}},c=window.ReactJSXRuntime;function o({locations:e,value:t,onChange:a,onNext:n}){const[i,r]=(0,s.useState)(""),l=(0,s.useMemo)(()=>{const t=i.trim().toLowerCase();return t?e.filter(e=>(e.name||"").toLowerCase().includes(t)):e},[i,e]),o=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("div",{className:"bp-step-search",children:(0,c.jsx)("input",{value:i,onChange:e=>r(e.target.value),placeholder:"Search...",className:"bp-input"})}),(0,c.jsxs)("div",{className:"bp-list",children:[l.map(e=>(0,c.jsxs)("button",{type:"button",className:String(t)===String(e.id)?"bp-card active":"bp-card",onClick:()=>a(e.id),children:[(0,c.jsx)("div",{className:"bp-card-title",children:e.name}),(0,c.jsx)("div",{className:"bp-card-sub",children:e.address||""})]},e.id)),l.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No locations found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("div",{}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!o,onClick:()=>n(),children:"Next ->"})]})]})}function d(e,t){const s=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return e?.image_url||e?.image||""||s+t}function m({categories:e,value:t,onChange:a,onBack:n,onNext:i}){const[r,l]=(0,s.useState)(""),o=(0,s.useMemo)(()=>{const t=r.trim().toLowerCase();return t?e.filter(e=>(e.name||"").toLowerCase().includes(t)):e},[r,e]),m=t.length>0;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("input",{value:r,onChange:e=>l(e.target.value),placeholder:"Search...",className:"bp-input"}),(0,c.jsxs)("div",{className:"bp-grid",children:[o.map(e=>{const s=t.some(t=>String(t)===String(e.id));return(0,c.jsxs)("button",{type:"button",className:s?"bp-tile active":"bp-tile",onClick:()=>function(e){const s=String(e),n=t.some(e=>String(e)===s)?t.filter(e=>String(e)!==s):[...t,e];a(n)}(e.id),children:[(0,c.jsx)("img",{className:"bp-tile-img",src:d(e,"service-image.png"),alt:""}),(0,c.jsx)("div",{className:"bp-tile-title",children:e.name})]},e.id)}),o.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No categories found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:n,children:"<- Back"}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!m,onClick:i,children:"Next ->"})]})]})}function u({services:e,value:t,onChange:a,onBack:n,onNext:i}){const[r,l]=(0,s.useState)(""),o=(0,s.useMemo)(()=>{const t=r.trim().toLowerCase();return t?(e||[]).filter(e=>(e.name||"").toLowerCase().includes(t)):e||[]},[r,e]),m=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("input",{value:r,onChange:e=>l(e.target.value),placeholder:"Search service...",className:"bp-input"}),(0,c.jsxs)("div",{className:"bp-cardlist",children:[o.map(e=>{const s=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>a(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:d(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description}),(0,c.jsxs)("div",{className:"bp-meta",children:[!!e.duration&&(0,c.jsxs)("span",{className:"bp-chip",children:[e.duration," min"]}),!!e.category_name&&(0,c.jsx)("span",{className:"bp-chip ghost",children:e.category_name})]})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"bp-price-num",children:Number(e.price).toFixed(0)}),(0,c.jsx)("span",{className:"bp-price-cur",children:"Kr"})]}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Select"})}),(0,c.jsx)("div",{className:s?"bp-radio on":"bp-radio"})]})]},e.id)}),o.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No services found."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:n,children:"<- Back"}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!m,onClick:i,children:"Next ->"})]})]})}function p({extras:e,value:t,onChange:a,onBack:n,onNext:i}){const[r,l]=(0,s.useState)(""),o=(0,s.useMemo)(()=>{const t=r.trim().toLowerCase();return t?(e||[]).filter(e=>(e.name||"").toLowerCase().includes(t)):e||[]},[r,e]);return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("input",{value:r,onChange:e=>l(e.target.value),placeholder:"Search extras...",className:"bp-input"}),(0,c.jsxs)("div",{className:"bp-cardlist",children:[o.map(e=>{const s=(t||[]).some(t=>String(t)===String(e.id));return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>function(e){const s=String(e),n=(t||[]).some(e=>String(e)===s)?(t||[]).filter(e=>String(e)!==s):[...t||[],e];a(n)}(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-thumb",src:d(e,"service-image.png"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.description})]}),(0,c.jsxs)("div",{className:"bp-pickcard-right",children:[(0,c.jsx)("div",{className:"bp-price",children:null!=e.price?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("span",{className:"bp-price-num",children:Number(e.price).toFixed(0)}),(0,c.jsx)("span",{className:"bp-price-cur",children:"Kr"})]}):(0,c.jsx)("span",{className:"bp-price-cur",children:"Extra"})}),(0,c.jsx)("div",{className:s?"bp-check on":"bp-check"})]})]},e.id)}),o.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No extras for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:n,children:"<- Back"}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!1,onClick:i,children:"Next ->"})]})]})}function b({agents:e,value:t,onChange:a,onBack:n,onNext:i}){const[r,l]=(0,s.useState)(""),o=(0,s.useMemo)(()=>{const t=r.trim().toLowerCase();return t?(e||[]).filter(e=>(e.name||"").toLowerCase().includes(t)):e||[]},[r,e]),m=!!t;return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("input",{value:r,onChange:e=>l(e.target.value),placeholder:"Search agent...",className:"bp-input"}),(0,c.jsxs)("div",{className:"bp-cardlist",children:[o.map(e=>{const s=String(t)===String(e.id);return(0,c.jsxs)("button",{type:"button",className:s?"bp-pickcard active":"bp-pickcard",onClick:()=>a(e.id),children:[(0,c.jsx)("div",{className:"bp-pickcard-left",children:(0,c.jsx)("img",{className:"bp-avatar",src:d(e,"default-avatar.jpg"),alt:""})}),(0,c.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,c.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.title&&(0,c.jsx)("div",{className:"bp-pickcard-sub",children:e.title}),!!e.email&&(0,c.jsx)("div",{className:"bp-pickcard-sub small",children:e.email})]}),(0,c.jsx)("div",{className:"bp-pickcard-right",children:(0,c.jsx)("div",{className:s?"bp-radio on":"bp-radio"})})]},e.id)}),o.length?null:(0,c.jsx)("div",{className:"bp-empty",children:"No agents available for this service."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:n,children:"<- Back"}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!m,onClick:i,children:"Next ->"})]})]})}const h=e=>String(e).padStart(2,"0"),x=(e,t,s)=>new Date(Date.UTC(e,t,s,12,0,0)),v=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,g=(e,t)=>x(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+t),N=e=>x(e.getUTCFullYear(),e.getUTCMonth(),1),j=e=>(e.getUTCDay()+6)%7,f=e=>{if(!e)return"";const t=String(e);return t.length>=5?t.slice(0,5):t},y=e=>{const t=f(e),[s,a]=t.split(":").map(Number);return 60*(s||0)+(a||0)},k=()=>{const e=new Date;return 60*e.getHours()+e.getMinutes()};function S({locationId:e,serviceId:t,agentId:a,serviceDurationMin:i=30,valueDate:r,valueSlot:l,onChangeDate:o,onChangeSlot:d,onBack:m,onNext:u}){const p=new Date,b=x(p.getFullYear(),p.getMonth(),p.getDate()),S=v(b),C=r&&r>=S?r:S,_=x(Number(C.slice(0,4)),Number(C.slice(5,7))-1,Number(C.slice(8,10))),[w,I]=(0,s.useState)(N(_)),[B,T]=(0,s.useState)(C),[$,M]=(0,s.useState)([]),[D,F]=(0,s.useState)(!1),[U,E]=(0,s.useState)(""),[P,L]=(0,s.useState)({}),R=(0,s.useRef)(new Map),O=(0,s.useRef)(0);(0,s.useEffect)(()=>{if(!r)return;const e=r>=S?r:S;if(e!==B){T(e);const t=x(Number(e.slice(0,4)),Number(e.slice(5,7))-1,Number(e.slice(8,10)));I(N(t))}},[r,S]),(0,s.useEffect)(()=>{!r&&B&&o?.(B)},[r,B,o]);const A=(0,s.useMemo)(()=>{const e=N(w),t=x((s=w).getUTCFullYear(),s.getUTCMonth()+1,0);var s;const a=j(e),n=g(e,-a),i=6-j(t),r=g(t,i),l=[];for(let e=new Date(n);e<=r;e=g(e,1))l.push(new Date(e));return l},[w]),Y=e=>e.getUTCMonth()===w.getUTCMonth()&&e.getUTCFullYear()===w.getUTCFullYear(),q=e=>v(e),J=`${w.getUTCFullYear()}-${h(w.getUTCMonth()+1)}`;function H(e){const t=f(e.start_time||e.start),s=f(e.end_time||e.end);return s?`${t} - ${s}`:`${t} - ${(e=>{const t=Math.floor(e/60),s=e%60;return`${h(t)}:${h(s)}`})(y(t)+Number(i||30))}`}(0,s.useEffect)(()=>{let s=!0;return(async()=>{if(t&&a)try{const i=await(({month:e,service_id:t,agent_id:s,location_id:a=null})=>n(`/front/availability?month=${encodeURIComponent(e)}&service_id=${encodeURIComponent(t)}&agent_id=${encodeURIComponent(s)}&location_id=${encodeURIComponent(a||"")}`))({month:J,service_id:t,agent_id:a,location_id:e||0});if(!s)return;L(i||{})}catch(e){if(!s)return;L({})}else L({})})(),()=>{s=!1}},[J,t,a,e]),(0,s.useEffect)(()=>{let s=!0;const i=++O.current;return(async()=>{if(!t||!a||!B)return M([]),E(""),void F(!1);if(B<S)return M([]),E("Please select a future date."),void F(!1);const r=R.current.get(B);if(Array.isArray(r))return M(r),E(r.length?"":"No available times for this date."),void F(!1);E(""),F(!0);try{let r=function(e){const t=e?.data||e?.slots||e;return Array.isArray(t)?t.map(e=>{var t;return{start_time:f(e.start||e.from||e.time||e.start_time||""),end_time:f(e.end||e.to||e.end_time||""),available:"boolean"==typeof e.available?e.available:null===(t=e.is_available)||void 0===t||t}}).filter(e=>e.start_time):[]}(await(({service_id:e,agent_id:t,date:s,location_id:a=null})=>n("/front/slots",{method:"POST",body:JSON.stringify({service_id:e,agent_id:t,date:s,location_id:a})}))({service_id:t,agent_id:a,date:B,location_id:e})).filter(e=>e.available);if(B===S){const e=k();r=r.filter(t=>y(t.start_time)>=e)}if(R.current.set(B,r),!s||i!==O.current)return;M(r),E(r.length?"":"No available times for this date.")}catch(e){if(!s||i!==O.current)return;M([]),E("No available times for this date."),R.current.set(B,[])}finally{if(!s||i!==O.current)return;F(!1)}})(),()=>{s=!1}},[B,e,t,a,S]),(0,s.useEffect)(()=>{if(B!==S)return;const e=setInterval(()=>{const e=k();M(t=>{if(!t?.length)return t;const s=t.filter(t=>y(t.start_time)>=e);return s.length===t.length?t:(R.current.set(B,s),s)})},6e4);return()=>clearInterval(e)},[B,S]);const z=f(l?.start_time||l?.start||""),K=!!B&&!!z;return(0,c.jsxs)("div",{className:"bp-step bp-datetime",children:[(0,c.jsxs)("div",{className:"bp-dt-head",children:[(0,c.jsxs)("div",{className:"bp-dt-month",children:[(0,c.jsx)("button",{type:"button",className:"bp-iconbtn",onClick:()=>I(N(g(w,-31))),"aria-label":"Prev month",children:"<"}),(0,c.jsx)("div",{className:"bp-dt-month-title",children:(W=w,W.toLocaleString(void 0,{month:"long",year:"numeric"}))}),(0,c.jsx)("button",{type:"button",className:"bp-iconbtn",onClick:()=>I(N(g(w,31))),"aria-label":"Next month",children:">"})]}),(0,c.jsx)("div",{className:"bp-dt-weekdays",children:["M","T","W","T","F","S","S"].map(e=>(0,c.jsx)("div",{className:"bp-dt-wd",children:e},e))}),(0,c.jsx)("div",{className:"bp-dt-grid",children:A.map(e=>{const t=q(e),s=t===B,a=Y(e),n=t<S,i=!((r=t)<S)&&0!==P[r];var r;return(0,c.jsxs)("button",{type:"button",className:["bp-dt-day",s?"selected":"",a?"":"muted",n?"disabled":""].join(" "),onClick:()=>function(e){const t=q(e);t<S||(T(t),o?.(t),d?.(null),Y(e)||I(N(e)))}(e),disabled:n,children:[(0,c.jsx)("div",{className:"bp-dt-daynum",children:e.getUTCDate()}),(0,c.jsx)("div",{className:i?"bp-dt-bar on":"bp-dt-bar"})]},t)})})]}),(0,c.jsxs)("div",{className:"bp-dt-slots",children:[(0,c.jsxs)("div",{className:"bp-dt-slots-title",children:["Pick a slot for ",(0,c.jsx)("span",{className:"bp-dt-date",children:B})]}),t&&a?D?(0,c.jsx)("div",{className:"bp-dt-slotgrid",children:Array.from({length:6}).map((e,t)=>(0,c.jsx)("div",{className:"bp-slot skeleton"},t))}):U?(0,c.jsx)("div",{className:"bp-dt-empty",children:U}):(0,c.jsx)("div",{className:"bp-dt-slotgrid",children:$.map(e=>{const t=z===f(e.start_time||e.start);return(0,c.jsx)("button",{type:"button",className:t?"bp-slot active":"bp-slot",onClick:()=>d?.({start_time:f(e.start_time||e.start),end_time:f(e.end_time||e.end)}),children:H(e)},e.start_time||e.start)})}):(0,c.jsx)("div",{className:"bp-dt-empty",children:"Please select a service and agent first."})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:m,children:"<- Back"}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:!K,onClick:u,children:"Next ->"})]})]});var W}function C(e,t){return"checkbox"===t?"1"!==e:null==e||(Array.isArray(e)?0===e.length:""===String(e).trim())}function _({formFields:e,answers:t,onChange:s,onBack:a,onNext:n,onError:i}){const r=[...e?.form||[],...e?.customer||[],...e?.booking||[]];function l(e){var s;return null!==(s=t?.[e])&&void 0!==s?s:""}return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsx)("div",{className:"bp-form",children:r.map(e=>{const t=e.field_key||e.name_key||"",a=`${e.scope}.${t}`,n=l(a);return(0,c.jsxs)("div",{className:"bp-field",children:[(0,c.jsxs)("label",{className:"bp-label",children:[e.label," ",e.is_required?(0,c.jsx)("span",{className:"bp-required",children:"*"}):null]}),(0,c.jsx)(w,{field:e,value:n,onChange:e=>function(e,t){s(s=>({...s,[e]:t}))}(a,e)})]},a)})}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:"<- Back"}),(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:function(){for(const e of r){if(!e.is_required)continue;const t=e.field_key||e.name_key||"";if(C(l(`${e.scope}.${t}`),e.type))return void i?.(`${e.label||t} is required`)}i?.(""),n()},children:"Next ->"})]})]})}function w({field:e,value:t,onChange:s}){const a={className:"bp-input",placeholder:e.placeholder||"",value:t||"",onChange:e=>s(e.target.value)};if("textarea"===e.type)return(0,c.jsx)("textarea",{className:"bp-input bp-textarea",rows:4,placeholder:e.placeholder||"",value:t||"",onChange:e=>s(e.target.value)});if("select"===e.type){const a=e.options?.choices||[];return(0,c.jsxs)("select",{className:"bp-input",value:t||"",onChange:e=>s(e.target.value),children:[(0,c.jsx)("option",{value:"",children:"Select..."}),a.map((e,t)=>(0,c.jsx)("option",{value:e.value,children:e.label},t))]})}if("checkbox"===e.type){const a="1"===t||!0===t;return(0,c.jsxs)("label",{className:"bp-checkbox",children:[(0,c.jsx)("input",{type:"checkbox",checked:a,onChange:e=>s(e.target.checked?"1":"0")}),(0,c.jsx)("span",{children:e.placeholder||"Yes"})]})}let n="text";return"email"===e.type&&(n="email"),"tel"===e.type&&(n="tel"),"number"===e.type&&(n="number"),"date"===e.type&&(n="date"),(0,c.jsx)("input",{...a,type:n})}function I({locationId:e,categoryIds:t,serviceId:a,extraIds:n,agentId:i,date:r,slot:l,locations:o,categories:d,services:m,extras:u,agents:p,formFields:b,answers:h,onBack:x,onSubmit:v,loading:g}){const N=o.find(t=>String(t.id)===String(e)),j=m.find(e=>String(e.id)===String(a)),f=p.find(e=>String(e.id)===String(i)),y=d.filter(e=>t.includes(e.id)||t.includes(String(e.id))),k=u.filter(e=>n.includes(e.id)||n.includes(String(e.id))),S=(0,s.useMemo)(()=>[...b?.form||[],...b?.customer||[],...b?.booking||[]],[b]);return(0,c.jsxs)("div",{className:"bp-step",children:[(0,c.jsxs)("div",{className:"bp-review",children:[(0,c.jsx)(B,{label:"Location",value:N?.name}),(0,c.jsx)(B,{label:"Categories",value:y.length?y.map(e=>e.name).join(", "):"-"}),(0,c.jsx)(B,{label:"Service",value:j?.name}),(0,c.jsx)(B,{label:"Agent",value:f?.name}),(0,c.jsx)(B,{label:"Date",value:r}),(0,c.jsx)(B,{label:"Time",value:l?.start_time?`${l.start_time} - ${l.end_time}`:"-"}),(0,c.jsx)(B,{label:"Extras",value:k.length?k.map(e=>e.name).join(", "):"-"}),(0,c.jsx)("div",{className:"bp-review-section",children:"Customer Information"}),S.map(e=>{var t;const s=e.field_key||e.name_key||"",a=`${e.scope}.${s}`;let n=null!==(t=h?.[a])&&void 0!==t?t:"";return"checkbox"===e.type&&(n="1"===n?"Yes":"No"),(0,c.jsx)(B,{label:e.label,value:String(n||"")},a)})]}),(0,c.jsxs)("div",{className:"bp-step-footer",children:[(0,c.jsx)("button",{type:"button",className:"bp-back",onClick:x,children:"<- Back"}),(0,c.jsx)("button",{type:"button",className:"bp-next",disabled:g,onClick:v,children:g?"Submitting...":"Confirm Booking"})]})]})}function B({label:e,value:t}){return(0,c.jsxs)("div",{className:"bp-review-row",children:[(0,c.jsx)("div",{className:"k",children:e}),(0,c.jsx)("div",{className:"v",children:t||"-"})]})}function T({booking:e,onClose:t}){return(0,c.jsx)("div",{className:"bp-step bp-done",children:(0,c.jsxs)("div",{className:"bp-done-card",children:[(0,c.jsx)("div",{className:"bp-done-title",children:"Booking confirmed"}),e?.booking_id?(0,c.jsxs)("div",{className:"bp-done-sub",children:["Booking ID: ",e.booking_id]}):null,e?.manage_url?(0,c.jsx)("a",{className:"bp-done-link",href:e.manage_url,target:"_blank",rel:"noreferrer",children:"Manage your booking"}):null,(0,c.jsx)("div",{className:"bp-done-actions",children:(0,c.jsx)("button",{type:"button",className:"bp-next",onClick:t,children:"Close"})})]})})}const $=[{key:"location",title:"Location Selection",icon:"location-image.png"},{key:"category",title:"Choose Category",icon:"service-image.png"},{key:"service",title:"Choose Service",icon:"service-image.png"},{key:"extras",title:"Service Extras",icon:"service-image.png"},{key:"agent",title:"Choose Agent",icon:"default-avatar.jpg"},{key:"datetime",title:"Choose Date & Time",icon:"blue-dot.png"},{key:"customer",title:"Customer Information",icon:"default-avatar.jpg"},{key:"review",title:"Review Order",icon:"white-curve.png"},{key:"done",title:"Done",icon:"logo.png"}];function M({open:e,onClose:t,brand:a}){const[d,h]=(0,s.useState)(0),[x,v]=(0,s.useState)(null),[g,N]=(0,s.useState)([]),[j,f]=(0,s.useState)(null),[y,k]=(0,s.useState)([]),[C,w]=(0,s.useState)(null),[B,M]=(0,s.useState)(null),[F,U]=(0,s.useState)(null),[E,P]=(0,s.useState)({form:[],customer:[],booking:[]}),[L,R]=(0,s.useState)({}),[O,A]=(0,s.useState)([]),[Y,q]=(0,s.useState)([]),[J,H]=(0,s.useState)([]),[z,K]=(0,s.useState)([]),[W,X]=(0,s.useState)([]),[G,Q]=(0,s.useState)(!1),[V,Z]=(0,s.useState)(""),ee=$[d],te=(0,s.useMemo)(()=>a?.imagesBase?a.imagesBase+ee.icon:"",[a,ee]);function se(){Z(""),h(e=>Math.min(e+1,$.length-1))}function ae(){Z(""),h(e=>Math.max(e-1,0))}return(0,s.useEffect)(()=>{if(e)return document.body.classList.add("bp-modal-open"),()=>document.body.classList.remove("bp-modal-open")},[e]),(0,s.useEffect)(()=>{e&&(h(0),Z(""),v(null),N([]),f(null),k([]),w(null),M(null),U(null),R({}))},[e]),(0,s.useEffect)(()=>{e&&(async()=>{try{Q(!0);const[e,t,s]=await Promise.all([n("/front/locations"),n("/front/categories"),l()]);A(e),q(t),P(s)}catch(e){Z(e?.message||"Failed to load booking data.")}finally{Q(!1)}})()},[e]),(0,s.useEffect)(()=>{e&&(async()=>{try{if("service"===ee.key||"extras"===ee.key||"agent"===ee.key||"datetime"===ee.key||"review"===ee.key){const e=await(({category_ids:e=[],location_id:t=null})=>n("/front/services",{method:"POST",body:JSON.stringify({category_ids:e,location_id:t})}))({category_ids:g,location_id:x});H(e)}}catch(e){H([])}})()},[e,ee.key,g,x]),(0,s.useEffect)(()=>{e&&(async()=>{try{if(!j)return;const[e,t]=await Promise.all([i({service_id:j}),r({service_id:j,location_id:x})]);K(e),X(t)}catch(e){K([]),X([])}})()},[e,j,x]),e?(0,c.jsx)("div",{className:"bp-modal-overlay",role:"dialog","aria-modal":"true",children:(0,c.jsxs)("div",{className:"bp-modal",children:[(0,c.jsx)("button",{className:"bp-modal-close",onClick:t,"aria-label":"Close",children:"x"}),(0,c.jsxs)("div",{className:"bp-modal-grid",children:[(0,c.jsxs)("aside",{className:"bp-side",children:[(0,c.jsx)("div",{className:"bp-side-icon",children:te?(0,c.jsx)("img",{src:te,alt:""}):null}),(0,c.jsx)("h3",{className:"bp-side-title",children:ee.title}),(0,c.jsx)("p",{className:"bp-side-desc",children:"Please complete the steps to schedule your booking."}),(0,c.jsxs)("div",{className:"bp-side-help",children:[(0,c.jsx)("div",{children:"Need help?"}),(0,c.jsx)("div",{className:"bp-help-phone",children:a?.helpPhone})]})]}),(0,c.jsxs)("main",{className:"bp-main",children:[(0,c.jsxs)("div",{className:"bp-main-head",children:[(0,c.jsx)("h2",{children:ee.title}),(0,c.jsx)("div",{className:"bp-step-dots",children:$.slice(0,8).map((e,t)=>(0,c.jsx)("span",{className:t===d?"bp-dot active":"bp-dot"},e.key))})]}),V?(0,c.jsx)("div",{className:"bp-error",children:V}):null,G?(0,c.jsx)("div",{className:"bp-loading",children:"Loading..."}):null,"location"===ee.key&&(0,c.jsx)(o,{locations:O,value:x,onChange:v,onNext:se}),"category"===ee.key&&(0,c.jsx)(m,{categories:Y,value:g,onChange:N,onBack:ae,onNext:se}),"service"===ee.key&&(0,c.jsx)(u,{services:J,value:j,onChange:f,onBack:ae,onNext:se}),"extras"===ee.key&&(0,c.jsx)(p,{extras:z,value:y,onChange:k,onBack:ae,onNext:se}),"agent"===ee.key&&(0,c.jsx)(b,{agents:W,value:C,onChange:w,onBack:ae,onNext:se}),"datetime"===ee.key&&(0,c.jsx)(S,{locationId:x,serviceId:j,agentId:C,serviceDurationMin:J.find(e=>String(e.id)===String(j))?.duration||30,valueDate:B,valueSlot:F,onChangeDate:e=>{M(e),U(null)},onChangeSlot:U,onBack:ae,onNext:se}),"customer"===ee.key&&(0,c.jsx)(_,{formFields:E,answers:L,onChange:R,onBack:ae,onNext:se,onError:Z}),"review"===ee.key&&(0,c.jsx)(I,{locationId:x,categoryIds:g,serviceId:j,extraIds:y,agentId:C,date:B,slot:F,locations:O,categories:Y,services:J,extras:z,agents:W,formFields:E,answers:L,onBack:ae,onSubmit:async function(){try{Q(!0),Z("");const e={location_id:x,category_ids:g,service_id:j,extra_ids:y,agent_id:C,date:B,start_time:F?.start_time||F?.start||"",end_time:F?.end_time||F?.end||"",field_values:L,extras:y},t=await(e=>n("/front/bookings",{method:"POST",body:JSON.stringify(e)}))(e);R(e=>({...e,__booking:t})),h($.findIndex(e=>"done"===e.key))}catch(e){Z(e?.message||"Could not submit booking.")}finally{Q(!1)}},loading:G}),"done"===ee.key&&(0,c.jsx)(T,{booking:L.__booking,onClose:t})]}),(0,c.jsxs)("aside",{className:"bp-summary",children:[(0,c.jsx)("div",{className:"bp-summary-title",children:"Summary"}),(0,c.jsx)("div",{className:"bp-summary-box",children:(0,c.jsx)(D,{locations:O,categories:Y,services:J,extras:z,agents:W,locationId:x,categoryIds:g,serviceId:j,extraIds:y,agentId:C,date:B,slot:F})})]})]})]})}):null}function D(e){const{locations:t,categories:s,services:a,extras:n,agents:i,locationId:r,categoryIds:l,serviceId:o,extraIds:d,agentId:m,date:u,slot:p}=e,b=t.find(e=>String(e.id)===String(r)),h=a.find(e=>String(e.id)===String(o)),x=i.find(e=>String(e.id)===String(m)),v=n.filter(e=>d.includes(e.id)||d.includes(String(e.id))),g=s.filter(e=>l.includes(e.id)||l.includes(String(e.id)));return(0,c.jsxs)("div",{className:"bp-summary-items",children:[(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Location"}),(0,c.jsx)("div",{className:"v",children:b?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Category"}),(0,c.jsx)("div",{className:"v",children:g.length?g.map(e=>e.name).join(", "):"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Service"}),(0,c.jsx)("div",{className:"v",children:h?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Agent"}),(0,c.jsx)("div",{className:"v",children:x?.name||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Date"}),(0,c.jsx)("div",{className:"v",children:u||"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Time"}),(0,c.jsx)("div",{className:"v",children:p?.start_time?`${p.start_time} - ${p.end_time}`:"-"})]}),(0,c.jsxs)("div",{className:"bp-summary-row",children:[(0,c.jsx)("div",{className:"k",children:"Extras"}),(0,c.jsx)("div",{className:"v",children:v.length?v.map(e=>e.name).join(", "):"-"})]})]})}function F({label:e}){const[t,a]=(0,s.useState)(!1),n=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",i=(0,s.useMemo)(()=>({imagesBase:n,helpPhone:"+45 91 67 14 52"}),[n]);return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)("button",{className:"bp-book-btn",type:"button",onClick:()=>a(!0),children:e||"Book Now"}),(0,c.jsx)(M,{open:t,onClose:()=>a(!1),brand:i})]})}function U(){const e=document.querySelectorAll(".bp-front-root[data-bp-widget='wizard']");e.length?e.forEach(e=>{const t=(0,a.H)(e),s=e.getAttribute("data-bp-label")||"Book Now";t.render((0,c.jsx)(F,{label:s}))}):function(){const e=document.getElementById("bp-front-root");if(!e)return;const t=(0,a.H)(e),s={imagesBase:(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",helpPhone:"+45 91 67 14 52"};document.addEventListener("click",a=>{const n=a.target;n instanceof Element&&n.closest(".bp-open-wizard")&&(a.preventDefault(),e.style.display="block",t.render((0,c.jsx)(M,{open:!0,onClose:()=>{t.render(null),e.style.display="none"},brand:s})))})}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",U):U()})();