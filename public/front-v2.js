(()=>{"use strict";var e={338(e,s,t){var a=t(795);s.H=a.createRoot,a.hydrateRoot},795(e){e.exports=window.ReactDOM}},s={};const t=window.React;var a=function t(a){var n=s[a];if(void 0!==n)return n.exports;var i=s[a]={exports:{}};return e[a](i,i.exports,t),i.exports}(338);async function n(e,s={}){var t;const a=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",n=window.BP_FRONT?.nonce,i=await fetch(`${a}${e}`,{...s,headers:{"Content-Type":"application/json",...n?{"X-WP-Nonce":n}:{},...s.headers||{}}}),c=await i.json().catch(()=>({}));if(!i.ok||"error"===c?.status)throw new Error(c?.message||"Request failed");return null!==(t=c?.data)&&void 0!==t?t:c}const i=({service_id:e})=>n("/front/extras",{method:"POST",body:JSON.stringify({service_id:e})}),c=({service_id:e,location_id:s})=>n("/front/agents",{method:"POST",body:JSON.stringify({service_id:e,location_id:s})}),l=async()=>{const e=await n("/front/form-fields"),s=[],t=[],a=[];return(Array.isArray(e)?e:[]).forEach(e=>{const n=e.scope||"customer";"booking"===n?a.push(e):"form"===n?s.push(e):t.push(e)}),{form:s,customer:t,booking:a}};function r(e,s){const t=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/";return e?.image_url||e?.image||""||t+s}const o=window.ReactJSXRuntime;function d({locations:e,value:s,onChange:t,onNext:a}){const n=e||[],i=!!s;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-list",children:[n.map(e=>(0,o.jsx)("button",{type:"button",className:String(s)===String(e.id)?"bp-card active":"bp-card",onClick:()=>t(e.id),children:(0,o.jsxs)("div",{className:"bp-card-row",children:[(0,o.jsx)("img",{className:"bp-card-thumb",src:r(e,"location-image.png"),alt:""}),(0,o.jsxs)("div",{children:[(0,o.jsx)("div",{className:"bp-card-title",children:e.name}),(0,o.jsx)("div",{className:"bp-card-sub",children:e.address||""})]})]})},e.id)),n.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No locations found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("div",{}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!i,onClick:()=>a(),children:"Next ->"})]})]})}function m({categories:e,value:s,onChange:t,onBack:a,onNext:n}){const i=e||[],c=(s||[]).length>0;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-list",children:[i.map(e=>{const a=(s||[]).some(s=>String(s)===String(e.id));return(0,o.jsx)("button",{type:"button",className:a?"bp-card active":"bp-card",onClick:()=>{return s=e.id,void t([s]);var s},children:(0,o.jsxs)("div",{className:"bp-card-row",children:[(0,o.jsx)("img",{className:"bp-card-thumb",src:r(e,"service-image.png"),alt:""}),(0,o.jsx)("div",{className:"bp-card-title",children:e.name})]})},e.id)}),i.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No categories found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:"<- Back"}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!c,onClick:n,children:"Next ->"})]})]})}function p({services:e,value:s,onChange:t,onBack:a,onNext:n}){const i=e||[],c=!!s;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[i.map(e=>{const a=String(s)===String(e.id);return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>t(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-thumb",src:r(e,"service-image.png"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.description&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.description}),(0,o.jsxs)("div",{className:"bp-meta",children:[!!e.duration&&(0,o.jsxs)("span",{className:"bp-chip",children:[e.duration," min"]}),!!e.category_name&&(0,o.jsx)("span",{className:"bp-chip ghost",children:e.category_name})]})]}),(0,o.jsxs)("div",{className:"bp-pickcard-right",children:[(0,o.jsx)("div",{className:"bp-price",children:null!=e.price?(0,o.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,o.jsx)("span",{className:"bp-price-cur",children:"Select"})}),(0,o.jsx)("div",{className:a?"bp-radio on":"bp-radio"})]})]},e.id)}),i.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No services found."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:"<- Back"}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!c,onClick:n,children:"Next ->"})]})]})}function u({extras:e,value:s,onChange:t,onBack:a,onNext:n}){const i=e||[];return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[i.map(e=>{const a=(s||[]).some(s=>String(s)===String(e.id));return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>function(e){const a=String(e),n=(s||[]).some(e=>String(e)===a)?(s||[]).filter(e=>String(e)!==a):[...s||[],e];t(n)}(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-thumb",src:r(e,"service-image.png"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),(e.description||e.desc||e.summary)&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.description||e.desc||e.summary})]}),(0,o.jsxs)("div",{className:"bp-pickcard-right",children:[(0,o.jsx)("div",{className:"bp-price",children:null!=e.price?(0,o.jsxs)("span",{className:"bp-price-line",children:[Number(e.price).toFixed(0)," Kr"]}):(0,o.jsx)("span",{className:"bp-price-cur",children:"Extra"})}),(0,o.jsx)("div",{className:a?"bp-check on":"bp-check"})]})]},e.id)}),i.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No extras for this service."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:"<- Back"}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!1,onClick:n,children:"Next ->"})]})]})}function b({agents:e,value:s,onChange:t,onBack:a,onNext:n}){const i=e||[],c=!!s;return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-cardlist",children:[i.map(e=>{const a=String(s)===String(e.id);return(0,o.jsxs)("button",{type:"button",className:a?"bp-pickcard active":"bp-pickcard",onClick:()=>t(e.id),children:[(0,o.jsx)("div",{className:"bp-pickcard-left",children:(0,o.jsx)("img",{className:"bp-avatar",src:r(e,"default-avatar.jpg"),alt:""})}),(0,o.jsxs)("div",{className:"bp-pickcard-mid",children:[(0,o.jsx)("div",{className:"bp-pickcard-title",children:e.name}),!!e.title&&(0,o.jsx)("div",{className:"bp-pickcard-sub",children:e.title}),!!e.email&&(0,o.jsx)("div",{className:"bp-pickcard-sub small",children:e.email})]}),(0,o.jsx)("div",{className:"bp-pickcard-right",children:(0,o.jsx)("div",{className:a?"bp-radio on":"bp-radio"})})]},e.id)}),i.length?null:(0,o.jsx)("div",{className:"bp-empty",children:"No agents available for this service."})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:"<- Back"}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!c,onClick:n,children:"Next ->"})]})]})}const h=(e,s,t)=>new Date(Date.UTC(e,s,t,12,0,0)),x=e=>`${e.getUTCFullYear()}-${String(e.getUTCMonth()+1).padStart(2,"0")}-${String(e.getUTCDate()).padStart(2,"0")}`,v=(e,s)=>h(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()+s),g=e=>{const s=new Date,t=h(s.getUTCFullYear(),s.getUTCMonth(),s.getUTCDate());return e.getTime()<t.getTime()};async function N(e,s,{signal:t}={}){const a=window.BP_FRONT?.restUrl||"/wp-json/bp/v1",n=window.BP_FRONT?.nonce,i=await fetch(`${a}${e}`,{method:"POST",headers:{"Content-Type":"application/json",...n?{"X-WP-Nonce":n}:{}},body:JSON.stringify(s),signal:t,credentials:"same-origin"}),c=await i.text();let l;try{l=JSON.parse(c)}catch(e){l={ok:!1,raw:c}}if(!i.ok){const e=l?.message||l?.raw||`HTTP ${i.status}`;throw new Error(e)}return l}function j({serviceId:e,agentId:s,locationId:a,valueDate:n,valueSlot:i,onChangeDate:c,onChangeSlot:l,onBack:r,onNext:d}){const[m,p]=(0,t.useState)(()=>{const e=new Date;return h(e.getUTCFullYear(),e.getUTCMonth(),1)}),[u,b]=(0,t.useState)(n||null),[j,f]=(0,t.useState)([]),[k,y]=(0,t.useState)(!1),[S,C]=(0,t.useState)([]),[w,_]=(0,t.useState)(!1),[T,B]=(0,t.useState)(""),E=(0,t.useRef)(new Map),I=(0,t.useRef)(new Map),$=(0,t.useRef)(null),U=(0,t.useRef)(null),M=(0,t.useMemo)(()=>{var e;return`${m.getUTCFullYear()}-${e=m.getUTCMonth()+1,String(e).padStart(2,"0")}`},[m]),O=(0,t.useMemo)(()=>({service_id:e,agent_id:s,location_id:a,month:M}),[e,s,a,M]);(0,t.useEffect)(()=>{if(!e||!s)return;const t=JSON.stringify(O);if(E.current.has(t))return void f(E.current.get(t));$.current&&$.current.abort();const a=new AbortController;$.current=a,y(!0),N("/front/availability/month",O,{signal:a.signal}).then(e=>{const s=e?.data?.days||[];E.current.set(t,s),f(s)}).catch(()=>{}).finally(()=>y(!1))},[O,e,s]),(0,t.useEffect)(()=>{n&&n!==u&&b(n)},[n]);const F=(0,t.useMemo)(()=>({service_id:e,agent_id:s,location_id:a,date:u}),[e,s,a,u]);(0,t.useEffect)(()=>{if(!u||!e||!s)return;const t=JSON.stringify(F);if(I.current.has(t))return void C(I.current.get(t));U.current&&U.current.abort();const a=new AbortController;U.current=a,_(!0),C([]),B(""),N("/front/availability/day",F,{signal:a.signal}).then(e=>{const s=e?.slots||[];I.current.set(t,s),C(s)}).catch(e=>{"AbortError"!==e.name&&(C([]),B("No available times for this date."))}).finally(()=>_(!1))},[F,u,e,s]);const P=(0,t.useMemo)(()=>{const e=new Map;return j.forEach(s=>e.set(s.date,s)),e},[j]),D=(0,t.useMemo)(()=>(e=>{const s=h((t=e).getUTCFullYear(),t.getUTCMonth(),1);var t;const a=(e=>(e.getUTCDay()+6)%7)(s),n=v(s,-a);return Array.from({length:42},(e,s)=>v(n,s))})(m),[m]),R=!!u&&!!i?.start_time;return(0,o.jsxs)("div",{className:"bp-step bp-datetime",children:[(0,o.jsxs)("div",{className:"bp-calendar",children:[(0,o.jsxs)("div",{className:"bp-cal-header",children:[(0,o.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>p(e=>h(e.getUTCFullYear(),e.getUTCMonth()-1,1)),children:"<"}),(0,o.jsx)("div",{className:"bp-cal-title",children:m.toLocaleString(void 0,{month:"long",year:"numeric",timeZone:"UTC"})}),(0,o.jsx)("button",{type:"button",className:"bp-cal-nav",onClick:()=>p(e=>h(e.getUTCFullYear(),e.getUTCMonth()+1,1)),children:">"})]}),(0,o.jsx)("div",{className:"bp-cal-weekdays",children:["M","T","W","T","F","S","S"].map(e=>(0,o.jsx)("div",{className:"bp-cal-wd",children:e},e))}),(0,o.jsx)("div",{className:"bp-cal-grid",children:D.map((e,s)=>{const t=(n=m,(a=e).getUTCFullYear()===n.getUTCFullYear()&&a.getUTCMonth()===n.getUTCMonth());var a,n;const i=g(e)||!t,r=x(e),d=u===r,p=P.get(r),b=!!p&&p.has_slots;return(0,o.jsxs)("button",{type:"button",className:`bp-cal-day ${t?"":"is-out"} ${d?"is-selected":""}`,disabled:i,onClick:()=>function(e){if(g(e))return;const s=x(e);l?.(null),c?.(s)}(e),children:[(0,o.jsx)("div",{children:e.getUTCDate()}),(0,o.jsx)("div",{style:{height:4,width:28,borderRadius:999,margin:"6px auto 0",background:b?"#22c55e":"#e5e7eb",opacity:k&&!p?.3:1}})]},`${r}-${s}`)})})]}),(0,o.jsxs)("div",{className:"bp-slots",children:[(0,o.jsxs)("div",{className:"bp-slots-title",children:["Pick a slot for ",(0,o.jsx)("strong",{children:u||"â€”"})]}),!u&&(0,o.jsx)("div",{className:"bp-muted",children:"Select a date to see available times."}),u&&w&&(0,o.jsxs)("div",{className:"bp-slot-skeleton",children:[(0,o.jsx)("div",{className:"bp-skel"}),(0,o.jsx)("div",{className:"bp-skel"}),(0,o.jsx)("div",{className:"bp-skel"})]}),u&&!w&&T&&(0,o.jsx)("div",{className:"bp-error",children:T}),u&&!w&&!T&&(0,o.jsxs)("div",{className:"bp-slot-grid",children:[S.map((e,s)=>(0,o.jsx)("button",{type:"button",className:"bp-slot "+(i?.start_time===e.time?"is-selected":""),onClick:()=>l?.({start_time:e.time,end_time:e.end||""}),children:e.time},`${e.time}-${s}`)),0===S.length&&(0,o.jsx)("div",{className:"bp-muted",children:"No times found for this date."})]})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:r,children:"<- Back"}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:!R,onClick:d,children:"Next ->"})]})]})}function f(e,s){return"checkbox"===s?"1"!==e:null==e||(Array.isArray(e)?0===e.length:""===String(e).trim())}function k({formFields:e,answers:s,onChange:t,onBack:a,onNext:n,onError:i}){const c=[...e?.form||[],...e?.customer||[],...e?.booking||[]];function l(e){var t;return null!==(t=s?.[e])&&void 0!==t?t:""}return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsx)("div",{className:"bp-form",children:c.map(e=>{const s=e.field_key||e.name_key||"",a=`${e.scope}.${s}`,n=l(a);return(0,o.jsxs)("div",{className:"bp-field",children:[(0,o.jsxs)("label",{className:"bp-label",children:[e.label," ",e.is_required?(0,o.jsx)("span",{className:"bp-required",children:"*"}):null]}),(0,o.jsx)(y,{field:e,value:n,onChange:e=>function(e,s){t(t=>({...t,[e]:s}))}(a,e)})]},a)})}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:a,children:"<- Back"}),(0,o.jsx)("button",{type:"button",className:"bp-next",onClick:function(){for(const e of c){if(!e.is_required)continue;const s=e.field_key||e.name_key||"";if(f(l(`${e.scope}.${s}`),e.type))return void i?.(`${e.label||s} is required`)}i?.(""),n()},children:"Next ->"})]})]})}function y({field:e,value:s,onChange:t}){const a={className:"bp-input",placeholder:e.placeholder||"",value:s||"",onChange:e=>t(e.target.value)};if("textarea"===e.type)return(0,o.jsx)("textarea",{className:"bp-input bp-textarea",rows:4,placeholder:e.placeholder||"",value:s||"",onChange:e=>t(e.target.value)});if("select"===e.type){const a=e.options?.choices||[];return(0,o.jsxs)("select",{className:"bp-input",value:s||"",onChange:e=>t(e.target.value),children:[(0,o.jsx)("option",{value:"",children:"Select..."}),a.map((e,s)=>(0,o.jsx)("option",{value:e.value,children:e.label},s))]})}if("checkbox"===e.type){const a="1"===s||!0===s;return(0,o.jsxs)("label",{className:"bp-checkbox",children:[(0,o.jsx)("input",{type:"checkbox",checked:a,onChange:e=>t(e.target.checked?"1":"0")}),(0,o.jsx)("span",{children:e.placeholder||"Yes"})]})}let n="text";return"email"===e.type&&(n="email"),"tel"===e.type&&(n="tel"),"number"===e.type&&(n="number"),"date"===e.type&&(n="date"),(0,o.jsx)("input",{...a,type:n})}function S({locationId:e,categoryIds:s,serviceId:a,extraIds:n,agentId:i,date:c,slot:l,locations:r,categories:d,services:m,extras:p,agents:u,formFields:b,answers:h,onBack:x,onSubmit:v,loading:g}){const N=r.find(s=>String(s.id)===String(e)),j=m.find(e=>String(e.id)===String(a)),f=u.find(e=>String(e.id)===String(i)),k=d.filter(e=>s.includes(e.id)||s.includes(String(e.id))),y=p.filter(e=>n.includes(e.id)||n.includes(String(e.id))),S=(0,t.useMemo)(()=>[...b?.form||[],...b?.customer||[],...b?.booking||[]],[b]);return(0,o.jsxs)("div",{className:"bp-step",children:[(0,o.jsxs)("div",{className:"bp-review",children:[(0,o.jsx)(C,{label:"Location",value:N?.name}),(0,o.jsx)(C,{label:"Categories",value:k.length?k.map(e=>e.name).join(", "):"-"}),(0,o.jsx)(C,{label:"Service",value:j?.name}),(0,o.jsx)(C,{label:"Agent",value:f?.name}),(0,o.jsx)(C,{label:"Date",value:c}),(0,o.jsx)(C,{label:"Time",value:l?.start_time?`${l.start_time} - ${l.end_time}`:"-"}),(0,o.jsx)(C,{label:"Extras",value:y.length?y.map(e=>e.name).join(", "):"-"}),(0,o.jsx)("div",{className:"bp-review-section",children:"Customer Information"}),S.map(e=>{var s;const t=e.field_key||e.name_key||"",a=`${e.scope}.${t}`;let n=null!==(s=h?.[a])&&void 0!==s?s:"";return"checkbox"===e.type&&(n="1"===n?"Yes":"No"),(0,o.jsx)(C,{label:e.label,value:String(n||"")},a)})]}),(0,o.jsxs)("div",{className:"bp-step-footer",children:[(0,o.jsx)("button",{type:"button",className:"bp-back",onClick:x,children:"<- Back"}),(0,o.jsx)("button",{type:"button",className:"bp-next",disabled:g,onClick:v,children:g?"Submitting...":"Confirm Booking"})]})]})}function C({label:e,value:s}){return(0,o.jsxs)("div",{className:"bp-review-row",children:[(0,o.jsx)("div",{className:"k",children:e}),(0,o.jsx)("div",{className:"v",children:s||"-"})]})}function w({booking:e,onClose:s}){return(0,o.jsx)("div",{className:"bp-step bp-done",children:(0,o.jsxs)("div",{className:"bp-done-card",children:[(0,o.jsx)("div",{className:"bp-done-title",children:"Booking confirmed"}),e?.booking_id?(0,o.jsxs)("div",{className:"bp-done-sub",children:["Booking ID: ",e.booking_id]}):null,e?.manage_url?(0,o.jsx)("a",{className:"bp-done-link",href:e.manage_url,target:"_blank",rel:"noreferrer",children:"Manage your booking"}):null,(0,o.jsx)("div",{className:"bp-done-actions",children:(0,o.jsx)("button",{type:"button",className:"bp-next",onClick:s,children:"Close"})})]})})}const _=[{key:"location",title:"Location Selection",icon:"location-image.png"},{key:"category",title:"Choose Category",icon:"service-image.png"},{key:"service",title:"Choose Service",icon:"service-image.png"},{key:"extras",title:"Service Extras",icon:"service-image.png"},{key:"agent",title:"Choose Agent",icon:"default-avatar.jpg"},{key:"datetime",title:"Choose Date & Time",icon:"blue-dot.png"},{key:"customer",title:"Customer Information",icon:"default-avatar.jpg"},{key:"review",title:"Review Order",icon:"white-curve.png"},{key:"done",title:"Done",icon:"logo.png"}];function T({open:e,onClose:s,brand:a}){const[r,h]=(0,t.useState)(0),[x,v]=(0,t.useState)(null),[g,N]=(0,t.useState)([]),[f,y]=(0,t.useState)(null),[C,T]=(0,t.useState)([]),[E,I]=(0,t.useState)(null),[$,U]=(0,t.useState)(null),[M,O]=(0,t.useState)(null),[F,P]=(0,t.useState)({form:[],customer:[],booking:[]}),[D,R]=(0,t.useState)({}),[A,L]=(0,t.useState)([]),[Y,J]=(0,t.useState)([]),[q,H]=(0,t.useState)([]),[z,K]=(0,t.useState)([]),[W,X]=(0,t.useState)([]),[Z,G]=(0,t.useState)(!1),[Q,V]=(0,t.useState)(""),ee=_[r],se=(0,t.useMemo)(()=>a?.imagesBase?a.imagesBase+ee.icon:"",[a,ee]);function te(){V(""),h(e=>Math.min(e+1,_.length-1))}function ae(){V(""),h(e=>Math.max(e-1,0))}return(0,t.useEffect)(()=>{if(e)return document.body.classList.add("bp-modal-open"),()=>document.body.classList.remove("bp-modal-open")},[e]),(0,t.useEffect)(()=>{e&&(h(0),V(""),v(null),N([]),y(null),T([]),I(null),U(null),O(null),R({}))},[e]),(0,t.useEffect)(()=>{e&&(async()=>{try{G(!0);const[e,s,t]=await Promise.all([n("/front/locations"),n("/front/categories"),l()]);L(e),J(s),P(t)}catch(e){V(e?.message||"Failed to load booking data.")}finally{G(!1)}})()},[e]),(0,t.useEffect)(()=>{e&&(async()=>{try{if("service"===ee.key||"extras"===ee.key||"agent"===ee.key||"datetime"===ee.key||"review"===ee.key){const e=await(({category_ids:e=[],location_id:s=null})=>n("/front/services",{method:"POST",body:JSON.stringify({category_ids:e,location_id:s})}))({category_ids:g,location_id:x});H(e)}}catch(e){H([])}})()},[e,ee.key,g,x]),(0,t.useEffect)(()=>{e&&(async()=>{try{if(!f)return;const[e,s]=await Promise.all([i({service_id:f}),c({service_id:f,location_id:x})]);K(e),X(s)}catch(e){K([]),X([])}})()},[e,f,x]),e?(0,o.jsx)("div",{className:"bp-modal-overlay",role:"dialog","aria-modal":"true",children:(0,o.jsxs)("div",{className:"bp-modal",children:[(0,o.jsx)("button",{className:"bp-modal-close",onClick:s,"aria-label":"Close",children:"x"}),(0,o.jsxs)("div",{className:"bp-modal-grid",children:[(0,o.jsxs)("aside",{className:"bp-side",children:[(0,o.jsx)("div",{className:"bp-side-icon",children:se?(0,o.jsx)("img",{src:se,alt:""}):null}),(0,o.jsx)("h3",{className:"bp-side-title",children:ee.title}),(0,o.jsx)("p",{className:"bp-side-desc",children:"Please complete the steps to schedule your booking."}),(0,o.jsxs)("div",{className:"bp-side-help",children:[(0,o.jsx)("div",{children:"Need help?"}),(0,o.jsx)("div",{className:"bp-help-phone",children:a?.helpPhone})]})]}),(0,o.jsxs)("main",{className:"bp-main",children:[(0,o.jsxs)("div",{className:"bp-main-head",children:[(0,o.jsx)("h2",{children:ee.title}),(0,o.jsx)("div",{className:"bp-step-dots",children:_.slice(0,8).map((e,s)=>(0,o.jsx)("span",{className:s===r?"bp-dot active":"bp-dot"},e.key))})]}),Q?(0,o.jsx)("div",{className:"bp-error",children:Q}):null,Z?(0,o.jsx)("div",{className:"bp-loading",children:"Loading..."}):null,"location"===ee.key&&(0,o.jsx)(d,{locations:A,value:x,onChange:v,onNext:te}),"category"===ee.key&&(0,o.jsx)(m,{categories:Y,value:g,onChange:N,onBack:ae,onNext:te}),"service"===ee.key&&(0,o.jsx)(p,{services:q,value:f,onChange:y,onBack:ae,onNext:te}),"extras"===ee.key&&(0,o.jsx)(u,{extras:z,value:C,onChange:T,onBack:ae,onNext:te}),"agent"===ee.key&&(0,o.jsx)(b,{agents:W,value:E,onChange:I,onBack:ae,onNext:te}),"datetime"===ee.key&&(0,o.jsx)(j,{locationId:x,serviceId:f,agentId:E,serviceDurationMin:q.find(e=>String(e.id)===String(f))?.duration||30,valueDate:$,valueSlot:M,onChangeDate:e=>{U(e),O(null)},onChangeSlot:O,onBack:ae,onNext:te}),"customer"===ee.key&&(0,o.jsx)(k,{formFields:F,answers:D,onChange:R,onBack:ae,onNext:te,onError:V}),"review"===ee.key&&(0,o.jsx)(S,{locationId:x,categoryIds:g,serviceId:f,extraIds:C,agentId:E,date:$,slot:M,locations:A,categories:Y,services:q,extras:z,agents:W,formFields:F,answers:D,onBack:ae,onSubmit:async function(){try{G(!0),V("");const e={location_id:x,category_ids:g,service_id:f,extra_ids:C,agent_id:E,date:$,start_time:M?.start_time||M?.start||"",end_time:M?.end_time||M?.end||"",field_values:D,extras:C},s=await(e=>n("/front/bookings",{method:"POST",body:JSON.stringify(e)}))(e);R(e=>({...e,__booking:s})),h(_.findIndex(e=>"done"===e.key))}catch(e){V(e?.message||"Could not submit booking.")}finally{G(!1)}},loading:Z}),"done"===ee.key&&(0,o.jsx)(w,{booking:D.__booking,onClose:s})]}),(0,o.jsxs)("aside",{className:"bp-summary",children:[(0,o.jsx)("div",{className:"bp-summary-title",children:"Summary"}),(0,o.jsx)("div",{className:"bp-summary-box",children:(0,o.jsx)(B,{locations:A,categories:Y,services:q,extras:z,agents:W,locationId:x,categoryIds:g,serviceId:f,extraIds:C,agentId:E,date:$,slot:M})})]})]})]})}):null}function B(e){const{locations:s,categories:t,services:a,extras:n,agents:i,locationId:c,categoryIds:l,serviceId:r,extraIds:d,agentId:m,date:p,slot:u}=e,b=s.find(e=>String(e.id)===String(c)),h=a.find(e=>String(e.id)===String(r)),x=i.find(e=>String(e.id)===String(m)),v=n.filter(e=>d.includes(e.id)||d.includes(String(e.id))),g=t.filter(e=>l.includes(e.id)||l.includes(String(e.id))),N=null!=h?.price?Number(h.price):0,j=v.reduce((e,s)=>e+(null!=s?.price?Number(s.price):0),0),f=N+j;function k(e){return e||0===e?`${Number(e).toFixed(0)} Kr`:"-"}return(0,o.jsxs)("div",{className:"bp-summary-items",children:[(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Location"}),(0,o.jsx)("div",{className:"v",children:b?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Category"}),(0,o.jsx)("div",{className:"v",children:g.length?g.map(e=>e.name).join(", "):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Service"}),(0,o.jsx)("div",{className:"v",children:h?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Service Price"}),(0,o.jsx)("div",{className:"v",children:null!=h?.price?k(N):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Agent"}),(0,o.jsx)("div",{className:"v",children:x?.name||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Date"}),(0,o.jsx)("div",{className:"v",children:p||"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Time"}),(0,o.jsx)("div",{className:"v",children:u?.start_time?`${u.start_time} - ${u.end_time}`:"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Extras"}),(0,o.jsx)("div",{className:"v",children:v.length?v.map(e=>e.name).join(", "):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Extras Price"}),(0,o.jsx)("div",{className:"v",children:v.length?k(j):"-"})]}),(0,o.jsxs)("div",{className:"bp-summary-row",children:[(0,o.jsx)("div",{className:"k",children:"Total"}),(0,o.jsx)("div",{className:"v",children:null!=h?.price||v.length?k(f):"-"})]})]})}function E({label:e,mountEl:s}){const[a,n]=(0,t.useState)(!1),i="1"===s?.getAttribute("data-bp-fallback"),c=(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",l=(0,t.useMemo)(()=>({imagesBase:c,helpPhone:"+45 91 67 14 52"}),[c]);return(0,t.useEffect)(()=>function(e,s){return e?(e.__bpOpen=()=>s(!0),()=>{e.__bpOpen&&delete e.__bpOpen}):()=>{}}(s,n),[s]),(0,o.jsxs)(o.Fragment,{children:[!i&&(0,o.jsx)("button",{className:"bp-book-btn",type:"button",onClick:()=>n(!0),children:e||"Book Now"}),(0,o.jsx)(T,{open:a,onClose:()=>n(!1),brand:l})]})}function I(){const e=document.querySelectorAll(".bp-front-root[data-bp-widget='wizard']");e.length?(e.forEach(e=>{const s=(0,a.H)(e),t=e.getAttribute("data-bp-label")||"Book Now";s.render((0,o.jsx)(E,{label:t,mountEl:e}))}),document.addEventListener("click",e=>{const s=e.target;if(!(s instanceof Element))return;const t=s.closest('.bp-fallback-btn, [data-bp-open="wizard"]');if(!t)return;const a=t.nextElementSibling,n=a&&a.classList.contains("bp-front-root")?a:t.closest(".bp-front-root")||document.querySelector(".bp-front-root");n&&"function"==typeof n.__bpOpen&&(e.preventDefault(),n.__bpOpen())})):function(){const e=document.getElementById("bp-front-root");if(!e)return;const s=(0,a.H)(e),t={imagesBase:(window.BP_FRONT?.images||"").replace(/\/$/,"")+"/",helpPhone:"+45 91 67 14 52"};document.addEventListener("click",a=>{const n=a.target;n instanceof Element&&n.closest(".bp-open-wizard")&&(a.preventDefault(),e.style.display="block",s.render((0,o.jsx)(T,{open:!0,onClose:()=>{s.render(null),e.style.display="none"},brand:t})))})}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",I):I()})();